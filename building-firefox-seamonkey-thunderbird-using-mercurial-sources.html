<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta name="google-site-verification" content="xO3y2fv-X8oZAKtnao0t7127tULo8Xu6MaMV10EdwFI" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Building Firefox, SeaMonkey and Thunderbird from mercurial repositories</title>

<!-- page -->
<style>
body {font:14px sans;max-width: 1000px;padding:0px 10px;margin: 0 auto; /* center page */} 
.red {background-color: #FFdddd;}
.gray {background-color: #e7e7e7;}
.green {background-color: #E7F5E7;}
.thtwo {background-color: #Fafafa;border: dotted 1px;}
.thtwob {border: dotted 1px;}
.central {border: dashed 1px;display: inline-block;padding: 2px;}
.appx {background-color: #Fafafa;}
.console {border-left: 3px solid lightgrey;margin-left: 15px;}
.dhash {color: #978DFF;}
.comment {color: #acacac;}
.off_rel  {color: magenta;}
div {padding: 5px;white-space: pre-wrap;}
code {font-size:12px;padding: 5px;display: inline-block;white-space: pre-wrap;margin: 5px 0;}
pre {font-size:12px;}
div code {margin: 10px 0;}
a, a:visited {text-decoration: none;font-style: oblique;color: #0000c5;}
a.extlink, a:visited.extlink {color: #c50000;}
a.intlink, a:visited.intlink {color: #00c500;}
hr {width: 100%;height: 2px;}
</style>

<!-- pop-up buttons -->
<style type="text/css">
.b_locn {border-left: 10px solid #FFdddd;padding-left: 10px;}
.b_prefs {border-left: 10px solid #E7F5E7;padding-left: 10px;}
.b_32bit {border-left: 10px solid #Fafafa;padding-left: 10px;}

/* basic for close tab */
span.tabs a {box-shadow:1px 1px 3px gray; /* shift-horz|-vert|width|colour */
border-radius:6px;padding: 2px 4px;color:#0000c5;}
span.tabs.locn a {background-color:#FFdddd;}
span.tabs.prefs a {background-color:#E7F5E7;}
span.tabs.th2 a {background-color:#Fafafa;}

div.tab {display: none;}
div.tab:target {display: block;}
:target div.tab {display: block;}
:target div.tab + div.tab {display: none;}
</style>

<!-- nav box  -->
<style type="text/css">
/*http://www.websitecodetutorials.com/code/css-nav-menus/css3-mega-drop-down-menu.php*/
#menu {
list-style:none;
font-weight:bold;
 font-size: .85em;
}

#menu li {
position:fixed;
top:20;right:10;
background:none;
padding:5px 9px 0px 9px;
border:1px solid #e3e3e3;
border-radius:6px;
text-align:center;
z-index:1;
}

#menu a {display:block;}

/* ----------- Hide/Show Div ---------- */
#menu div {
position:fixed;
top:20;right:10;bottom:10;
max-height: 360px;
 overflow-y: auto;
 white-space: nowrap;
z-index:4;
border:1px solid #000;
font-weight:normal;
text-align:left; 
box-shadow:0 2px 8px #000;
border-radius:6px;
    -moz-transition: all .2s ease-in-out;
 -webkit-transition: all .2s ease-in-out;
      -o-transition: all .2s ease-in-out;
     -ms-transition: all .2s ease-in-out;
         transition: all .2s ease-in-out;
visibility:hidden;
opacity:0;
}

/* ---- CSS3 Transform Fade In/Out ----- */
#menu li:hover div {
visibility:visible;
background:#fff;
opacity:1;
}

#menu div p {padding-right:20px;}

#menu div p a {
color:darkblue;
text-decoration:none;
clear:left;
line-height:1.1;
}

#menu div a:hover, #menu div a:focus, #menu div a:active {
text-decoration:none;
color:darkred;
}

/* print styling - no nav box */
@media print {#menu { display: none;} body, p, a {color:#000; background:#fff;}}
</style>


</head><body>
<br>
<h3> Building Firefox, SeaMonkey and Thunderbird from mercurial repositories</h3>
Covers building from the release repositories <b>release</b>, <b>beta</b>, and <b>esr52/60</b>; and from <b>central</b>.
<br>
The <b>mozilla-unified</b> repository is used to avoid having up to 4 different copies of mozilla repositories, and is smaller than most of them.
<p>This page has been laid out around a mainly distro-independent build script, defaulting to an <span class="gray">en-US</span> build on unmodified source.
<br>
Packaging - installation and creation - is Slackware specific, which I guess would be adaptable to other packaging systems.
<br>
Packaging from the 'mach' built packages is generic.
<p>
Build <span style="background:#FFFADD;">Firefox</span> with gtk2 optionally for 52.x releases - gtk3 otherwise, using mach, and rust; and package it to install to /opt/firefox-{version} ...<br>
and/or <span style="background:#E5F1FF;">SeaMonkey</span> and/or <span style="background:#F8F8F8">Thunderbird</span> based on that Firefox source.
<br>
<p>Builds can be customized with <a href="#Prefs"><span class="green">user preferences</span></a> and <a href="#l10n"><span class="red">single localization</span></a> options and <a href="#Th2bit"><span class="thtwo">32-bit build</span></a> adjustments when using a 64-bit kernel on a 32-bit system, and for building in a chroot.
<br>
<p><span class="green">Additional setting up</span> for cross compiling <a href="#FF_xcompile">Firefox</a> - <a href="#SM_xcompile">Seamonkey</a> - <a href="#TB_xcompile">Thunderbird</a> for armv7/aarch64 [Raspberry Pi3].
<br>

<hr>
<b>References</b><br>
<a class="extlink" href="http://www.linuxfromscratch.org/blfs/view/svn/xsoft/firefox.html">LFS</a> for mozconfig setup and the inspiration to do this
<br>
<a class="extlink" href="https://developer.mozilla.org/en-US/docs/Mozilla/Developer_guide/Build_Instructions/Simple_Firefox_build">Simple Firefox build</a><br>
<a class="extlink" href="https://developer.mozilla.org/en-US/docs/Simple_Firefox_build/Linux_and_MacOS_build_preparation">Linux Build Prerequisites</a>
<br>
&hellip; and other Mozilla Developer pages &hellip;

<p><a name="Latest"></a><br>
<b>Latest builds</b>
<br>
l10n files are updated from the l10n-central base revisions during <a href="#l10n">Localization</a> using compare-locales 
<br><code class="appx">                                                   built to <span class="off_rel">{official}</span> revision/changeset
        <u>Firefox</u>   <u>SeaMonkey</u>   <u>Thunderbird</u>       <u>mozilla</u>         <u>comm-$REL</u>       <u>l10n-central</u>   <u>Options</u>
</code>
<br>
<b><i>esr60</i></b> <span class="comment"> [SM/TB versions as per '<a href="#Prefs">User preferences</a>[5]'</span>
<br>
<code class="appx">        60.4.0                                  <span class="off_rel">6cc5fc0eaeaf</span>    <span class="comment">n/a</span>             <span class="">24a583bfc5c7</span>   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
<span class="comment green">armv7</span>   60.6.0                                  <span class="off_rel">7dc3b931ebe5</span>    <span class="comment">n/a</span>             <span class="comment">not used&nbsp;&nbsp;&nbsp;&nbsp;</span>   <span style="color:#8F8F8F"><span class="gray"> </span> <span class=""> </span> <span class=""> </span> <span class=""> </span></span>
                  2.57.4.0                      6cc5fc0eaeaf    ece4d20e004b    <span class="">24a583bfc5c7</span>   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
<span class="comment green">armv7</span>             2.57.5.0                      e3f1767f8309    0afc082591ad    <span class="comment">not used&nbsp;&nbsp;&nbsp;&nbsp;</span>   <span style="color:#8F8F8F"><span class="gray"> </span> <span class=""> </span> <span class=""> </span> <span class=""> </span></span>
                              60.4.0            6cc5fc0eaeaf    ece4d20e004b    <span class="">24a583bfc5c7</span>   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
<span class="comment green">armv7</span>                         60.5.0            e3f1767f8309    0afc082591ad    <span class="comment">not used&nbsp;&nbsp;&nbsp;&nbsp;</span>   <span style="color:#8F8F8F"><span class="gray"> </span> <span class=""> </span> <span class=""> </span> <span class=""> </span></span>
</code>
<br>
<span class="comment">FFesr 60.6 and FF66 builds have been done with rust 1.31.0 or 1.34.0 because <a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1520758">style_traits will not build with rust 1.33.0</a></span>
<br>
<b><i>release</i></b>
<br>
<code class="appx">        66.0.2                                  <span class="off_rel">ed39a05717aa</span>    <span class="comment">n/a</span>             <span class="comment">not used&nbsp;&nbsp;&nbsp;&nbsp;</span>   <span class="gray"> </span> <span class=""> </span> <span class=""> </span> <span class=""> </span>
<span class="comment green">armv7</span>   66.0.2 &diamondsuit;                                <span class="off_rel">ed39a05717aa</span>    <span class="comment">n/a</span>             <span class="comment">not used&nbsp;&nbsp;&nbsp;&nbsp;</span>   <span style="color:#8F8F8F"><span class="gray"> </span> <span class=""> </span> <span class=""> </span> <span class=""> </span></span>
<span class="comment green">aarch64</span> 66.0.2 &diamondsuit;&diamondsuit;                               <span class="off_rel">ed39a05717aa</span>    <span class="comment">n/a</span>             <span class="comment">not used&nbsp;&nbsp;&nbsp;&nbsp;</span>   <span style="color:#8F8F8F"><span class="gray"> </span> <span class=""> </span> <span class=""> </span> <span class=""> </span></span>
                  <span class="comment">2.61                          8337ebb86a42    f2b7084210a3    <span class="">not used&nbsp;&nbsp;&nbsp;&nbsp;</span>   <span class="gray"> </span> <span class=""> </span> <span class=""> </span> <span class=""> </span></span>
                              64.0              8337ebb86a42    f2b7084210a3    <span class="comment">not used&nbsp;&nbsp;&nbsp;&nbsp;</span>   <span class="gray"> </span> <span class=""> </span> <span class=""> </span> <span class=""> </span>
</code>
<br>
<span class="comment">SM2.61 builds but continues to be <a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1452448">unusable</a>.</span>
<br>
&diamondsuit; <span class="comment">FF66 for armv7 requires <a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1526653">patching</a> for error: <i>field ‘ufp’ has incomplete type ‘user_vfp’</i></span>
<br>
&diamondsuit;&diamondsuit; <span class="comment">FF66 for aarch64 requires <a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1513605">patching</a> for <i>'checking for clock_gettime(CLOCK_MONOTONIC)... no'</i> result</span>
<br>
<b><i>beta</i></b>
<br>
<code class="appx">        60.0b3                                  e0827182ac6c    <span class="comment">n/a</span>             <span class="comment">not used&nbsp;&nbsp;&nbsp;&nbsp;</span>   <span class="gray"> </span> <span class=""> </span> <span class=""> </span> <span class=""> </span>
                  2.57                          e0827182ac6c    2d485f0d3723    <span class="comment">not used&nbsp;&nbsp;&nbsp;&nbsp;</span>   <span class="gray"> </span><span class=""> </span> <span class=""> </span> <span class=""> </span>
</code>
<br>
<b><i>central [Nightly]</i></b>
<br>
<code class="appx">        61.0a1                                  445255800255    <span class="comment">n/a</span>             <span class="comment">not used&nbsp;&nbsp;&nbsp;&nbsp;</span>   <span class="gray"> </span> <span class=""> </span> <span class=""> </span> <span class=""> </span>
                  <span class="comment">2.58a1                        445255800255    c79eb711d4d4    <span class="comment">not used&nbsp;&nbsp;&nbsp;&nbsp;</span>   <span class="gray"> </span><span class=""> </span> <span class=""> </span> <span class=""> </span></span>
</code>
<br>
<span class="comment">[Nightly] builds from mozilla changeset f080a35baf6a require gcc 6.1+.<br>
This SM2.58a1 build completes, but URLs will not launch from the address bar or CLI.</span>
<br>
<b><i>esr52</i></b> <span class="comment"> [SM/TB versions as per '<a href="#Prefs">User preferences</a>[5]'</span>
<br>
<code class="appx">        52.9.0                                  <span class="off_rel">755067c14b06</span>    <span class="comment">n/a</span>             3b1783bdb6fd   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
                  2.49.9.0                      755067c14b06    25c3e70855eb    3b1783bdb6fd   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
                              52.9.0            755067c14b06    25c3e70855eb    3b1783bdb6fd   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
</code>
<p>

<br>
<b>Build times</b>
<br><code>Machine			dual-core 2.2 GHz			2x quad-core 3GHz
MOZ_MAKE_FLAGS		-j2					-j10		 -j12
Firefox 		~110 mins [FF52]  ~240 mins [FF65]	~23 mins [FF52]  ~40 mins [FF60esr]
SeaMonkey/Thunderbird	~111 mins [TB52]  ~240 mins [TB64]	~24 mins [TB52]  ~41 mins [SM2.57esr/TB60esr]</code>
<br>
Higher values for '-j' on the dual-core machine cause random build errors, unless built with adequate memory or swap.
<br>
Typical usage is 6GB actual, 3GB swap for -j6.

<p><a name="DirStructure"></a><br>
    <b>Directory structure</b><br>
    The build is done within this directory structure [key directories only]:<br>
    <code>$MOZBUILD
├── mozilla					# unpacked mozilla-unified bundle
│   └── extensions
│       <span class="green">└── {irc,inspector}			# mercurial clones</span>
├── sources
│   ├── autoconf_213				# autoconf-2.13 installation
│   ├── llvm-$ARCH				# for LLVM_CONFIG for stylo build
│   ├── mozilla-unified.zstd.hg			# mercurial bundle
│   ├── rust&hellip;					# download and installation
│   <span class="red">└── compare-locales				# to create merge-$L10N</span>
├<span class="thtwo">── chrt					# chroot for 32-bit builds</span>
├<span class="red">── l10n</span>
│   <span class="red">├── $L10N					# mercurial clone</span>
│   <span class="red">├── merge-$L10N 				# updated $L10N files</span>
│   <span class="red">└── wip 					# temporary workspace for FF57+ builds</span>
└───$REL						# build tree for each of release, beta, esr52/60, central
    ├── comm-$REL					# mercurial clone
    │   └── mozilla					# bind to $MOZBUILD/mozilla
    │       <span class="thtwo">└── comm					# work-around for FF/TB 64+ &amp; SM 2.57+</span>
    ├── {firefox,seamonkey,thunderbird}-build-dir	# build directories
    ├── packaging-{FF,SM,TB}
    │   └── usr/lib					# install here to create package
    └── built
        ├── firefox-{version}$LOCZN-$PKG_ARCH.txz	# the Firefox Slackware package
        ├── seamonkey-{version}$LOCZN-$PKG_ARCH.txz	# the SeaMonkey Slackware package
        └── thunderbird-{version}$LOCZN-$PKG_ARCH.txz	# the Thunderbird Slackware package
</code>
<p>

<a name="Set_variables"></a><br>
<b>Set variables</b>
<br>
<code class="gray">export MOZBUILD=<b>/mozbuild</b>
<span class="dhash">##</span> Set which repositories to clone:
export REPOS="<b>release</b> <b>beta</b> <b>esr52</b> <b>esr60</b> <b>central</b>"
<span class="dhash">##</span> choose which to build:
export REL=<span class="comment"><b>esr60</b></span>
<span class="dhash">##</span> set number of parallel jobs
export NUMJOBS=-j$(getconf _NPROCESSORS_ONLN) &amp;&amp; [[ $(getconf _NPROCESSORS_ONLN) -ge 8 ]] &amp;&amp; export NUMJOBS=-j12
<span class="dhash">##</span> 'gtk2' option for esr52 only - 'cairo-gtk2' option has been removed from 53.x; otherwise 'gtk3'
export GTK=gtk3 &amp;&amp; [[ $REL == esr52 ]] &amp;&amp; export GTK=gtk2
<span class="dhash">##</span> 'uname -m' won't identify the architecture where a 64-bit kernel is being used for a 32-bit system
export ARCH=x86_64 &amp;&amp; [[ $(getconf LONG_BIT) == 32 ]] &amp;&amp; export ARCH=i686 ; export PKG_ARCH=$ARCH
export LOCZN=-$(echo en-US | tr - _)
<span class="red">export L10N=<span class="comment"><b>en-GB</b></span> &amp;&amp; export LOCZN=-$(echo $L10N | tr - _)</span>
</code>

<p>
<b>Create build directories</b><br>
<code class="gray"><span class="red">mkdir -p $MOZBUILD/l10n/wip</span>
mkdir -p $MOZBUILD/sources

<span class="dhash">##</span> Set which directories to create:
REPOS=$REPOS
(for repo in $REPOS
do
mkdir -p $MOZBUILD/$repo/{packaging-{FF,SM,TB},built}
done)
</code>

<p><a name="Mercurial_bundles"></a>
<b>Mercurial bundles and repositories</b><br>
mozilla-unified is downloaded as a compressed bundle [~1<font size="-1">x</font>10<sup>9</sup> B] and is unbundled to a sub-directory of $MOZBUILD.<br>
The key advantage of using a bundle rather than cloning the repo is that an interrupted download can be resumed. <br>
It also puts less of a load on the server - see <a class="extlink" href="http://gregoryszorc.com/blog/2015/05/29/faster-cloning-from-hg.mozilla.org-with-server-provided-bundles/">here</a> and <a class="extlink" href="http://gregoryszorc.com/blog/2015/10/22/cloning-improvements-in-mercurial-3.6/">here</a>.


<p>mozilla-unified<br>
Requires mercurial with zstd support [v4.1.2 works], otherwise view 'bundles' file and choose compression type<br>
<code class="gray">cd $MOZBUILD/sources
<span class="dhash">##</span> get mozilla-unified bundle
wget -O bundles https://hg.cdn.mozilla.net/
BUNDLE=$(grep mozilla-unified.*zstd bundles | sed 's|.*href="||;s|">.*$||')
wget -O mozilla-unified.bundle https://hg.cdn.mozilla.net/$BUNDLE

cd $MOZBUILD
<span class="dhash">##</span> unbundle mozilla-unified
hg init mozilla
hg unbundle sources/mozilla-unified.bundle -R mozilla
<span class="dhash">##</span> set default repo to pull from
echo "[paths]
default = https://hg.mozilla.org/mozilla-unified/" > mozilla/.hg/hgrc
<span class="dhash">##</span> get new changesets since bundle was created
hg pull -R mozilla
<span class="dhash">##</span> update local repo
hg update -R mozilla
</code>

<p>
comm-$REL, chatzilla, inspector, and locale have to be cloned as no bundle is available.
<br>
There is a comm-central bundle, but to keep things consistent, let's clone that too &hellip;
<br>
<code class="gray"><span class="dhash">##</span> Set which repositories to clone:
REPOS=$REPOS

(for repo in $REPOS
do
cd $MOZBUILD/$repo
RELEASES="/releases" &amp;&amp; [[ $repo == central ]] &amp;&amp; unset RELEASES
hg clone https://hg.mozilla.org${RELEASES:-""}/comm-$repo/
done)
</code>

<p> Add chatzilla [IRC] and inspector [DOM] repos if required.
<br>
Although these are shown as optional, they are in fact default build options for SeaMonkey 2.49 and would have to be specifically excluded from the SeaMonkey build.
<br>
<code class="green">(cd $MOZBUILD/mozilla/extensions
hg clone https://hg.mozilla.org/chatzilla/ irc
hg clone https://hg.mozilla.org/dom-inspector/ inspector)
</code>
<p>
From FF57:
<br>Chatzilla extension doesn't work from mozilla [firefox quantum] 57 onwards - that is from SeaMonkey 2.54 onwards [<a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1392807">bugzilla</a>, <a class="extlink" href="http://chatzilla.hacksrus.com/">Latest News</a>, <a class="extlink" href="https://blog.mozilla.org/addons/2016/11/23/add-ons-in-2017/">why</a>, <a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1322442">solution?</a>]
<br>
Trying to run it from SeaMonkey will give a GUI error message:
<br><code class="console">Remote XUL
This page uses an unsupported technology that is no longer available by default.
</code>
<br>
and a console error message:
<br><code class="console">JavaScript error: chrome://chatzilla/content/handlers.js, line 10: TypeError: client.deck is undefined
JavaScript error: chrome://chatzilla/content/static.js, line 927: TypeError: client.statusElement is undefined
</code>

<p>
non-US locale<br>
Use l10n mozilla-central repository and revert to the official revisions when required as per l10n_changesets.txt [FFesr52], or l10n-changesets.json [FF59+].
<br>
<code class="red">(cd $MOZBUILD/l10n/
hg clone https://hg.mozilla.org/l10n-central/$L10N/)
</code>

<br>
If the localization has not been updated for new files or strings from the en-US locale, then the build will fail or run-time failures will occur on those omissions.
<br>
A check should therefore be made to ensure that there are no missing files or strings in the localization, which is done with <i>compare-locales</i> - see '<a href="#l10n">Localization</a>'.
<p>
<a name="UpdateRepoReturn"></a>

Once these locally cloned repositories have been set up, they can be kept up-to-date for future builds - see '<a href="#Locrep">Add new changesets</a>'.
<p>

<b><span class="red">Dictionaries</span></b>
<br>
To avoid this build failure on installation:
<br>
<code class="console">Error: ...browser/installer/package-manifest.in:50: Missing file(s): bin/dictionaries/*</code>
<br>
comment out line 50 in package-manifest.in &hellip;
<br>
<b style="color: darkblue;">OR</b> download and install a dictionary [recommended]:
<br>
Links to dictionaries are available at <a class="extlink" href="https://addons.mozilla.org/language-tools/">Mozilla addons</a>
<br>
<code class="red">cd $MOZBUILD/sources
wget -O $L10N-dict.xpi https://addons.mozilla.org/firefox/downloads/latest/<span class="comment">british-english-dictionary-2/addon-461570-latest.xpi</span>
</code>

<p>
<b>Autoconf</b>
<br>Building needs autoconf-2.13 for the '--localdir=' option which the later versions don't have.
<br>Build and install to temporary directory for use with this build only.
<br>
<code class="gray">cd $MOZBUILD/sources
wget http://ftpmirror.gnu.org/autoconf/autoconf-2.13.tar.gz

tar xf autoconf-2.13.tar.gz
cd autoconf-2.13
./configure --prefix=$MOZBUILD/sources/autoconf_213
make
make install
</code>
<br>
autoconf is now installed at $MOZBUILD/sources/autoconf_213/bin/autoconf and this path is included in mozconfig.common.

<p>
<b>Rust</b>
<br>
What is rust and why should I use it? - see <a class="extlink" href="https://hacks.mozilla.org/2016/07/shipping-rust-in-firefox/">here</a> and <a class="extlink" href="http://www.zdnet.com/article/mozilla-begins-process-of-letting-firefox-rust/">here</a>. Building with rust is the default for 54.x onwards.
<br>
<code class="gray">cd $MOZBUILD/sources/
wget -O rust.html https://forge.rust-lang.org/other-installation-methods.html
URL=$(grep "rust-[1-9].*$ARCH-unknown-linux-gnu.tar.gz\">" rust.html | sed 's|.*href="||;s|">.*$||;s|tar.gz|tar.xz|')
wget $URL

tar xf rust*$ARCH-unknown-linux-gnu.tar.xz
cd rust*$ARCH-unknown-linux-gnu
./install.sh --prefix=$MOZBUILD/sources/rust-$ARCH --components=rustc,cargo,rust-std-$ARCH-unknown-linux-gnu
</code>
<br>Building with rust enabled requires rustc to be in the PATH which is set as a shell variable:<br>
<code class="gray">export PATH=$MOZBUILD/sources/rust-$ARCH/bin:$PATH
</code>

<p>
<!--
Add new changesets - start
-->
<a name="close_chset"></a>
<br>
<span class="tabs"><a href="#Locrep">Add new changesets</a></span><span style="vertical-align:-30%">&nbsp;&nbsp;to all cloned repositories prior to any <a class="extlink" href="https://wiki.mozilla.org/RapidRelease/Calendar">future release builds</a> [or as required].</span>
<div id="Locrep" class="tab"><div class="b_32bit"><span class="tabs"><a href="#close_chset">close</a></span>
<code class="appx"><span class="dhash">##</span> Set which repositories to update:
REPOS=$REPOS

cd $MOZBUILD
hg pull -R mozilla
<span class="green">hg pull -R mozilla/extensions/inspector
hg pull -R mozilla/extensions/irc</span>
<span class="red">hg pull -R l10n/$L10N</span>

for repo in $REPOS
do
hg pull -R $repo/comm-$repo
done

<span class="dhash">##</span> De-clutter the mozilla[-unified] bookmarks list
sed -i '/aurora/d;/esr[1-4]/d;/fx-team/d;/inbound/d' $MOZBUILD/mozilla/.hg/bookmarks
</code>
<span class="tabs"><a href="#close_chset">close</a></span>
</div>
<br></div>
<!--
Add new changesets - end
-->

Set up the local repositories for chosen $REL, removing any changes made for previous builds:<br>
<code class="gray">cd $MOZBUILD
hg update $REL -C -R mozilla
hg update default -C -R $REL/comm-$REL/
<span class="green">hg update default -C -R mozilla/extensions/inspector
hg update default -C -R mozilla/extensions/irc</span>
<span class="red">hg update default -C -R l10n/$L10N</span>
</code>
<p>
<!--
Building to a changeset - start
-->
<a name="close_known_rel"></a>
<br>
<span class="tabs prefs"><a href="#known_rel">Building to a specific revision</a></span>
<div id="known_rel" class="tab"><div class="b_prefs"><span class="tabs"><a href="#close_known_rel">close</a></span>
<!-- leave this space -->
<b>Building to the same revision as an <a class="extlink" href="https://wiki.mozilla.org/RapidRelease/Calendar">official release</a></b>
This is relevant for release versions only, beta builds have been specifically excluded.

<b><i>Either</b></i>: Prior to the release date, the changesets on which the release candidates are built can be obtained from mozilla.org.
The final release candidate can be as late as the weekend before the scheduled release date.
This finds the latest release candidate build for any specific Firefox version, and sets up a new bookmark to that revision &hellip;
<code class="green"><span class="dhash">##</span> <b>Firefox</b>:
<span class="dhash">##</span> FF_VER defaults to the current repo Firefox version and will only give a resultant release candidate changeset [REL_CAND_CS] when the release candidate loses its beta suffix which should be 7-12 days before the release date
<b>FF_VER</b>=$(cat $MOZBUILD/mozilla/browser/config/version.txt)
echo $FF_VER
<span class="dhash">##</span> Override with <b>FF_VER</b>=xx.x[.x] for an earlier version
ESR_SUFF="" &amp;&amp; [[ $REL == esr?? ]] &amp;&amp; ESR_SUFF=esr

cd $MOZBUILD/sources/
<span class="dhash">##</span> [1] Get list of release candidates and find the latest for this release/esr52/esr60 version
wget -O candidates.html https://archive.mozilla.org/pub/firefox/candidates/
REL_CAND=$(grep $FF_VER candidates.html|grep -v b[0-9] | grep -o $FF_VER${ESR_SUFF:-}-candidates | head -n1)

<span class="dhash">##</span> [2] Get list of release candidate builds and find the latest
wget -O $REL_CAND.html https://archive.mozilla.org/pub/firefox/candidates/$REL_CAND/
BUILD=$(grep build $REL_CAND.html|tail -n1|cut -d"/" -f6)

<span class="dhash">##</span> [3] Download the .json file which includes the changeset reference for that build and find the changeset
JSON="firefox-$(echo $REL_CAND |cut -d- -f1).json"
wget -O $JSON https://archive.mozilla.org/pub/firefox/candidates/$REL_CAND/$BUILD/linux-$ARCH/en-US/$JSON
REL_CAND_CS=$(grep stamp $JSON |colrm 1 23|colrm 13)

cd $MOZBUILD/mozilla/
<span class="dhash">##</span> Create new bookmark to that release candidate changeset
hg bookmark -r $REL_CAND_CS ${REL}_$FF_VER
<span class="dhash">##</span> Set the new bookmark active
hg checkout ${REL}_$FF_VER
</code>
<b><i>Or</b></i>: Where the FF version is known, i.e. after its release date, the changeset on which it was built can be determined from the repo log and then the repo reverted to that changeset.
The changeset for any specific release is only tagged as FIREFOX_xx_x[_x]_RELEASE on the official release date.
<code class="green"><span class="dhash">##</span> <b>Firefox</b>:
<span class="dhash">##</span> Set to a sufficiently high number for the changeset to be found
<b>LOG_NUM</b>=<span class="comment">4000</span>
<span class="dhash">##</span> Set the Firefox version
<b>REL_TAG</b>=<span class="comment">52_7_3</span>
ESR_SUFF="" &amp;&amp; [[ $REL == esr?? ]] &amp;&amp; ESR_SUFF=esr

cd $MOZBUILD/mozilla/
REL_CS=$(hg log -l $LOG_NUM -Gr ::$REL | grep FIREFOX_$REL_TAG${ESR_SUFF:-}_RELEASE | grep -o "Tagging [0-f]*"|colrm 1 8|colrm 13)
<span class="dhash">##</span> Create new bookmark to that release changeset
hg bookmark -r $REL_CS ${REL}_$REL_TAG
<span class="dhash">##</span> Set the new bookmark active
hg checkout ${REL}_$REL_TAG
</code>

<b><i>Or</b></i>: Building to any other revision

<b><u>mozilla</b></u>
Find the changesets within mozilla-unified applicable to REL only.
List last NUM_CS changesets:
<code class="appx"><b>NUM_CS</b>=<span class="comment">5</span>
hg log -l $NUM_CS -Gr ::$REL -R $MOZBUILD/mozilla/ | colrm 1 3
</code>
Select a changeset from that list, and create a bookmark and set it active:
<code class="green"><span class="dhash">##</span> <b>Firefox</b>:
<b>BUILD_CS</b>=<span class="comment">xxxxxxxxxxxx</span>

cd $MOZBUILD/mozilla/
<span class="dhash">##</span> Create new bookmark to that changeset
hg bookmark -r $BUILD_CS ${REL}_$BUILD_CS
<span class="dhash">##</span> Set the new bookmark active
hg checkout ${REL}_$BUILD_CS
</code>
Delete bookmark when no longer required:
<code class="appx">hg bookmark --delete ${REL}_$BUILD_CS -R $MOZBUILD/mozilla/
</code>

Check that required bookmark is active:
<code class="green">hg bookmarks -R $MOZBUILD/mozilla/
</code>

<b><u>comm-$REL</b></u>
There are no formal SeaMonkey releases and Thunderbird is released in a beta version.

Download the relevant thunderbird-&lt;version>.txt file and extract the build revisions data.
This is at, for example for the Thunderbird build 60.0b6:
<code class="console">https://archive.mozilla.org/pub/thunderbird/candidates/60.0b6-candidates/build1/linux-x86_64/en-US/thunderbird-60.0b6.txt</code>
which contains the repository revisions the build was based on:
<code class="console">https://hg.mozilla.org/releases/comm-beta/rev/4bd4065b53b00dd2233d9ef34f27fd6192d732f8
https://hg.mozilla.org/releases/mozilla-beta/rev/88497e338153dbe5aac3d17af326cd79ae840eaa</code>
For the SM/TB builds, set <span style="font:normal bold 10pt sans;">COMM_BUILD_CS=4bd4065b53b0</span> &hellip;
<code class="green"><span class="dhash">##</span> <b>SeaMonkey/Thunderbird</b>:
<b>COMM_BUILD_CS</b>=<span class="comment">4bd4065b53b0</span>
hg checkout -r $COMM_BUILD_CS -R $MOZBUILD/$REL/comm-$REL
</code>
&hellip; and the mozilla changeset used can be set as shown above for mozilla [<span style="font:normal bold 10pt sans;">BUILD_CS=88497e338153</span>], or left as set above for Firefox [<span style="font:normal bold 10pt sans;">REL_CAND_CS</span> or <span style="font:normal bold 10pt sans;">REL_CS</span>]

Check the revision
<code class="green">hg parent -R $MOZBUILD/$REL/comm-$REL
</code>

<span class="tabs"><a href="#close_known_rel">close</a></span>
</div></div>
<!--
Building to a changeset - end
-->

<p><br>
<b><a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1384062">Patch required</a></b> for esr52 build error:
<br>
<code class="console">AssertionError
  File "..../testing/mozbase/mozsystemmonitor/mozsystemmonitor/resourcemonitor.py", line 289, in stop
    assert self._running
</code>
<br>
<code class="gray">[[ $REL == esr52 ]] &amp;&amp; \
[[ ! $(grep "return self._pipe.poll" $MOZBUILD/mozilla/testing/mozbase/mozsystemmonitor/mozsystemmonitor/resourcemonitor.py) ]] &amp;&amp; \
cd $MOZBUILD/sources/
[[ ! -e 8d9ae8c45dd0 ]] &amp;&amp; wget https://hg.mozilla.org/mozilla-central/raw-rev/8d9ae8c45dd0
cd $MOZBUILD/mozilla/
patch -p1 &lt; $MOZBUILD/sources/8d9ae8c45dd0
</code>

<p>
Find the Firefox major version for later version dependent settings
<br>
<code class="gray">export MAJ_VER=$(cat $MOZBUILD/mozilla/browser/config/version.txt | cut -d. -f1)
</code>

<p><a name="Create_mozconfigs"></a>
<b>Create mozconfigs</b>
<br>
As three packages are being built, set up mozconfig.{common,firefox,seamonkey,thunderbird}
<br>
'mach' will install wherever '--prefix=' points to.
<br>
Other options can be seen in 'old-configure'
<p>
mozconfig.common:
<br>
<code class="gray">(cd $MOZBUILD/mozilla
cat &gt; mozconfig.common &lt;&lt; "EOF"
<span class="dhash">##</span> From FF66, AUTOCONF has to be 'exported' to be found by the js/src configuration
<span class="dhash">##</span> so to forestall any future problems, let's export everything
mk_add_options "export MOZ_MAKE_FLAGS=$NUMJOBS"
mk_add_options "export NO_MERCURIAL_SETUP_CHECK=1"
mk_add_options "export AUTOCONF=$MOZBUILD/sources/autoconf_213/bin/autoconf"
<span class="dhash">##</span> llvm installed off PATH for the use of this build only
mk_add_options "export LLVM_CONFIG=$MOZBUILD/sources/llvm-$ARCH/usr/bin/llvm-config"

ac_add_options --prefix=/usr

<span class="dhash">##</span> If you have installed DBus-Glib comment out this line:
#ac_add_options --disable-dbus

<span class="dhash">##</span> If you have installed dbus-glib, and you have installed (or will install)
<span class="dhash">##</span> wireless-tools, and you wish to use geolocation web services, comment out
<span class="dhash">##</span> this line
ac_add_options --disable-necko-wifi

<span class="dhash">##</span> Build with gtk2 or gtk3
ac_add_options --enable-default-toolkit=cairo-$GTK

<span class="dhash">##</span> Uncomment this option if you don't have PulseAudio installed
#ac_add_options --disable-pulseaudio

<span class="dhash">##</span> If you have installed GConf, comment out this line
ac_add_options --disable-gconf

ac_add_options --disable-crashreporter
ac_add_options --disable-updater
ac_add_options --disable-tests
ac_add_options --enable-optimize
ac_add_options --disable-official-branding
#ac_add_options --with-pthreads
ac_add_options --with-system-zlib

<span class="dhash">##</span> option to disable stylo for [ FF -le 60 ]
<span class="dhash">#</span>ac_add_options --disable-stylo

EOF
)
</code>

<br>
These options are not recognized from 57.x and cause a build failure:
<br>
<code class="gray">[[ $MAJ_VER -lt 57 ]] &amp;&amp; \
(cd $MOZBUILD/mozilla
cat &gt;&gt; mozconfig.common &lt;&lt; "EOF"
ac_add_options --enable-safe-browsing
ac_add_options --enable-url-classifier

EOF
)
</code>
<p>
<b>FF64</b>+ needs additional setting up
<br>
<code class="gray">[[ $MAJ_VER -ge 64 ]] &amp;&amp; {
<span class="dhash">##</span> [1] <b>cbindgen</b> - this will install to the same directory as rustc &amp; cargo
cd $MOZBUILD/sources
<span class="dhash">##</span> get the latest version #
<span style="color: #c50000;">wget -O cbindgen-index.html https://github.com/eqrion/cbindgen/</span>
CBINDGEN_REL=$(grep -o "Release [0-9.]*" cbindgen-index.html | sed 's|Release ||' | head -n1)
<span style="color: #c50000;">wget -O cbindgen-$CBINDGEN_REL.tar.gz https://github.com/eqrion/cbindgen/archive/v$CBINDGEN_REL.tar.gz</span>
tar xf cbindgen-$CBINDGEN_REL.tar.gz
cd cbindgen-$CBINDGEN_REL/
cargo install --root $MOZBUILD/sources/rust-$ARCH cbindgen

<span class="dhash">##</span> if cbindgen decides it can't find some rustc libs, set RPATH as per rustc:
patchelf --force-rpath --set-rpath \$ORIGIN/../lib $MOZBUILD/sources/rust-$ARCH/bin/cbindgen

<span class="dhash">##</span> [2] <b>nodejs</b> - v8.12.0 builds from the script at slackbuilds.org
installpkg nodejs-8.12.0-x86_64-1_SBo.txz

<span class="dhash">##</span> [3] Set MOZBUILD_STATE_PATH so the build completes without prompting
echo 'mk_add_options "export MOZBUILD_STATE_PATH=$MOZBUILD/.mozilla"' >> $MOZBUILD/mozilla/mozconfig.common

<span class="dhash">##</span> [4] With mozilla as the topsrcdir, need to set the suite/mail applications to the <a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1515812">'comm' directory</a>
export COMM=comm/
}
</code>
<p>
For optional non-US single locale version for esr52 builds only:&nbsp;
<br>Produces a "TypeError: 'NoneType' object is not iterable" build error for FF57+ - see 'Workaround for FF57+' in '<a href="#l10n">Localization</a>'
<br><code class="red">[[ $MAJ_VER -lt 57 ]] &amp;&amp; \
(cd $MOZBUILD/mozilla
cat &gt;&gt; mozconfig.common &lt;&lt; "EOF"
<span class="dhash">##</span> To build a single locale version
ac_add_options --enable-ui-locale=$L10N
ac_add_options --with-l10n-base=$MOZBUILD/l10n

EOF
)
</code>

<p>
mozconfig.firefox:
<br>
<code class="gray">(cd $MOZBUILD/mozilla
cat &gt; mozconfig.firefox &lt;&lt; "EOF"
<span class="dhash">##</span> include the common mozconfig
source $MOZBUILD/mozilla/mozconfig.common

<span class="dhash">##</span> for Firefox build
ac_add_options --enable-application=browser
mk_add_options MOZ_OBJDIR=$MOZBUILD/$REL/firefox-build-dir

EOF
)
</code>
<p>
mozconfig.seamonkey:
<br>
<code class="gray">(cd $MOZBUILD/$REL/comm-$REL
cat &gt; mozconfig.seamonkey &lt;&lt; "EOF"
<span class="dhash">##</span> include the common mozconfig
source $MOZBUILD/mozilla/mozconfig.common

<span class="dhash">##</span> for SeaMonkey build
ac_add_options --enable-application=${COMM:-}suite
mk_add_options MOZ_OBJDIR=$MOZBUILD/$REL/seamonkey-build-dir

EOF
)
</code>

<p>
mozconfig.thunderbird:
<br>
<code class="gray">(cd $MOZBUILD/$REL/comm-$REL
cat &gt; mozconfig.thunderbird &lt;&lt; "EOF"
<span class="dhash">##</span> include the common mozconfig
source $MOZBUILD/mozilla/mozconfig.common

<span class="dhash">##</span> for Thunderbird build
ac_add_options --enable-application=${COMM:-}mail
mk_add_options MOZ_OBJDIR=$MOZBUILD/$REL/thunderbird-build-dir

EOF
)
</code>


<p>
Bind the mozilla repository into the comm-$REL tree - linking confuses the build for the ${_topsrcdir} value.
<br>
Needed for SeaMonkey/Thunderbird builds, and to simplify the use of compare-locales for localization.
<br>
<code class="gray">(cd $MOZBUILD/$REL/comm-$REL
mkdir -p mozilla
mount -B $MOZBUILD/mozilla mozilla)
</code>

<p>
<b>mozilla as topsrcdir</b>
<br>
The comm-$REL directory needs to be placed as a comm directory in mozilla for SM2.57, and TB64 onwards [maybe earlier - I didn't build TB62-63].
<br>
This won't be used for, nor affect, builds of prior versions.
<br>
<code class="gray">mkdir -p $MOZBUILD/$REL/comm-$REL/mozilla/comm
mount -B $MOZBUILD/$REL/comm-$REL $MOZBUILD/$REL/comm-$REL/mozilla/comm
</code>

<p>
Remove any stale configure file:
<br>
<code class="gray">rm -f $MOZBUILD/mozilla/configure
</code>
<p>

<!--
User preferences - start
-->
<a name="close_prefs"></a>
<br>
<span class="tabs prefs"><a href="#Prefs">User preferences</a></span>
<div id="Prefs" class="tab"><div class="b_prefs"><span class="tabs"><a href="#close_prefs">close</a></span>
<!-- leave this space -->
<b>User preferences options</b>
<b>[1]</b> To enable <a class="extlink" href="https://wiki.mozilla.org/Electrolysis">e10s</a> by default:
<code class="green">cd $MOZBUILD
<span class="dhash">##</span> <b>Firefox</b>:
sed -i 's|pref("browser.tabs.remote.autostart", false);|pref("browser.tabs.remote.autostart", true);|' mozilla/browser/app/profile/firefox.js

<span class="dhash">##</span> <b>SeaMonkey</b>:
echo 'pref("browser.tabs.remote.autostart", true);' >> $REL/comm-$REL/suite/browser/browser-prefs.js
echo 'pref("browser.tabs.remote.desktopbehavior", true);' >> $REL/comm-$REL/suite/browser/browser-prefs.js
</code>
<b>[2]</b> Where the server or meta tags don't identify file encoding, setting default fallback encoding to UTF-8 has been <a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=967981#c4">deliberately blocked</a>.
To enable default fallback encoding to be set to UTF-8:
<code class="green"><span class="dhash">##</span> <b>Firefox and SeaMonkey</b>:
<span class="dhash">##</span> remove UTF8 block:
[[ $MAJ_VER -ge 56 ]] &amp;&amp; \
sed -i 's|IsAsciiCompatible() .*$|IsAsciiCompatible() ) {|;/UTF_8/d' mozilla/dom/encoding/FallbackEncoding.cpp || \
sed -i 's|(mFallback).*$|(mFallback)) {|;/UTF-8/d' mozilla/dom/encoding/FallbackEncoding.cpp

<span class="dhash">##</span> set "Fallback Text Encoding" to 'Unicode' by default
<span class="dhash">##</span> otherwise, "Fallback Text Encoding" will default to 'Default for Current Locale':
sed -i 's|fallback.override.*$|fallback.override",      "UTF-8");|' mozilla/modules/libpref/init/all.js

<span class="dhash">##</span> <b>Firefox</b>:
<span class="dhash">##</span> To allow manual selection of UTF-8, add Unicode option to "Preferences|Content|Fonts &amp; Colors|Advanced|Fallback Text Encoding" menu:
[[ $MAJ_VER -lt 56 ]] &amp;&amp; line_no=272 || line_no=293
sed -i "${line_no}i\            &lt;menuitem label=\"\&amp;languages.customize.Fallback.unicode;\"     value=\"UTF-8\"/&gt;" mozilla/browser/components/preferences/fonts.xul
sed -i '104i&lt;!ENTITY languages.customize.Fallback.unicode     "Unicode"&gt;' mozilla/browser/locales/en-US/chrome/browser/preferences/fonts.dtd
<span class="dhash">##</span> replace/remove 'legacy' reference in menu:
sed -i 's|Legacy|Unidentified|;s|legacy content|content|' mozilla/browser/locales/en-US/chrome/browser/preferences/fonts.dtd
<span class="dhash">##</span> Change '&hellip; {my,your} selections &hellip;' to '&hellip; the selections &hellip;'
sed -i 's| [a-z]* selections| the selections|' $MOZBUILD/mozilla/browser/locales/en-US/chrome/browser/preferences/{colors,fonts}.dtd

<span class="dhash">##</span> <b>SeaMonkey</b>:
<span class="dhash">##</span> To allow manual selection of UTF-8, add Unicode option to "Preferences|Browser|Languages|Fallback Text Encoding" menu:
sed -i '116i\            &lt;menuitem label="\&FallbackCharset.unicode;"     value="UTF-8"/>' $REL/comm-$REL/suite/common/pref/pref-languages.xul
sed -i '37i&lt;!ENTITY FallbackCharset.unicode      "Unicode">' $REL/comm-$REL/suite/locales/en-US/chrome/common/pref/prefutilities.dtd
<span class="dhash">##</span> and for "Preferences|Mail &amp; Newsgroups|Text Encoding" menu:
sed -i '98i\            &lt;menuitem label="\&FallbackCharset.unicode;"     value="UTF-8"/>' $REL/comm-$REL/suite/mailnews/prefs/pref-character_encoding.xul
sed -i '60i\            &lt;menuitem label="\&FallbackCharset.unicode;"     value="UTF-8"/>' $REL/comm-$REL/suite/mailnews/prefs/pref-character_encoding.xul
<span class="dhash">##</span> replace/remove 'legacy' reference in menu:
sed -i 's|Legacy|Unidentified|;s|legacy content|content|' $REL/comm-$REL/suite/locales/en-US/chrome/common/pref/pref-languages.dtd
sed -i 's|Legacy|Unidentified|' $REL/comm-$REL/suite/locales/en-US/chrome/common/help/cs_nav_prefs_navigator.xhtml

<span class="dhash">##</span> <b>Thunderbird</b>:
<span class="dhash">##</span> Change '&hellip; {my,your} selections &hellip;' to '&hellip; the selections &hellip;'
sed -i 's| [a-z]* selections| the selections|' $REL/comm-$REL/mail/locales/en-US/chrome/messenger/preferences/colors.dtd
</code>
<b>[3]</b> To include the SeaMonkey search box by default:
<code class="green"><span class="dhash">##</span> <b>SeaMonkey</b>:
sed -i 's|nav-bar-inner,|&amp;search-container,|' $REL/comm-$REL/suite/browser/navigator.xul
</code>
<b>[4]</b> Extensions - Chatzilla &amp; Inspector:</span>
<b><i>only for esr52</i></b>
Chatzilla can be built into Firefox, but can't be enabled without turning off Mozilla verification for extensions <span class="comment">[xpinstall.signatures.required;false]</span> - so it's not included in this build. As a download from Mozilla addons, it IS verified.
The default extensions for SeaMonkey are "inspector irc gio" <span class="comment">[suite/confvars.sh:MOZ_EXTENSIONS_DEFAULT=" inspector irc gio"]</span>.

<b>[5]</b> For esr52/60, set SeaMonkey and Thunderbird versions to correspond to the mozilla [FF] release on which they are based:
<code class="green"><span class="dhash">##</span> <b>SeaMonkey/Thunderbird</b>:
[[ $REL == esr* ]] &amp;&amp; {
echo 2.$[$MAJ_VER-3].$(cat $MOZBUILD/mozilla/browser/config/version.txt|cut -d. -f2-) > $MOZBUILD/$REL/comm-$REL/suite/config/version.txt
cp $MOZBUILD/mozilla/browser/config/version.txt $MOZBUILD/$REL/comm-$REL/mail/config/version.txt
}
</code>
<b>[6a]</b> For esr52, set new tab page to blank:
<code class="green"><span class="dhash">##</span> <b>Firefox</b>:
[[ $REL == esr52 ]] &amp;&amp; \
echo "body { display:none; }" > $MOZBUILD/mozilla/browser/base/content/newtab/newTab.css
</code>
<b>[6b]</b> Change default page options for FF57+:
Ref. aboutNewTabService.js:
<code class="console"> * 1. Browser chrome access:
 *
 * When the user issues a command to open a new tab page, usually clicking a button
 * in the browser chrome or using shortcut keys, the browser chrome code invokes the
 * service to obtain the newtab URL. It then loads that URL in a new tab.
 *
 * When not overridden, the default URL emitted by the service is "about:newtab".
 * When overridden, it returns the overriden URL.
 *
 * 2. Redirector Access:
 *
 * When the URL loaded is about:newtab, the default behavior, or when entered in the
 * URL bar, the redirector is hit. The service is then called to return either of
 * two URLs, a chrome or the activity stream one, based on the
 * browser.newtabpage.activity-stream.enabled pref.
 *
 * NOTE: "about:newtab" will always result in a default newtab page, and never an overridden URL.
 *</code>
<code class="green"><span class="dhash">##</span> <b>Firefox</b>:
[[ $MAJ_VER -ge 57 ]] &amp;&amp; {
<span class="dhash">##</span> Default to blank page on start ...
sed -i 's|about:home|about:blank|' $MOZBUILD/mozilla/browser/branding/*/locales/browserconfig.properties
<span class="dhash">##</span> ... and stop the privacy page loading:
sed -i 's|true|false|' $MOZBUILD/mozilla/toolkit/components/telemetry/datareporting-prefs.js
<span class="dhash">##</span> Load a blank page with Ctrl+T or new tab button - about:newtab continues to load the newtab page.
<span class="dhash">##</span> This <span class="appx">"about:blank";</span> replacement could be <span class="appx">"file:///path/to/my/newtab_page.html";</span> to load a customized page:
sed -i 's|"about:newtab";|"about:blank";|' $MOZBUILD/mozilla/browser/components/newtab/aboutNewTabService.js
}
</code>
<b>[7]</b> Record the mozilla revision that the SeaMonkey/Thunderbird builds are based on to add to application.ini in the packages.
<code class="green"><span class="dhash">##</span> <b>SeaMonkey/Thunderbird</b>:
export Gecko_Rev=$(hg bookmarks -R $MOZBUILD/mozilla/ | grep \* |cut -d: -f2)
</code>
<span class="tabs"><a href="#close_prefs">close</a></span>
</div>
</div>
<!--
User preferences - end
-->

<!--
Tooltip box - start
-->
<a name="close_ttip"></a>
<br>
<span class="tabs prefs"><a href="#Ttipbox">Gtk3 configuration</a><span style="vertical-align:-30%">&nbsp; Not a part of the build, just some customization options, for example where the defaults for gtk2/gtk3 differ &hellip;</span></span>
<p>
<div id="Ttipbox" class="tab"><div class="b_prefs"><span class="tabs"><a href="#close_ttip">close</a></span>
<!-- leave this space -->
[1] The default <b>tooltip box</b> for the default gtk3 Adwaita theme has white text on a black background with some padding:

<img
src="data:image/png;base64,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
We50eHBNvsTbYGu9vNdL6m3XdOEb7gez1bhCSIqGmTL1y9fq+yxtd9K0VKxo8dVVVjbrA3MW43y7XdSoGOzw0tJOvXJ3+f+hq10
s9Pd+7y126G0WoeeZLvgA/tpVKZUiWvuF/Dsm4ZJeUB2g8qP3xMBGKQ85h7qZ3Bcby51fXllWuuVpdBozIYtDqNWiGXUxSJ4zhJ
Dtg+LIYBz/M04664V9XS2iqlpEqFTCalZFKKklLCHYUD5QvhIwZAcACAYRhJUs3NzoaGhtra2rq6eobp/tT7gUF43o3b7bY3OVp
aWjmO1+s0UooULhL2kVPEQDEwgmuzhWE43vZoEACMICQ4LvGd8hBDEU9voukvPM+zrLvj/KrLNYC2EcME9ARMhKggwSFEBQkOIS
pIcAhRQYJDiAoSHEJUiF8eEfut5wgfERFIlpoG+1FPDJ35RogJ6lIRooIEhxAVJDiEqAzkuVSvyOVyl8uFRo3DEgzDpFJpS0uLl
2KirX6JRIIeETLswXHc8+3xInWpcrkcqe1pgOM4uVzuoYBIGU54f40IjhBPHAzDPCQXkTIcUtvTg+d1jfZSEaKCBIcQFSQ4hKgg
wSFEBQkOISpIcAhRQYJDiAoSHEJUkOAQooIEhxAVJDiEqAxGwS1ZsuT8+fMOh6Opqeny5cvx8fFPOqKBYenSpQaDobdfR48ezfM
8QXi5QnHmzJlff/21QqEAgNjY2AsXLjidzsbGxgsXLixevNiDI6/28/Pz3W632+3mOI7jOGH64MGD27dv3717d18X0iu8KPQ9nq
SkJKvVGhcX5+/vr9PpFi1aZDKZMjIyBmyBnxy3b98eN25cb7/2RXAajaampmbChAkAsHr16sbGxoSEBH9/f4VCsWzZsoaGhtdff
71HRziOd7c/ffr0wMDA7l4OHz78/vvvd3wlCOLatWvz58/v84J6EhUxf9etvhvyNXq9/p133omPjz927JgwJzc312azFRYW7t27
VyqVfvPNN8nJyTExMUFBQadOnVq7di3LslOnTt2xY4fBYGhtbf3DH/7wj3/8IzQ09Pbt26tWrYqLiwsODi4uLl6xYkUX3b/yyiv
vvvuuVqt1u91bt27961//2vnX3ix093X37t3ly5d/+eWXarXaarUmJyfv3LkTAG7cuJGUlPTZZ591LMi4ceMKCgpSU1NzcnJ68x
4fH5+SkqLVao8dO5aYmNjlYsa1a9eeOXPmxo0bSqUyIyPjrbfeys5ue1XV0aNHTSYTTdOdHV26dOnbb7/93e9+l5aWNm/evC6tn
ZiYuH//fpPJ5HmluN3uLVu2bNmy5eTJk31cj55E9eCBRYRPHwNdsGBBa2srjnft6Kuqql5//XVhG01JSQEAlUpVUVGxZMkSnU5X
X1//2muvAUBYWJjNZnvuuecCAwN5nl+/fj0AqNVqi8Uya9aszgalUqndbhe22hkzZjAMM2LEiM4FerTQo68DBw5s2LABAKKjo8+
dO/fPf/4TAAICApqbmztfikgQBM/zQuLp0buwdO+99x6O44GBgbW1tUuWLOnSDt9+++3ChQsBYObMmb1d6tjZUVBQEM/zb7/9No
Zh3TNcbm7unDlzulvokuGEgJubm8PDw7sX7hEPShhcYzi9Xm82m7tfvlddXe3n5ydMHz58GAAcDkdBQUFUVNTs2bOtVuvHH38MA
OXl5cePH+8Yygglm5qa7ty5M2rUqM4GXS7XyJEjP/30UwAoKipiGGbMmDHd4+lioUdfhYWFM2bMAIBZs2bt379/0qRJOI5HRUUV
FRX1doG/B+/vv/8+x3Emk+nkyZNRUVGda2m12oiIiPPnzwsNZbPZvN5AICT1w4cPd87usbGxJpPJZDJFR0cfO3bMZDKVlZV5tuN
yua5evTpt2jTPxfqCqDfReMVsNgcFBUkkki5dSXBwsMXSlibr6+uFCbvdPmrUqMDAwNDQ0Lt37wozZTJZbm6uMN3Y2ChMcBwn6f
b26jfeeGPx4sVCNqUoqnta7W6hR1+nTp3605/+JJFIZs2atX379hUrVkycODEqKqqjM+2R3rx3dHD19fVdNhKj0ciybF1dHQBYL
BaDwaBSqRwOhwcvAh1NJ5CXl5eXlwcAubm5+/fvP3XqlFcLAGA2m3sc8PWXwSW4c+fOuVyuX/ziFwcPPnyzalRUVGBgYGFhoUwm
A4CAgID79+8DgJ+fX11dXU1Nze3btyMjIzvb8do0CxYsSEtLmzJlSkVFBY7jfVltANCjLwC4devWnDlzpFJpbW1tUVHRT3/605k
zZ2ZlZT2Gdz8/v6qqKgAwGAyCtnrkypUrDQ0Nq1at2rFjR8fM+fPnjx8/fteuXV0K92unzdcMri7V6XSmpKRkZWUJO19arTYmJu
bIkSObN2/u2PRXrlwJAH5+fvPmzTt9+vQXX3wRFBQkjIiVSuWBAwcmTZrk1dGIESMsFsu9e/dwHE9NTeV5XqlUeq3Vm6/CwsK0t
LT//Oc/AFBUVBQbGyuTyW7evNm5LsdxLMtqtVrP3juW7tVXXz19+nRnC2azWSKR+Pv7A4DL5UpKSsrIyFi3bt0zzzyj0Wji4uIO
Hz589+7dzo4GEKPR6HX3oi8MLsEBwN69e+Pj4+Pj48vKyqqqqlJSUpKTk3//+993FKipqbl+/fq1a9eOHTuWn59vt9ujo6M3bdp
0586dkpISq9V6/fp1r14++uij6urqO3fuFBcXl5aWHjp0KDs7+9lnn/VcqzdfBQUF06dPP3PmDABcvnx5ypQpBQUFXepyHPfhhx
9+/vnna9eu7dF7eHi4y+WqqakpKSnpWLou3ktLSzsGUtnZ2UuWLImJibl582ZlZWV8fPyiRYvy8vI6O/K8OIsWLepjfyqVSidPn
iwMH78nA/kUcw+MGBHw/Y2MHj26oqKCIAhxXgw8CNm0aVN4ePjy5ctF9rt48eK0tLTnn3++j+U9iGrQZTivPM1v/9i5c+fMmTO9
ZuKBhSCIjRs3bty4cWCsXblyaUAMIUSgsbFx+fLlR44ceemll5qbm8Vxum3btrNnz544caLvVTyISqQboZ/mtPQU4kFUQ69LRQx
pkOAQooIEhxAVJDiEqCDBIUQFCQ4hKkhwCFFBgkOIikiCQwd+nx48r2uRBCeVSsVxhHjieF7X6CnmiIFksDzFHABYlpXJZKhvHa
5gGCaTybxeOYZe7oYQFbSXihAVJDiEqCDBIUQFCQ4hKkhwCFH5fyn0QwztbDFaAAAAAElFTkSuQmCC" alt="">

which is set by the tooltip section in <i>gtk/theme/Adwaita/gtk-contained.css</i> in the gtk3 source:
<pre>
tooltip {
  padding: 4px;
  /* not working */
  border-radius: 5px;
  box-shadow: none;
  text-shadow: 0 1px black; }
tooltip.background {
  background-color: rgba(0, 0, 0, 0.8);
  background-clip: padding-box;
  border: 1px solid rgba(255, 255, 255, 0.1); }
tooltip decoration {
  background-color: transparent; }
tooltip * {
  padding: 4px;
  background-color: transparent;
  color: white; }
</pre>Overriding this with:<br><pre>
tooltip {
  border-radius: 0px;
  text-shadow: none;}
tooltip.background {
  background-color: #eee1b3;
  border: 1px solid gray;}
tooltip * {
  padding: 0px;
  color: black;}
</pre>in <b><i>~/.config/gtk-3.0/gtk.css</i></b>, will show the tooltip as:

<img
src="data:image/png;base64,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" alt="">

[2] <b><i>~/.config/gtk-3.0/gtk.css</b></i>
To show scroll-bar stepper icons and set the slider width/height, add:
<pre>
* {
  -GtkScrollbar-has-backward-stepper: true;
  -GtkScrollbar-has-forward-stepper: true; }
scrollbar slider {
  min-width: 10px;
  min-height: 10px; }
scrollbar.horizontal slider {
  min-width: 40px; }
scrollbar.vertical slider {
  min-height: 40px; }
</pre>
[3] <b><i>/etc/gtk-3.0/settings.ini</b></i>
To set 'Print to &hellip;' options, and scroll by one page when clicking in the scroll-bar, add:
<pre>
[Settings]
gtk-print-backends=lpr,file,cups
gtk-primary-button-warps-slider=false
</pre>
See ../gtk-doc/html/gtk3/GtkSettings.html for defaults and more options.
<!-- leave this space -->
<span class="tabs"><a href="#close_ttip">close</a></span>
</div>
</div>
<!--
Tooltip box - end
-->

<!--
Localization - start
-->
<a name="close_l10n"></a>
<br>
<span class="tabs locn"><a href="#l10n">Localization</a><span style="vertical-align:-30%">&nbsp;</span></span>
<p>
<div id="l10n" class="tab"><div class="b_locn"><span class="tabs"><a href="#close_l10n">close</a></span>
<!-- leave this space -->
<b>compare-locales</b> - needs python-setuptools.
compare-locales will identify new files in the en-US locale which aren't in the $L10N locale; and add any new entity strings that are in the en-US locale files but not in the $L10N locale files to copies in the merge-$L10N directory.
The following process extends that to <b>copy new files</b> to the merge-$L10N directory and display them for editing the localization strings.
And displays any <b>new strings added</b> to existing files to show any that need localizing.

<b>Download, build, and install compare-locales.</b>
<i>Note:</i> that this process is set up to use compare-locales v1.2.3, so the build has been reverted to changeset e413c5aba051.
<code class="red">(cd $MOZBUILD/sources
hg clone https://hg.mozilla.org/l10n/compare-locales/ compare-locales
cd compare-locales
hg checkout e413c5aba051
python setup.py build install)
</code>

<b>Known issues</b>
Remove any previously created temporary file lists and merge-$L10N directory:
<code class="red">rm -f $MOZBUILD/l10n/* 2>/dev/null
rm -rf $MOZBUILD/l10n/merge-$L10N
rm -rf $MOZBUILD/l10n/wip/*
</code>
To build to a release version:
<code class="green"><b>Either:</b>
For FFesr52, download the l10n_changesets.txt file which contains the l10n revision that it was built to [probably hasn't changed since 52.0]:
<code class="red"><span class="dhash">##</span> This defaults to the current repo Firefox version which won't be a valid release candidate unless the bookmark has been set to the appropriate revision - see '<a href="#known_rel">Building to a specific revision</a>' &hellip;
<span class="dhash">##</span> &hellip; override with <b>FF_VER</b>=xx.x[.x] for an earlier version
<b>FF_VER</b>=$(cat $MOZBUILD/mozilla/browser/config/version.txt)
echo $FF_VER

[[ $REL == esr52 ]] &amp;&amp; {
cd $MOZBUILD/sources/
<span class="dhash">##</span> [1] Get list of release candidates and find the latest for this esr52 version
wget -O candidates.html https://archive.mozilla.org/pub/firefox/candidates/
REL_CAND=$(grep $FF_VER candidates.html|grep -v b[0-9] | grep -o ${FF_VER}esr-candidates | head -n1)

<span class="dhash">##</span> [2] Get list of release candidate builds and find the latest
wget -O $REL_CAND.html https://archive.mozilla.org/pub/firefox/candidates/$REL_CAND/
BUILD=$(grep build $REL_CAND.html|tail -n1|cut -d"/" -f6)

<span class="dhash">##</span> [3] Download the .txt file which includes the changeset reference for that build and find the changeset
wget -O ${FF_VER}_${BUILD}_l10n_changesets.txt https://archive.mozilla.org/pub/firefox/candidates/$REL_CAND/$BUILD/l10n_changesets.txt 
export L10N_CS=$(grep $L10N ${FF_VER}_${BUILD}_l10n_changesets.txt|cut -d" " -f2)

<span class="dhash">##</span> Revert l10n repo to changeset
hg checkout -r $L10N_CS -C -R $MOZBUILD/l10n/$L10N/

<span class="dhash">##</span> Check that l10n repo is at the correct changeset:
<span class="dhash">##</span> echo $L10N_CS ; hg parent -R $MOZBUILD/l10n/$L10N/
}
</code>
<b>Or:</b>
From FF59.0, the corresponding l10n revisions are contained in a .json file:
<code class="red">[[ $MAJ_VER -ge 59 ]] &amp;&amp; {
export L10N_CS=$(grep -A 13 $L10N $MOZBUILD/mozilla/browser/locales/l10n-changesets.json | grep revision | colrm 1 21 |sed 's|"||')
hg checkout -r $L10N_CS -C -R $MOZBUILD/l10n/$L10N/
}
</code>
<b>Or:</b>
For a known changeset:
<code class="red"><span class="dhash">##</span> <b>Firefox</b>:
export <b>L10N_CS</b>=<span class="comment">xxxxxxxxxxxx</span>
hg checkout -r $L10N_CS -C -R $MOZBUILD/l10n/$L10N/
</code></code>
<i>compare-locales</i> doesn't pick up any locale.version change in chatzilla.properties, so to ensure that it matches the en-US string:
<code class="green"><code class="red">[[ $REL == esr52 ]] &amp;&amp; \
sed -i "s|locale.version =.*$|$(grep "locale.version =" $MOZBUILD/mozilla/extensions/irc/locales/en-US/chrome/chatzilla.properties)|" \
$MOZBUILD/l10n/$L10N/extensions/irc/chrome/chatzilla.properties
</code></code>
Add 'irc' paths for <i>compare-locales</i> to include Chatzilla when creating merge-$L10N:
<code class="green"><code class="red">[[ $REL == esr52 ]] &amp;&amp; \
sed -i 's|devtools_client.*$|&amp;\nextensions_irc = mozilla/extensions/irc/locales/l10n.ini|' $MOZBUILD/$REL/comm-$REL/suite/locales/l10n.ini
sed -i 's|devtools/client",|&amp; "extensions/irc",|' $MOZBUILD/$REL/comm-$REL/suite/locales/filter.py
</code></code>
This string in en-GB chatzilla.properties is not consistently localized in all revisions, so make sure:
<code class="green"><code class="red">[[ $REL == esr52 &amp;&amp; $L10N == en-GB ]] &amp;&amp; \
sed -i 's|msg.mnu.motifs.*$|msg.mnu.motifs     = Co\&amp;lour Scheme|' $MOZBUILD/l10n/$L10N/extensions/irc/chrome/chatzilla.properties
</code></code>

<b>Comparing en-US and $L10N localizations</b> &hellip;
Create a list of default en-US localization files:
<code class="red">tree -fi $MOZBUILD/$REL/comm-$REL/{mozilla,suite,mail} | grep en-US | grep ".*\..*$" > $MOZBUILD/l10n/en-US-l10n-files
</code>
&hellip; <b>copy new files</b> &hellip;
Run compare-locales and identify the new files found &hellip;
<code class="red">echo -e 'mozilla/browser\nsuite\nmail' | while read line ; do
compare-locales -m $MOZBUILD/l10n/merge-$L10N $MOZBUILD/$REL/comm-$REL/$line/locales/l10n.ini $MOZBUILD/l10n $L10N \
| tee $MOZBUILD/l10n/$(echo $line | tr / _)-compare-locales-output | grep -B 1  "add and localize this file" \
| grep -Ev "\-\-|localize" > $MOZBUILD/l10n/$(echo $line | tr / _)-new-files
done
</code>
&hellip; find paths of new files and remove duplications where suite/mail use mozilla files &hellip;
<code class="red">echo -e "mozilla_browser\nsuite\nmail" | while read line ; do
cat $MOZBUILD/l10n/$line-new-files | while read line ; do
grep $line $MOZBUILD/l10n/en-US-l10n-files
done ; done | sort -u | tee $MOZBUILD/l10n/new-files-en-US-path \
| sed 's|locales/en-US/||' \
| sed "s|^.*/comm-$REL/mozilla|$MOZBUILD/l10n/merge-$L10N|" \
| sed "s|^.*/comm-$REL|$MOZBUILD/l10n/merge-$L10N|" > $MOZBUILD/l10n/new-files-$L10N-path
</code>
&hellip; and create any new directories in merge-$L10N required by new files &hellip;
<code class="red">cat $MOZBUILD/l10n/new-files-$L10N-path | while read line
do
echo $line | rev | cut -d/ -f2- | rev
done | sort -u | while read line
do
[[ ! -d $line ]] &amp;&amp; mkdir -p $line
done
</code>
&hellip; and copy the new en-US files to the merge-$L10N directory &hellip;
<code class="red">(cd $MOZBUILD/l10n/
paste -d ' ' new-files-en-US-path new-files-$L10N-path | while read line
do
cp $line
done)
</code>
&hellip; and then edit them for localizations:
<code class="red"><b>MY_FAV_EDITOR</b>=kate
$MY_FAV_EDITOR $(cat $MOZBUILD/l10n/new-files-$L10N-path)
</code>

&hellip; <b>new strings added</b>
<i>compare-locales</i> will append any new lines to existing localization files while copying them to merge-$L10N.
The following displays the additional lines to show whether any of them need localizing.
Edit the <b><i>merge-$L10N</b></i> file because that has priority over the equivalent $L10N file during the build [except Chatzilla - see next].
<code class="red">(cd $MOZBUILD/l10n/
<span class="dhash">##</span> list the files that have been added to:
echo -e 'mozilla_browser\nsuite\nmail' | while read line ; do
grep "adding to" $line-compare-locales-output | sed 's|adding to ||g' | tee -a adding-to | sed 's|merge-||g' >> added-from
done

<span class="dhash">##</span> remove duplicate files and display the additional lines:
paste -d " " added-from adding-to | sort -u | while read line
do
diff -U 0 $line
done > added-diffs

<span class="dhash">##</span> display the diff in a syntax highlighting editor to more easily show lines that might need localizing:
$MY_FAV_EDITOR added-diffs)
</code>

A further issue with <i>compare-locales</i> is that the SeaMonkey build doesn't include any Chatzilla files from merge-$L10N.
So, copy any new or modified 'irc' files from merge-$L10N to $L10N.
<code class="green"><code class="red">[[ $REL == esr52 ]] &amp;&amp; \
(cd $MOZBUILD/l10n/$L10N/
cp -a ../merge-$L10N/extensions/irc/* extensions/irc)
</code></code>

<b>Set up searchplugins for locale.</b>
This is en-GB specific, but should be adaptable for other locales &hellip;
Set up google search on google.co.uk:
<code class="red">(cd $MOZBUILD/mozilla/browser/locales/searchplugins/
cat google.xml | sed 's|google.com|google.co.uk|g' > google-$L10N.xml)
</code>
<a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1303636">eBay was removed</a> from the list of built-in searchplugins, although it has been re-instated with a nondescript icon.
To recover the previous icon for this personal build, extract the file from a changeset that contains it:
<code class="red">(cd $MOZBUILD/l10n/$L10N
hg revert -r 1a7204 mail/searchplugins/eBay-$L10N.xml
mv mail/searchplugins/eBay-$L10N.xml $MOZBUILD/mozilla/browser/locales/searchplugins)
</code>
Set the default Firefox searchplugins of choice:
<code class="red">sed -i "s|.*chambers-en-GB.*|          \"google-$L10N\", \"eBay-$L10N\", \"amazon-$L10N\", \"ddg\", \"wikipedia\", \"bing\", \"chambers-$L10N\"|" $MOZBUILD/mozilla/browser/locales/search/list.json
</code>

<b>To enable default fallback encoding to be set to UTF-8</b>:
Requires <b>[2]</b> in the previous section '<a href="#Prefs">User preferences</a>' to have been set up.
<code class="green"><code class="red"><span class="dhash">##</span> <b>Firefox</b>:
<span class="dhash">##</span> Modify files in the $L10N and merge-$L10N directories

(cd $MOZBUILD/l10n/
sed -i -e 's|Legacy|Unidentified|;s|legacy content|content|' \
-e '104i&lt;!ENTITY languages.customize.Fallback.unicode     "Unicode">' \
{,merge-}$L10N/browser/chrome/browser/preferences/fonts.dtd  2>/dev/null)
</code>
<code class="red"><span class="dhash">##</span> <b>SeaMonkey</b>:
<span class="dhash">##</span> Modify files in the $L10N and merge-$L10N directories

(cd $MOZBUILD/l10n/
sed -i '37i&lt;!ENTITY FallbackCharset.unicode      "Unicode">' {,merge-}$L10N/suite/chrome/common/pref/prefutilities.dtd 2>/dev/null
sed -i 's|Legacy|Unidentified|;s|legacy content|content|' {,merge-}$L10N/suite/chrome/common/pref/pref-languages.dtd 2>/dev/null
sed -i 's|Legacy|Unidentified|' {,merge-}$L10N/suite/chrome/common/help/cs_nav_prefs_navigator.xhtml 2>/dev/null)
</code></code>

Change '&hellip; {my,your} selections &hellip;' to '&hellip; the selections &hellip;'
<code class="green"><code class="red"><span class="dhash">##</span> <b>Firefox</b>:
sed -i 's| [a-z]* selections| the selections|' $MOZBUILD/l10n/{,merge-}$L10N/browser/chrome/browser/preferences/{colors,fonts}.dtd

<span class="dhash">##</span> <b>Thunderbird</b>:
sed -i 's| [a-z]* selections| the selections|' $MOZBUILD/l10n/{,merge-}$L10N/mail/chrome/messenger/preferences/colors.dtd
</code></code>

<b>Workaround for FF57+.</b>

Firstly, a brief explanation.
Up to FF56, it was possible to build a single localized version using 
ac_add_options --enable-ui-locale=
ac_add_options --with-l10n-base=
and
LOCALE_MERGEDIR=

This enabled the additional lines and files identified by compare-locales to be localized prior to the build.

The localization build method was changed for FF57 [<a class="extlink" href="https://blog.mozilla.org/l10n/2017/08/04/create-a-localized-build-locally/">blog</a>, <a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1402564">bugzilla</a>, <a class="extlink" href="https://firefox-source-docs.mozilla.org/build/buildsystem/locales.html">single locale build</a>], but I'm not sure it would allow a pre-set merge-ab-CD directory which is necessary for checking localization.

What I've done is continue from the previous setup for using localized files and copied them to the corresponding en-US locations so the default en-US build uses localized files. A minor issue is that internal localization directories are referenced as en-US, but the dictionary, texts and messages in the final build are in the intended localization.
<code class="red"><span class="dhash">##</span> Copy en-US and $L10N to a working area:
while read file
do
cp -a --parents $file $MOZBUILD/l10n/wip
done &lt; $MOZBUILD/l10n/en-US-l10n-files
cp -a --parents $MOZBUILD/l10n/$L10N $MOZBUILD/l10n/wip

<span class="dhash">##</span> Remove unwanted mercurial files:
rm -rf $MOZBUILD/l10n/wip$MOZBUILD/l10n/$L10N/.hg*

<span class="dhash">##</span> Overwrite wip&hellip;$L10N with merge-$L10N files:
cp -a $MOZBUILD/l10n/merge-$L10N/* $MOZBUILD/l10n/wip/$MOZBUILD/l10n/$L10N

<span class="dhash">##</span> Create a list of all localized files [unchanged, added to, and new files]:
(cd $MOZBUILD/l10n/wip/
tree -fi * | grep ".*\..*$" | grep -v en-US > $MOZBUILD/l10n/wip/$L10N-l10n-files)

<span class="dhash">##</span> Copy localized files to en-US locations with a test run if required:
<b>TEST_CP=no</b>
<span class="dhash">##</span> Read from the list of localized files ...
  cat $MOZBUILD/l10n/wip/$L10N-l10n-files | while read line
  do
<span class="dhash">##</span> ... extract the filename ...
  FILE=$(echo $line | rev | cut -d/ -f1 | rev)
<span class="dhash">##</span> ... find the path of all en-US file occurrences ...
  en_US_file_PATHS=$(grep $FILE $MOZBUILD/l10n/en-US-l10n-files)
<span class="dhash">##</span> ... for each en-US file occurrence, convert it to $L10N path/filename ...
    for en_US_file in $en_US_file_PATHS
    do
    ab_CD_file_PATH=$(echo $en_US_file \
    | sed 's|locales/en-US/||' \
    | sed "s|^.*/comm-$REL/mozilla|$MOZBUILD/l10n/$L10N|" \
    | sed "s|^.*/comm-$REL|$MOZBUILD/l10n/$L10N|")
<span class="dhash">##</span> ... and if the conversion matches the list entry, copy that $L10N file to en-US
      for path in $ab_CD_file_PATH
      do
      [[ $TEST_CP == no ]] &amp;&amp; \
      {
      [[ $path == /$line ]] &amp;&amp; cp $MOZBUILD/l10n/wip/$line $en_US_file
      true
      } || \
      {
      echo /$line
      echo $path
      [[ $path == /$line ]] &amp;&amp; echo -e "would copy \n $MOZBUILD/l10n/wip/$line \nto \n $en_US_file"
      echo
      }
      done
    done
  done
</code>
Set the default Firefox searchplugins of choice by overriding the en-US string:
<code class="red">cp $MOZBUILD/mozilla/browser/locales/search/list.json $MOZBUILD/l10n/wip
sed -i "s|.*amazondotcom.*|          \"google-$L10N\", \"eBay-$L10N\", \"amazon-$L10N\", \"ddg\", \"wikipedia\", \"bing\", \"chambers-$L10N\"|" $MOZBUILD/mozilla/browser/locales/search/list.json
</code>
Set the default SeaMonkey searchplugins of choice - source them from the browser locale and the L10N repo:
<code class="red">rm $MOZBUILD/$REL/comm-$REL/suite/locales/en-US/searchplugins/*
cp $MOZBUILD/mozilla/browser/locales/searchplugins/{{eBay,google}-$L10N,bing,wikipedia,ddg}.xml $MOZBUILD/$REL/comm-$REL/suite/locales/en-US/searchplugins/
cp $MOZBUILD/l10n/$L10N/mail/searchplugins/amazon-$L10N.xml $MOZBUILD/$REL/comm-$REL/suite/locales/en-US/searchplugins/
echo "ddg
amazon-$L10N
eBay-$L10N
google-$L10N
wikipedia
bing" > $MOZBUILD/$REL/comm-$REL/suite/locales/en-US/searchplugins/list.txt
</code>
<span class="tabs"><a href="#close_l10n">close</a></span>
</div>
</div>
<!--
Localization - end
-->

<!--
32-bit - start
-->
<a name="close_32bit"></a>
<br>
<span class="tabs th2"><a href="#Th2bit">32-bit build</a><span style="vertical-align:-30%">&nbsp;&nbsp;Additional configuration where [1] a 64-bit kernel is being used; and [2] a chroot is to be used for building within a 64-bit system.</span></span>
<p>
<div id="Th2bit" class="tab"><div class="b_32bit"><span class="tabs"><a href="#close_32bit">close</a></span>
<!-- leave this space -->
[1] Building with a 64-bit kernel:
<code class="thtwo">[[ $(uname -m) == x86_64 ]] &amp;&amp; \
(cd $MOZBUILD/mozilla
cat &gt;&gt; mozconfig.common &lt;&lt; "EOF"
<span class="dhash">##</span> For 32 bit version
ac_add_options --target=i686-pc-linux-gnu
ac_add_options --host=i686-pc-linux-gnu

EOF
)
</code>
[2] Set up and switch to chroot, if required:
<code class="thtwob"><code class="thtwo">ARCH=i686
</code>
Download and install the 32-bit version of rust:
<code class="thtwo">cd $MOZBUILD/sources/
wget -O rust.html https://forge.rust-lang.org/other-installation-methods.html
URL=$(grep "rust-[1-9].*$ARCH-unknown-linux-gnu.tar.gz\">" rust.html | sed 's|.*href="||;s|">.*$||;s|tar.gz|tar.xz|')
wget $URL

tar xf rust*$ARCH-unknown-linux-gnu.tar.xz
cd rust*$ARCH-unknown-linux-gnu
./install.sh --prefix=$MOZBUILD/sources/rust-$ARCH --components=rustc,cargo,rust-std-$ARCH-unknown-linux-gnu
</code>
<code class="thtwo">mkdir $MOZBUILD/chrt
CHRT=$MOZBUILD/chrt
</code>
<b><i>Either</i></b>:
Build in a 32-bit environment which has been installed in $CHRT.

<b><i>Or</i></b>:
Mount a 32-bit installation from
either VFS (offset according to fdisk setup)
<code class="thtwob">mount -o loop -o offset=$((2048*512)) VFS $CHRT</code>
or partition:
<code class="thtwob">mount /dev/sdx $CHRT</code>

<b><i>Then</i></b>:
<code class="thtwo">mkdir -p $CHRT$MOZBUILD/{mozilla,sources}
mkdir -p $CHRT$MOZBUILD/$REL/{packaging-{FF,SM,TB},built,comm-$REL/mozilla}
<span class="red">mkdir -p $CHRT$MOZBUILD/l10n</span>

<span class="dhash">##</span> mount the required existing directories into the chroot:
mount -B /dev $CHRT/dev
mount -t proc proc $CHRT/proc
mount -B $MOZBUILD/mozilla $CHRT$MOZBUILD/mozilla
mount -B $MOZBUILD/sources $CHRT$MOZBUILD/sources
mount -B $MOZBUILD/$REL/comm-$REL $CHRT$MOZBUILD/$REL/comm-$REL
<span class="red">mount -B $MOZBUILD/l10n $CHRT$MOZBUILD/l10n</span>

chroot $CHRT /bin/bash
<code class="thtwo"><span class="dhash">##</span> Now, in the chroot:
source /etc/profile

<span class="dhash">##</span> Remove any stale configure file:
rm -f $MOZBUILD/mozilla/configure
<span class="dhash">##</span> set a dummy variable to be able to test whether the build is in a chroot
CHRT_TEST=" "
<span class="dhash">##</span> Bind the mozilla repository into the comm-$REL tree:
mount -B $MOZBUILD/mozilla $MOZBUILD/$REL/comm-$REL/mozilla
</code></code></code>
<span class="tabs"><a href="#close_32bit">close</a></span>
</div>
</div>
<!--
32-bit - end
-->
<p><br>
<b>Set up rust.configure</b> for i686.
<br>
This applies only to 52.x versions because for 53.x versions onwards, rust.configure includes i686-unknown-linux-gnu.
<br>
To avoid a "can't find crate for `std`" error:
<br>
<code class="thtwo">[[ $ARCH == i686 ]] &amp;&amp; [[ $MAJ_VER -eq 52 ]] &amp;&amp; \
sed -i 's|i586-unknown-linux-gnu|i686-unknown-linux-gnu|' $MOZBUILD/mozilla/build/moz.configure/rust.configure
</code>
<p><br>
<a name="BuildingFFReturn"></a>
<div style="background: #FFFADD;"><span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAADBElEQVR42qWTa0jTURiHs6sWSmnp
vCyZ2/9sS0vwkiuibFp20zStnBElzktKYSubWgyJCnVWaCS2LiRipXZDMyv8oq6yskRXXip1S2eR
TiXSLuj/11nESKpPHXg4nHNenvO+5zJltrvvf/HHhOLxIDep/mNRbN1An7zexMq1w2xsvcmwp+FD
vvxet8s/BaZs0RbZZa085MLjUVJQh4BSLaR3+7G+dgCSaiMCy3QobuoYLq84m/ntuaPVJEGf0nN+
VxKZUGUqJxKzFLh6Pgxb1IfgdqUNvFsG2JW9BbegEUlU2tNzH02VyTWTBNU7xGs7ZAS9qUIYjzLQ
F/AQkJ4Lt1O3MeNiK2w0LbDPeQjvjNsYGdTiU68aA032oRbBo1gm/108g3f7CIwqAv1xD7SnrsaZ
rBQ45DRggaoWnIPV4MSXQFN5AxjMRv+LaSctgrY4gVG/i8CQQtCnJHh/mo9j8eEgqWVwU1RhQVI5
bGXnYLM5DxV3LoI1FaK9Rmy0CHQywXj3DrpzAoEuWgjVuqVYvF2BOTEazJEVwTpUDes1WbCW7MX3
kRKwQ4dRfUHKfm92mvpT8CxCMPE6iqCHZvEkSIjSGAmcAlPgtukAQuTxcAhOg61PItz9ZPjSEYRx
gxCd1xaOWjKoDGZadBsJ3m4neCOjmSQSdCtE0KcT1MQJERoeAXtRNFTK5Rh76IrRxnloOc69YxGU
rCDKxpUEbWEEXTLKToJLwV6IEvrD3WMDHD3CwPeQ4lUxH0PXXdF5goeqreIjFkGGn5dDjZ/g49PA
X5JoWs5ugluRXkhe5g/1Bl/0ZhIM5ghgSGNQFSlim6OYVZNeosaT2fbAm7DmTMzlmM+kK8Z8LvR6
Exj07WWglzN4uVXA1ofw8/54yrTZJTs6594UCb42SAieB1HRJoL2cILOSILWcAY3VjDsfh7nPI11
+ZtgOmURf5Z1upLj3HyZzxurWiJgK334bLH3ws9qsevrSKe5hTRmGcXmn7/RvEjhUswD6UwrqzW0
l1D4FFuK1e/xPwCy1KrpkpT5rQAAAABJRU5ErkJggg=="><span style="vertical-align:20%"><b> Building Firefox [Nightly]</b></span></span>
<code class="gray">unset XCOMPILE
</code>
</code> <a name="close_FF_xcompile"></a>                                                    <!-- FF xcompile - start -->
<span class="tabs prefs"><a href="#FF_xcompile">Cross compiling</a></span><span style="vertical-align:-30%">&nbsp;&nbsp;additional setting up for cross compiling for the RPi3.</span>
<div id="FF_xcompile" class="tab">
<div class="b_prefs"><span class="tabs th2"><a href="#close_FF_xcompile">close</a></span>
<!-- leave this space -->
The additions fit into the build tree like this:
<code>$MOZBUILD
<span class="comment">├── sources
│   └── rust-&hellip;
│       └── lib
│           └── rustlib
│               ├── x86_64-unknown-linux-gnu</span>
│               ├── armv7-unknown-linux-gnueabihf	<i>armv7 crate</i>
│               └── aarch64-unknown-linux-gnu		<i>aarch64 crate</i>
└── $TARGET_SYSROOT					<i>bind mounted to sysroot</i> *

opt
└── cross-pi-gcc
    ├── bin						<i>cross compiler</i>
    └── sysroot *					<i>set in cross compiler build</i>
</code>
<br>
[1] Set variables for a 32-bit [armv7] or 64-bit [aarch64] build.
<code class="thtwob"><span class="dhash">##</span> <b>32-bit</b> hard float
<code class="green">export CRATE=armv7-unknown-linux-gnueabihf
<span class="dhash">##</span> don't use variables used by mozilla - confuses libloading for example ..
export X_TARGET=arm-linux-gnueabihf
export X_CC=$X_TARGET-gcc
export X_CXX=$X_TARGET-g++
export LIBDIRSUFFIX=""
<span class="dhash">##</span> Slack_base = where the Slackware packages a-y directories are:
export Slack_base=<span class="comment">/path_to_Slackware_arm_current</span>
export TARGET_SYSROOT=<span class="comment">FF-RPi3-arm-sysroot</span>
<span class="dhash">##</span> Set variable for the package name
export PKG_ARCH=<span class="comment">armv7_hf</span>
<span class="dhash">##</span> Disable webrtc for FF64+ on armv7 because of multiple definitions[&diamondsuit;] relating to arm webrtc code causing <a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1523162">linker error</a>
[[ $MAJ_VER -ge 64 ]] &amp;&amp; export DISABLE_WEBRTC='ac_add_options --disable-webrtc'
<span class="dhash">##</span> running elfhack during the build doesn't fail, but corrupts libxul.so
export DISABLE_ELFHACK='ac_add_options --disable-elf-hack'
</code>
<span class="dhash">##</span>[&diamondsuit;] If you're feeling lucky, just remove the duplicate code to include webrtc in the 32-bit build:
<code class="green">cd $MOZBUILD/mozilla
echo $'--- media/webrtc/trunk/webrtc/system_wrappers/source/cpu_features.cc
+++ media/webrtc/trunk/webrtc/system_wrappers/source/cpu_features.cc
@@ -70,13 +69,0 @@
-
-#if !defined(ANDROID)
-#ifdef WEBRTC_ARCH_ARM_V7
-uint64_t WebRtc_GetCPUFeaturesARM(void) {
-  return kCPUFeatureARMv7
-#ifdef WEBRTC_ARCH_ARM_NEON
-         | kCPUFeatureNEON
-#endif
-         | kCPUFeatureVFPv3;
-}
-#endif // WEBRTC_ARCH_ARM_V7
-#endif // !ANDROID
-
' | while read line
do
patch -p0
done

export DISABLE_WEBRTC=''
</code>
<span class="dhash">##</span> <b>OR:</b>
<span class="dhash">##</span> <b>64-bit</b>
<code class="green">export CRATE=aarch64-unknown-linux-gnu
export X_TARGET=aarch64-linux-gnu
<span class="dhash">##</span> -march=armv8-a+crc is the compiler default, so just add -mtune=cortex-a53
export X_CC="$X_TARGET-gcc -mtune=cortex-a53"
export X_CXX="$X_TARGET-g++ -mtune=cortex-a53"
export LIBDIRSUFFIX=64
export Slack_base=<span class="comment">/path_to_Slarm64</span>
export TARGET_SYSROOT=<span class="comment">FF-RPi3-aarch64-sysroot</span>
export PKG_ARCH=<span class="comment">aarch64</span>
<span class="dhash">##</span> webrtc builds ok for aarch64
export DISABLE_WEBRTC=''
<span class="dhash">##</span> 'disable-elf-hack' isn't an option for aarch64
export DISABLE_ELFHACK=''
</code>
</code>

[2] Additional rust requirements

For <b>rust</b>, host relates to the architecture that the program is built on, and target relates to the architecture that the program will run on.

rustc and cargo and the rust-std crate are already installed for x86 [host].
Download and install the target crate for building RPi3 apps.
This <b>must</b> be the same version as the host crate, and installed to the same prefix.
<code class="green">cd $MOZBUILD/sources/
RUST_VER=$(rustc -V|cut -d" " -f2)
<span style="color: #c50000;">wget https://static.rust-lang.org/dist/rust-std-$RUST_VER-$CRATE.tar.xz</span>

tar xf rust-std-$RUST_VER-$CRATE.tar.xz
cd rust-std-$RUST_VER-$CRATE
./install.sh --prefix=$MOZBUILD/sources/rust-$ARCH
</code>

[3] Cross compiler

The toolchain used is the custom built gcc cross compiler <a class="extlink" href="https://ray-v.github.io/tde-slackbuilds/cross-compiling-TDE-for-the-RPi3.html#gcc_x">here</a>, which also creates a RPi3 kernel headers package.

Set the cross tools directories
<code class="green">export XGCC_DIR=<span class="comment">/opt/cross-pi-gcc</span>
export SYSROOT=<span class="comment">$XGCC_DIR/sysroot</span>
</code>
<code class="green">installpkg <span class="comment">/tmp/</span>xgcc830-glibc2.29-4.19.27_RPi_headers-*.txz
</code>

There is an issue with the different limits.h priorities which seems to manifest itself in cross compiling for Firefox.

The error is:
<code class="console">/opt/cross-pi-gcc/arm-linux-gnueabihf/include/bits/stdlib.h:90:3: error: #error "Assumed value of MB_LEN_MAX wrong"
&hellip;
/opt/cross-pi-gcc/arm-linux-gnueabihf/include/bits/wchar2.h:448:3: error: #error "Assumed value of MB_LEN_MAX wrong"</code>
I've used the solution <a class="extlink" href="https://www.linuxquestions.org/questions/linux-software-2/tar-cross-compile-error-arm-linux-gnueabi-4175642648/">here</a> to resolve this.
<code class="green">(cd $XGCC_DIR/lib/gcc/*-linux-gnu*/8.3.0/plugin/include/
cat limitx.h glimits.h limity.h > ../../include-fixed/limits.h)
</code>

[4] Set up a sysroot for the RPi3 libs and headers needed for the Firefox build.

My preference is to set this up in a separate directory and bind-mount it to the cross compiler sysroot directory.
This enables me to set up different sysroots for whatever is being cross compiled.
<code class="green">export ROOT=<span class="comment">$MOZBUILD/$TARGET_SYSROOT</span>
</code>
Install kernel headers
<code class="green">installpkg <span class="comment">/tmp/</span>kernel-headers-4.19.27-RPi3.txz
</code>
Install Slackware arm current libs/headers as used for the RPi3
<code class="green">cd $Slack_base
installpkg l/pango-*.txz
installpkg l/glib2-*.txz
installpkg l/pcre-*.txz
installpkg l/fribidi-*.txz
installpkg l/freetype-*.txz
installpkg l/zlib-*.txz
installpkg a/bzip2-*.txz
installpkg l/libpng-*.txz
installpkg x/fontconfig-*.txz
installpkg a/util-linux-*.txz
installpkg l/expat-*.txz
installpkg l/harfbuzz-*.txz
installpkg l/cairo-*.txz
installpkg x/pixman-*.txz
installpkg x/mesa-*.txz
installpkg x/libdrm-*.txz
installpkg x/libX11-*.txz
installpkg x/xorgproto-*.txz
installpkg x/libxcb-*.txz
installpkg x/libpthread-stubs-*.txz
installpkg x/libXau-*.txz
installpkg x/libXdmcp-*.txz
installpkg x/libXext-*.txz
installpkg x/libXdamage-*.txz
installpkg x/libXfixes-*.txz
installpkg x/libXxf86vm-*.txz
installpkg x/libXrender-*.txz
installpkg l/gtk+3-3.*.txz
installpkg l/gdk-pixbuf2-*.txz
installpkg x/libXinerama-*.txz
installpkg x/libXi-*.txz
installpkg x/libXrandr-*.txz
installpkg x/libXcursor-*.txz
installpkg x/libXcomposite-*.txz
installpkg x/libepoxy-*.txz
installpkg l/atk-*.txz
installpkg l/at-spi2-atk-*.txz
installpkg l/at-spi2-core-*.txz
installpkg a/dbus-*.txz
installpkg l/gtk+2-*.txz
installpkg l/dbus-glib-*.txz
installpkg l/pulseaudio-*.txz
installpkg x/libXt-*.txz
installpkg x/libSM-*.txz
installpkg x/libICE-*.txz
installpkg l/libffi-*.txz
installpkg x/libxshmfence-*.txz
installpkg n/openssl-1.1.*.txz
installpkg x/glu-*.txz
<span class="dhash">##</span> move ldconfig out of the way - links will be set up by doinst.sh
mv /sbin/ldconfig /sbin/ldconfig-bak
installpkg l/glibc-2.29*.txz
mv /sbin/ldconfig-bak /sbin/ldconfig
unset ROOT
</code>

[5] Set up shell variables.

pkg-config needs to access the libs and headers for the target system and this sets it up to prefix $SYSROOT to the -L and -I paths in the .pc files
<code class="green">export PKG_CONFIG_PATH=
export PKG_CONFIG_SYSROOT_DIR=$SYSROOT
export PKG_CONFIG_LIBDIR=$SYSROOT/usr/lib$LIBDIRSUFFIX/pkgconfig:$SYSROOT/usr/share/pkgconfig
</code>
Mount SYSROOT
<code class="green">mount -B <span class="comment">$MOZBUILD/$TARGET_SYSROOT</span> $SYSROOT
</code>
Add the cross compiler [$X_TARGET-gcc etc..] bin directory to the PATH
<code class="green">export PATH=$XGCC_DIR/bin:$PATH
</code>
Set parameter for MOZCONFIG variable
<code class="green">XCOMPILE=.cross
</code>

[6] The build needs to be set up to use the cross compiler [CC] and the rust target crate [--target=]

Create an additional common mozconfig &Rightarrow; mozconfig.cross
<code class="green">cd $MOZBUILD/mozilla
cat > mozconfig.cross << "EOF"
<span class="dhash">##</span> for cross compiling
CC=$X_CC
CXX=$X_CXX
ac_add_options --target=$CRATE

<span class="dhash">##</span> running elfhack during the build doesn't fail, but corrupts libxul.so
$DISABLE_ELFHACK

<span class="dhash">##</span> use LD_LIBRARY_PATH to find libstdc++ etc
mk_add_options "export LD_LIBRARY_PATH=$XGCC_DIR/$X_TARGET/lib$LIBDIRSUFFIX"

<span class="dhash">##</span> use the cross tools to strip the arm libraries during installation
mk_add_options "export STRIP=$XGCC_DIR/$X_TARGET/bin/strip"

<span class="dhash">##</span> add BINDGEN_CFLAGS for the servo/style [stylo] build
mk_add_options "export BINDGEN_CFLAGS=--sysroot=$SYSROOT -I$XGCC_DIR/$X_TARGET/include/c++/8.3.0 -I$XGCC_DIR/$X_TARGET/include/c++/8.3.0/$X_TARGET"

<span class="dhash">##</span> disable webrtc for FF64+ on armv7
$DISABLE_WEBRTC

EOF
</code>

Create a mozconfig.firefox.cross
<code class="green">cd $MOZBUILD/mozilla
cat > mozconfig.firefox.cross << "EOF"
<span class="dhash">##</span> include the common mozconfig
source $MOZBUILD/mozilla/mozconfig.common

<span class="dhash">##</span> include the cross build mozconfig
source $MOZBUILD/mozilla/mozconfig.cross

<span class="dhash">##</span> for Firefox build
ac_add_options --enable-application=browser
mk_add_options MOZ_OBJDIR=$MOZBUILD/$REL/firefox-build-dir

EOF
</code>

[7] Error patches:
<code class="console"> {standard input}: Assembler messages:
 {standard input}:1022: Error: bad expression -- `b #_ZL14SigprofHandleriP9siginfo_tPv'</code>
This is caused by the <a class="extlink" href="https://hg.mozilla.org/mozilla-central/rev/537f4d1d837a">SignalTrampoline to work properly with clang</a> fix which needs to be <a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1434526#c2">reverted</a> to work with gcc when cross compiling.</code>
<code class="green">cd $MOZBUILD/mozilla
echo $'--- mfbt/LinuxSignal.h
+++ mfbt/LinuxSignal.h
@@ -29 +29 @@
-    "b %0"
+    "bx %0"
@@ -31 +31 @@
-    : "X"(H)
+    : "r"(H), "l"(aSignal), "l"(aInfo), "l"(aContext)
' | while read line
do
patch -p0
done
</code>
<b>OR</b>:
<code class="green">cd $MOZBUILD/mozilla
echo $'--- mfbt/LinuxSignal.h
+++ mfbt/LinuxSignal.h
@@ -25 +25,5 @@
-  asm volatile("b %0" : : "X"(H) : "memory");
+  asm volatile (
+    "bx %0"
+    :
+    : "r"(H), "l"(aSignal), "l"(aInfo), "l"(aContext)
+    : "memory");
' | while read line
do
patch -p0
done
</code>
<code class="console">error: field ‘ufp’ has incomplete type ‘user_vfp’</code>
<code class="green">cd $MOZBUILD/mozilla
echo $'--- js/src/wasm/WasmSignalHandlers.cpp
+++ js/src/wasm/WasmSignalHandlers.cpp
@@ -232 +232,10 @@
-#  include &lt;sys/user.h>
+struct user_vfp {
+	unsigned long long fpregs[32];
+	unsigned long fpscr;
+};
+
+struct user_vfp_exc {
+	unsigned long	fpexc;
+	unsigned long	fpinst;
+	unsigned long	fpinst2;
+};
' | while read line
do
patch -p0
done
</code>
<code class="console">checking for clock_gettime(CLOCK_MONOTONIC)... no</code>
<code class="green"><span class="dhash">##</span> for 66 only, fixed in 67 &hellip;
[[ $MAJ_VER == 66 ]] &amp;&amp; {
cd $MOZBUILD/mozilla/
echo $'--- old-configure.in
+++ old-configure.in
@@ -1305,0 +1306 @@
+                      _SAVE_CFLAGS="$CFLAGS"
@@ -1306,0 +1308 @@
+                      CFLAGS="$CFLAGS $DSO_PIC_CFLAGS"
@@ -1314,0 +1317 @@
+                      CFLAGS="$_SAVE_CFLAGS"
' | while read line
do
patch -p0
done
}
</code>
<code class="console">fatal error: main_FIX.h: No such file or directory</code>
<code class="green">cd $MOZBUILD/mozilla/
echo $'--- media/libopus/silk/arm/arm_silk_map.c
+++ media/libopus/silk/arm/arm_silk_map.c
@@ -31 +31 @@
-#include "main_FIX.h"
+#include "../fixed/main_FIX.h"
' | while read line
do
patch -p0
done
</code>
</code>
<span class="tabs th2"><a href="#close_FF_xcompile">close</a></span>
</div></div>                                                     <!-- FF xcompile - end -->
<code class="gray">cd $MOZBUILD/mozilla/
export MOZCONFIG=$MOZBUILD/mozilla/mozconfig.firefox${XCOMPILE:-}
<span class="red">[[ -e $MOZBUILD/l10n/merge-$L10N ]] &amp;&amp; export LOCALE_MERGEDIR=$MOZBUILD/l10n/merge-$L10N</span>
./mach build
</code>
A successful build will end with a message like:
<code class="console">mmm:ss.xx We know it took a while, but your build finally finished successfully!
To view resource usage of the build, run |mach resource-usage|.
To take your build for a test drive, run: |mach run|
</code>
<b>Installation</b>
Install a dictionary:
<code class="red">(cd $MOZBUILD/$REL/firefox-build-dir/dist/bin
rm -rf dictionaries
unzip $MOZBUILD/sources/$L10N-dict.xpi dictionaries/*)
</code>
If eyedropper.properties is duplicated the installation will fail, in which case remove one of them:
<code class="red">[[ $MAJ_VER -lt 57 ]] &amp;&amp; \
(cd $MOZBUILD/$REL/firefox-build-dir/dist/bin/browser/chrome/$L10N/locale/$L10N/devtools/
[[ -e client/eyedropper.properties ]] &amp;&amp; \
[[ -e shared/eyedropper.properties ]] &amp;&amp; \
rm client/eyedropper.properties)
</code>
Let's take it for a test drive:
<code>./mach run
</code>                                                    <!-- mach package - start -->
<b>Installation:</b> <a name="close_machpk"></a>
Use either './mach install' or &nbsp;<span class="tabs prefs"><a href="#Mpack">'./mach package'</a></span>
<div id="Mpack" class="tab">
<div class="b_prefs"><span class="tabs th2"><a href="#close_machpk">close</a></span>
<!-- leave this space -->
<b>Using './mach package'</b>&nbsp;
<code class="gray">./mach package</code>
will create -
for esr52 builds:
<code class="console">$MOZBUILD/$REL/firefox-build-dir/dist/firefox-{version}.<span class="red">$L10N.</span>linux-$ARCH.tar.bz2
<span class="red">$MOZBUILD/$REL/firefox-build-dir/dist/linux-$ARCH/xpi/firefox-{version}.$L10N.langpack.xpi</span>
</code>
for 57+ builds:
<code class="console">** WiP **</code>
<span class="tabs th2"><a href="#close_machpk">close</a></span>
</div></div>                                                     <!-- mach package - end -->
Install to $DESTDIR for packaging:
<code class="gray">DESTDIR=$MOZBUILD/$REL/packaging-FF ./mach install
</code>
<b>Create package</b>
Includes setting up a relative link for /usr/bin/firefox &hellip;
<code class="gray">cd ../$REL/packaging-FF/usr/lib
mkdir -p pkg/{opt,usr/bin}
unset FF_SUFF &amp;&amp; [[ $REL == esr52 ]] &amp;&amp; FF_SUFF="-[0-9]*"
mv firefox${FF_SUFF:-} pkg/opt/firefox-$(cat $MOZBUILD/mozilla/browser/config/version.txt)
<span class="red"><span class="dhash">##</span> 'for the record', add the l10n revision that this build is based on:
sed -i "s|SourceStamp.*$|&amp;\nL10n_revision=${L10N_CS:-}|" pkg/opt/firefox-*/application.ini</span>
(cd pkg/usr/bin
ln -s ../../opt/firefox-*/firefox .)
cd pkg
makepkg -l y -c n ../../../../built/firefox-$(cat $MOZBUILD/mozilla/browser/config/version.txt)$LOCZN-$PKG_ARCH.txz
</code>
</div>

<p><br>
<a name="BuildingSMReturn"></a>
<div style="background: #E5F1FF;"><span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJ
bWFnZVJlYWR5ccllPAAAAuxJREFUOE9lUktME1EUPW9mWqbFtmPDLxFCiYghfiiCESKRmhgWuqAr
o2EhMWqEjWhYEF2IO6Ms0AWRlbpg4wbcaIzRBXFBNJrSYPxA+CqRXwv90Ol0Zp7vTamg3uTm3pe8
c8+5H4L/rK+8rMzZ5Xbb/fxlmtwpVDWzvrS0OaKq3U93/iY7H4ry4LbP5+pVFNkC6boJw6CW81zT
dKyuqqHl5WQ70DP+VwGHo+9aXV1JP89zIMMwLWDTqb243tMEQRJAUyrqDwzORqOqnxXZkLLwe81V
Vd5+Xd8G5QoUF+fjVu8JTCwBYz8ojqYWYbeLPlmWWDs4aRWoqHD322wi61O3QDnJPJ4+74eaAb6s
UHjsBpoafCgqciKR0ALA/VYBuFsjy6Kfg9NpgxUxsJ3rCAar8GYG+LwCpDQT31ZMtLRUsHkYEEXa
LpWWugJutwNra8kdfWdjR0ct0lTA7DoQT7PZUIJkxoTHkweXy4mCAk9Aqq8/rLQGj4PydVGAbjlf
X01DBgMf2Ap1Aq9MIbKR/9ygCASOoLikEZOT84oUDmusnziTAwjMTcbs9UpobHTgu2EHUwqFgSMJ
HaVugjKPiBfPNITDKuJxHdLc3EYoEkkwybA8Kx9o68zD6KqIDGurtshA3EPgYYXy1imGhmKw2cBm
FAlJhjEdSqUqmWSvBeTyHw7sxvCahF1s6k7BgMsuYH8BoLFVXroYhSwTq0Ay+Su0dUgvHxNyqJ1n
HDxWKONstW5d2XyM4Fghwae3aQw+SjJWCkkijHAZExOvfFuHNN4FuIM3bh5UJssd6Nyjw9wEFqcN
rH3N4MpICqkULFbOToiGhYVwL9A9ZymglJaPfEw+UfOcAWdEw9VzEfY5K5Oz8cjfEqPTtAhmZt73
xmIX7nCswMDD7+bpbLUvH5XqcrDtzOsRUUxaTNwdjmyUJA2x2PTs1NRoew7MjbACzSyuE0LG8cf6
yr3efUG7XVY4q8DuNRqdD8Xjl5/jH/sNIBmHpcHZfUMAAAAASUVORK5CYII="><span style="vertical-align:20%"><b> Building SeaMonkey</b></span></span>
<code class="gray">unset XCOMPILE
</code>
</code> <a name="close_SM_xcompile"></a>                                                    <!-- SM xcompile - start -->
<span class="tabs prefs"><a href="#SM_xcompile">Cross compiling</a></span><span style="vertical-align:-30%">&nbsp;&nbsp;additional setting up for cross compiling for the RPi3.</span>
<div id="SM_xcompile" class="tab">
<div class="b_prefs"><span class="tabs th2"><a href="#close_SM_xcompile">close</a></span>
<!-- leave this space -->
1] <a href="#FF_xcompile">mozilla</a> setting up needs to have been done.
2] Create a mozconfig.seamonkey.cross
<code class="green thtwob">cd $MOZBUILD/$REL/comm-$REL
cat > mozconfig.seamonkey.cross << "EOF"
<span class="dhash">##</span> include the common mozconfig
source $MOZBUILD/mozilla/mozconfig.common

<span class="dhash">##</span> include the cross build mozconfig
source $MOZBUILD/mozilla/mozconfig.cross

<span class="dhash">##</span> for SeaMonkey build
ac_add_options --enable-application=${COMM:-}suite
mk_add_options MOZ_OBJDIR=$MOZBUILD/$REL/seamonkey-build-dir

EOF
</code>
3] Set parameter for MOZCONFIG variable
<code class="green thtwob">XCOMPILE=.cross
</code>
<span class="tabs th2"><a href="#close_SM_xcompile">close</a></span>
</div></div>                                                     <!-- SM xcompile - end -->
<code class="gray">cd $MOZBUILD/$REL/comm-$REL
export MOZCONFIG=$MOZBUILD/$REL/comm-$REL/mozconfig.seamonkey${XCOMPILE:-}
<span class="red">[[ -e $MOZBUILD/l10n/merge-$L10N ]] &amp;&amp; export LOCALE_MERGEDIR=$MOZBUILD/l10n/merge-$L10N</span>
./mozilla/mach build
</code>
A successful build will end with a message like:
<code class="console">mmm:ss.xx We know it took a while, but your build finally finished successfully!
To view resource usage of the build, run |mach resource-usage|.
To take your build for a test drive, run: |mach run|</code>
<b>Installation</b>
Install a dictionary:
<code class="red">(cd $MOZBUILD/$REL/seamonkey-build-dir/dist/bin
rm -rf dictionaries
unzip $MOZBUILD/sources/$L10N-dict.xpi dictionaries/*)
</code>

Add searchplugins of choice:
<code class="red">[[ $REL == esr52 ]] &amp;&amp; {
rm $MOZBUILD/$REL/seamonkey-build-dir/dist/bin/searchplugins/google*
cp $MOZBUILD/mozilla/browser/locales/searchplugins/{amazon,eBay,google}-$L10N.xml \
$MOZBUILD/$REL/seamonkey-build-dir/dist/bin/searchplugins/
}
</code>

Let's take it for a test drive:
<code>./mozilla/mach run
</code>
Install to $DESTDIR for packaging:
<code class="gray">DESTDIR=$MOZBUILD/$REL/packaging-SM ./mozilla/mach install
</code>
<b>Create package</b>
Includes setting up a relative link for /usr/bin/seamonkey &hellip;
<code class="gray">cd ../packaging-SM/usr/lib
mkdir -p pkg/{opt,usr/bin}
unset FF_SUFF &amp;&amp; [[ $REL == esr52 ]] &amp;&amp; FF_SUFF="-[0-9]*"
mv seamonkey${FF_SUFF:-} pkg/opt/seamonkey-$(cat $MOZBUILD/$REL/comm-$REL/suite/config/version.txt)
<span class="green"><span class="dhash">##</span> 'for the record', add the mozilla and l10n revisions that this build is based on:</span>
<span class="red">sed -i "s|SourceStamp.*$|&amp;\nL10n_revision=${L10N_CS:-}|" pkg/opt/seamonkey-*/application.ini</span>
<span class="green">sed -i "s|SourceStamp.*$|&amp;\nGecko_revision=${Gecko_Rev:-}|" pkg/opt/seamonkey-*/application.ini</span>
(cd pkg/usr/bin
ln -s ../../opt/seamonkey-*/seamonkey .)
cd pkg
makepkg -l y -c n ../../../../built/seamonkey-$(cat $MOZBUILD/$REL/comm-$REL/suite/config/version.txt)$LOCZN-$PKG_ARCH.txz
</code>
</div>

<p><br>
<a name="BuildingTBReturn"></a>
<div style="background:#F4f4f4"><span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A
/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sIDw0JOVohvckAAATpSURBVDjL
rZV7aFNnGMaf7+QkOUmTaG+x96qb1ehab+i8TKtT62VCq2ODsQvCZMLYGIx1F8YYQ53MiezixA1F
1DGdwlTQOaUVhU5rtWrtnNraJrXJ0ubWnJxzcnKu3/5wc7roHGwPfPDxfrw/Xh5eng94iJKUWjfv
P189unadFQAWbjiC/6TGredAKeVe39zUtG7PBXomKJzFs58NA4DhT299aL/lQQ9njm6HUlm/Y+TY
ESuKfGX0VHt3mRJT3lNGLS7xCOJJ/uYJreqJ9YjfOnnffubvhciFYwCAhrWd08dOrngJHgcVpQTh
YwIxTQpDN16hIF3j5nxc09XyPkbWffTvwIqiWGnH91NnPJ7bDIeOXI9JwkEe125EMJjRYYBAtttK
RY7tKFm2zhs48eGd3uCZQ3fu5G5ouPVIma7rPTrL2Y7bquFymbTtbB85vrMFYkEhmJGFcJkGOM5O
OYYh4VhKDsTM8b81uhdSQ2sundXgv2fiq8f2IhrqhsQn1vLRkE0QJSh6hgb7U+TgnnaseuQK1k+6
hP5bcZS5rJg7sYx4cz10SlU5Vz8+p0sY6P3GBGnMsmLC0ucQ7GhbnkwmVsXDIZqJh3Hz6gD5pTOM
mjwLbkSiaMmZDxfP4/T+g+i6EkK+x0VsrIWonnLrtjYWeizwwq8/7q7J8lilpFG3OyFGwuS7cxGU
ui2YPSYX8UIn9o9ag8MtERToKkZ5q9C6byuSogGbhYEHaXTnzyU93X3utMW2KwtsAFOGV/owGBnA
mBmLMOfRfPiKOMwl7ZicDCMnJcGq6rAYaXisTnBWCl01YOcYlOdb0Wt/DKCYlAVmKFyqxNM5L7+F
Nct98FUUojfgx4SZK/Dq0okY7rCDNVVYTB42jkFJmQfeAhdCoRTKTR7TplRQg/y1ZOwdMMsiIwlk
/Ixl2HukAwdOXcPJqyGIkoyV0ypR7eXRGhyEKvjB+mZjUTGDBXWliNba4bKI6AsoJKPp2WDO6bou
SUPjhHgQn/5wCRoxUN9Qh8FEAm6ksW3DM2g9246yEi8GdCd8xQ6oqowcGxCLilBVFQxhYllgXVU2
Waz27YP9XVg5z4fRE3xYMs6BuKjDH1WgUQa1tdNhmjoqDQOmJkPNZJCWBGTSEjRNg93p/CTLY4fD
dchuc6jJWJTOn16FF6e5sfNcDCFehagasBIKLSNAzUjQZBGKLEGRRYh8EmlJpBaGVQ1V35MF9s1e
FC8oKtpBKYiDpOmsjVfQPyjielCCIhtQdR1SMnYbLqcgC0nw8SiEFE+1jErcebm7py5eOXjfrJg3
88k3C7zFnaXDWDLUm6B5hGDZxHz4vDlQNR2BXj+UtIxkPIp4dAB8Mkk1TSN53uLIpg8+fftu1j1Z
se/rTe4bgVDF6tfevQiGtUlDfQj19aHf3w2Gmqjy+eAdUQRJFJAailMLIcTtyfOvfuOdeT+3tYet
LKtpup4NTsWC32aExPOdHZcjhJpejnPAM8wDG+eE1WqFYRgwTROGpoDnU0O8kG5vamr+KhhLnt57
4PDQAyfu83fVlJaUdEiigK7O81+u3/jFIVmUJzc8Vbc8Nz8/j8JkEpFY/ODREz+BGO1btny+a0RR
UfHFy53OBUvq5fsGc6j/duKdOt1ccFeZBcAByAGQ98dxAXD8uaqSJFRTSv/5n+rpuY7/S78DHAti
UD80RecAAAAASUVORK5CYII="><span style="vertical-align:40%"><b> Building Thunderbird [Daily]</b></span></span>
<code class="gray">unset XCOMPILE
</code>
</code> <a name="close_TB_xcompile"></a>                                                    <!-- TB xcompile - start -->
<span class="tabs prefs"><a href="#TB_xcompile">Cross compiling</a></span><span style="vertical-align:-30%">&nbsp;&nbsp;additional setting up for cross compiling for the RPi3.</span>
<div id="TB_xcompile" class="tab">
<div class="b_prefs"><span class="tabs th2"><a href="#close_TB_xcompile">close</a></span>
<!-- leave this space -->
1] <a href="#FF_xcompile">mozilla</a> setting up needs to have been done.
2] Create a mozconfig.thunderbird.cross
<code class="green thtwob">cd $MOZBUILD/$REL/comm-$REL
cat > mozconfig.thunderbird.cross << "EOF"
<span class="dhash">##</span> include the common mozconfig
source $MOZBUILD/mozilla/mozconfig.common

<span class="dhash">##</span> include the cross build mozconfig
source $MOZBUILD/mozilla/mozconfig.cross

<span class="dhash">##</span> for Thunderbird build
ac_add_options --enable-application=${COMM:-}mail
mk_add_options MOZ_OBJDIR=$MOZBUILD/$REL/thunderbird-build-dir

EOF
</code>
3] Set parameter for MOZCONFIG variable
<code class="green thtwob">XCOMPILE=.cross
</code>
<span class="tabs th2"><a href="#close_TB_xcompile">close</a></span>
</div></div>                                                     <!-- TB xcompile - end -->
<code class="gray">cd $MOZBUILD/$REL/comm-$REL
export MOZCONFIG=$MOZBUILD/$REL/comm-$REL/mozconfig.thunderbird${XCOMPILE:-}
<span class="red">[[ -e $MOZBUILD/l10n/merge-$L10N ]] &amp;&amp; export LOCALE_MERGEDIR=$MOZBUILD/l10n/merge-$L10N</span>
./mozilla/mach build
</code>
A successful build will end with a message like:
<code class="console">mmm:ss.xx We know it took a while, but your build finally finished successfully!
To view resource usage of the build, run |mach resource-usage|.
To take your build for a test drive, run: |mach run|</code>
<b>Installation</b>
Install a dictionary:
<code class="red">(cd $MOZBUILD/$REL/thunderbird-build-dir/dist/bin
rm -rf dictionaries
unzip $MOZBUILD/sources/$L10N-dict.xpi dictionaries/*)
</code>
If eyedropper.properties is duplicated the installation will fail, in which case remove one of them:
<code class="red">(cd $MOZBUILD/$REL/thunderbird-build-dir/dist/bin/chrome/$L10N/locale/$L10N/devtools/
[[ -e client/eyedropper.properties ]] &amp;&amp; \
[[ -e shared/eyedropper.properties ]] &amp;&amp; \
rm client/eyedropper.properties)
</code>
Let's take it for a test drive:
<code>./mozilla/mach run
</code>
Install to $DESTDIR for packaging:
<code class="gray">DESTDIR=$MOZBUILD/$REL/packaging-TB ./mozilla/mach install
</code>
<b>Create package</b>
Includes setting up a relative link for /usr/bin/thunderbird &hellip;
<code class="gray">cd ../packaging-TB/usr/lib
mkdir -p pkg/{opt,usr/bin}
unset FF_SUFF &amp;&amp; [[ $REL == esr52 ]] &amp;&amp; FF_SUFF="-[0-9]*"
mv thunderbird${FF_SUFF:-} pkg/opt/thunderbird-$(cat $MOZBUILD/$REL/comm-$REL/mail/config/version.txt)
<span class="green"><span class="dhash">##</span> 'for the record', add the mozilla and l10n revisions that this build is based on:</span>
<span class="red">sed -i "s|SourceStamp.*$|&amp;\nL10n_revision=${L10N_CS:-}|" pkg/opt/thunderbird-*/application.ini</span>
<span class="green">sed -i "s|SourceStamp.*$|&amp;\nGecko_revision=${Gecko_Rev:-}|" pkg/opt/thunderbird-*/application.ini</span>
(cd pkg/usr/bin
ln -s ../../opt/thunderbird-*/thunderbird .)
cd pkg
makepkg -l y -c n ../../../../built/thunderbird-$(cat $MOZBUILD/$REL/comm-$REL/mail/config/version.txt)$LOCZN-$PKG_ARCH.txz
</code>
</div>


<p>
If in a chroot, exit and unmount additional 32-bit build bindings:
<br>
<code class="thtwo">[[ $CHRT_TEST ]] &amp;&amp; unset CHRT_TEST &amp;&amp; exit

[[ $(cat /proc/mounts | grep $CHRT/proc) ]] &amp;&amp; {
umount $CHRT$MOZBUILD/$REL/comm-$REL/mozilla
umount $CHRT$MOZBUILD/l10n
umount $CHRT$MOZBUILD/$REL/comm-$REL
umount $CHRT$MOZBUILD/sources
umount $CHRT$MOZBUILD/mozilla
umount $CHRT/proc
umount $CHRT/dev

<span class="dhash">##</span> Reset everything for a 64-bit build
unset CHRT
export ARCH=x86_64
sed -i '/For 32 bit version/,+3 d' $MOZBUILD/mozilla/mozconfig.common
}
</code>

<P>
Reset FF57+ localization work-arounds:<br>
<code class="red"><span class="dhash">##</span> RESET searchplugins
rm $MOZBUILD/$REL/comm-release/suite/locales/en-US/searchplugins/*
cp -a $MOZBUILD/l10n/wip/list.json $MOZBUILD/mozilla/browser/locales/search/

<span class="dhash">##</span> RESET all en-US files
<b>TEST_CP=no</b>
(cd $MOZBUILD/l10n/wip
while read file
do
[[ $TEST_CP == no ]] &amp;&amp; cp -a .$file $file \
|| echo -e "would copy en-US backup \n.$file \nto original location \n$file \n"
done &lt; $MOZBUILD/l10n/en-US-l10n-files)

<span class="dhash">##</span> and remove temporary content
rm -rf $MOZBUILD/l10n/wip/*
</code>

<p>
Unmount the bind mounts:
<br>
<code class="gray">umount $MOZBUILD/$REL/comm-$REL/mozilla/comm
umount $MOZBUILD/$REL/comm-$REL/mozilla
<span class="green">umount $SYSROOT</span>
</code>
<br>

<!-- DROPDOWN MENU -->
<div>
<ul id="menu">
    <li><a><span style="color:#e3e3e3">&nabla;</span></a>
      <div>
        <p><a href="#Latest">Latest builds</a>
        <p><a href="#DirStructure">Directory structure</a>
        <p><a href="#Set_variables">Set variables</a>
        <p><a href="#Mercurial_bundles">Mercurial bundles</a>
        <p><a href="#Locrep">Add new changesets</a>
        <p><a href="#known_rel"><span class="green">Building to a revision</span></a>
        <p><a href="#Create_mozconfigs">Create mozconfigs</a>
        <p><a href="#Prefs"><span class="green">User preferences</span></a>
        <p><a href="#Ttipbox"><span class="green">Gtk3 configuration</span></a>
        <p><a href="#l10n"><span class="red">Localization</span></a>
        <p><a href="#Th2bit"><span class="thtwo">32-bit build</span></a>
        <p><a href="#BuildingFFReturn"><span style="background: #FFFADD;">Building Firefox</span></a>
        <p><a href="#BuildingSMReturn"><span style="background: #E5F1FF;">Building SeaMonkey</span></a>
        <p><a href="#BuildingTBReturn"><span style="background: #F4f4f4;">Building Thunderbird</span></a>
      </div>
    </li>
</ul>
</div>
<!-- DROPDOWN MENU ENDS-->

</body></html>
