<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta name="google-site-verification" content="xO3y2fv-X8oZAKtnao0t7127tULo8Xu6MaMV10EdwFI" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Building Firefox, Seamonkey and Thunderbird from mercurial repositories</title>

<style>
.red {background-color: #FFdddd;}
.gray {background-color: #e7e7e7;}
.green {background-color: #E7F5E7;}
.thtwo {background-color: #Fafafa;border: dotted 1px;}
.central {border: dashed 1px;display: inline-block;padding: 2px;}
.appx {background-color: #Fafafa;}
.console {border-left: 3px solid lightgrey;margin-left: 15px;}
.dastx {color: #978DFF;}
.comment {color: #acacac;}
div {padding: 5px;white-space: pre-wrap;}
code {padding: 5px;display: inline-block;white-space: pre-wrap;margin: 5px 0;}
div code {margin: 10px 0;}
a, a:visited {text-decoration: none;font-style: oblique;color: #0000c5;}
a.extlink, a:visited.extlink {color: #c50000;}
a.intlink, a:visited.intlink {color: #00c500;}
hr {width: 100%;height: 2px;}
</style>

<!-- pop-ups styling  -->
<style type="text/css">
.b_locn {border-left: 10px solid #FFdddd;padding-left: 10px;}
.b_prefs {border-left: 10px solid #E7F5E7;padding-left: 10px;}
.b_32bit {border-left: 10px solid #Fafafa;padding-left: 10px;}

/* basic for close tab */
span.tabs a {box-shadow:1px 1px 3px gray; /* shift-horz|-vert|width|colour */
border-radius:6px;padding: 2px 4px;color:#0000c5;}
span.tabs.locn a {background-color:#FFdddd;}
span.tabs.prefs a {background-color:#E7F5E7;}
span.tabs.th2 a {background-color:#Fafafa;}

div.tab {display: none;}
div.tab:target {display: block;}
:target div.tab {display: block;}
:target div.tab + div.tab {display: none;}
</style>
</head>

<body>
<h3> Building Firefox, Seamonkey and Thunderbird from mercurial repositories</h3>
Covers building from the release repositories <b>release</b>, <b>beta</b>, and <b>esr52</b>; and from <b>central</b>.
<br>
The <b>mozilla-unified</b> repository is used to avoid having up to 4 different copies of mozilla-$REL repositories, and is smaller than any one of them.
<p>This page has been laid out around a distro-independent <span class="gray">build script</span>, 
defaulting to a en-US build on unmodified source.
<br>
Packaging from the installation is Slackware specific, which should be adaptable to other packaging systems.
<br>
Packaging from the 'mach' built packages is generic.
<p>
Build <span style="background:#FFFADD;">Firefox</span> with gtk2 optionally for 52.x releases - gtk3 otherwise, using mach, and rust; and package it to install to /opt/firefox-{version} ...<br>
and/or <span style="background:#E5F1FF;">Seamonkey</span> and/or <span style="background:#F8F8F8">Thunderbird</span> based on that Firefox source.
<br>
<p>With <span class="red">single localization</span> and <span class="green">user preferences</span> options and <span class="thtwo">32-bit build adjustments</span>.

<br>

<hr>
<b>References</b><br>
<a class="extlink" href="http://www.linuxfromscratch.org/blfs/view/svn/xsoft/firefox.html">LFS</a> for mozconfig setup and the inspiration to do this
<br>
<a class="extlink" href="https://developer.mozilla.org/en-US/docs/Mozilla/Developer_guide/Build_Instructions/Simple_Firefox_build">Simple Firefox build</a><br>
<a class="extlink" href="https://developer.mozilla.org/en-US/docs/Simple_Firefox_build/Linux_and_MacOS_build_preparation">Linux Build Prerequisites</a>
<br>
&hellip; and other Mozilla Developer pages &hellip;

<p>

<br>
<b>Latest builds</b> using rust 1.24.0
<br>
l10n files are updated from these l10n-central base revisions during <a href="#l10n">Localization</a> using compare-locales 
<br><code class="appx">                                                      built to revision [changeset]
        <u>Firefox</u>   <u>Seamonkey</u>   <u>Thunderbird</u>       <u>mozilla</u>         <u>comm-$REL</u>       <u>l10n-central</u>
</code>
<br>
<b><i>esr52</i></b> <span class="comment"> [SM/TB versions as per '<a href="#Prefs">User preferences</a>[5]'</span>
<br>
<code class="appx">        52.7.3                                  c3e447e07077    <span class="comment">n/a</span>             3b1783bdb6fd   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span>
                  2.49.7.0                      ef21d2157756    1216b956d1b0    3b1783bdb6fd   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span>
                              52.7.0            ef21d2157756    1216b956d1b0    3b1783bdb6fd   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span>
</code>
<br>
<b><i>release</i></b>
<br>
<code class="appx">        59.0                                    c61f5f5ead48    <span class="comment">n/a</span>             4be371ba0b12   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span>
                  2.56                          c61f5f5ead48    026949d91908    4be371ba0b12   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span>
                              59.0              c61f5f5ead48    026949d91908    4be371ba0b12   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span>
</code>
<br>
<span class="comment">SM2.56 builds but doesn't run, but that may be an issue with my setup because the last Nightly 2.56 release candidate from 22 Jan exhibits the same run-time error.</span>
<br>
<b><i>beta</i></b>
<br>
<code class="appx">        60.0b3                                  e0827182ac6c    <span class="comment">n/a</span>             <span class="comment">not used&nbsp;&nbsp;&nbsp;&nbsp;</span>   <span class="gray"> </span>&nbsp;&nbsp;&nbsp;&nbsp;
                  2.57                          e0827182ac6c    2d485f0d3723    <span class="comment">not used&nbsp;&nbsp;&nbsp;&nbsp;</span>   <span class="gray"> </span>&nbsp;&nbsp;&nbsp;&nbsp;
</code>
<br>
<b><i>central [Nightly]</i></b>
<br>
<code class="appx">        61.0a1                                  445255800255    <span class="comment">n/a</span>             <span class="comment">not used&nbsp;&nbsp;&nbsp;&nbsp;</span>   <span class="gray"> </span>&nbsp;&nbsp;&nbsp;&nbsp;
                  2.58a1                        445255800255    c79eb711d4d4    <span class="comment">not used&nbsp;&nbsp;&nbsp;&nbsp;</span>   <span class="gray"> </span>&nbsp;&nbsp;&nbsp;&nbsp;
</code>
<br>
<span class="comment">The SM2.58a1 build is based on the revision of the archived Nightly build of 2018-04-03, which failed because of a gcc version issue. This build completes, but URLs will not launch from the address bar or CLI.</span>
<p>

<br>
<b>Build times</b>
<br><code>Machine			dual-core 2.2 GHz			2x quad-core 3GHz
MOZ_MAKE_FLAGS		-j2					-j10
Firefox 		~ 95 mins [FF52]  ~152 mins [FF57+]	~23 mins [FF52]  ~37 mins [FF57+]
Seamonkey/Thunderbird	~104 mins [FF52]  ~172 mins [FF57+]	~24 mins [FF52]  ~38 mins [FF57+]</code>
<br>
Higher values for '-j' on the dual-core machine made no difference to these best build times and were prone to timing errors.

<p><br>
    <b>Directory structure</b><br>
    The build is done within this directory structure [key directories only]:<br>
    <code>$MOZBUILD
├── mozilla					# unpacked mozilla-unified bundle
│   └── extensions
│       <span class="green">└── {irc,inspector}			# mercurial clones</span>
├── sources
│   ├── autoconf-2.13				# source archive
│   ├── llvm					# for LLVM_CONFIG for stylo build
│   ├── mozilla-unified.zstd.hg			# mercurial bundle
│   ├── rust					# latest binaries
│   <span class="red">└── compare-locales				# to create merge-$L10N</span>
├<span class="thtwo">── chrt					# chroot for 32-bit builds</span>
├<span class="red">── l10n</span>
│<span class="red">   ├── $L10N					# mercurial clone</span>
│<span class="red">   ├── merge-$L10N 				# updated $L10N files</span>
│<span class="red">   └── wip 					# temporary workspace for FF57+ builds</span>
└──$REL							# build tree for each of release, beta, esr52, central
    ├── comm-$REL					# mercurial clone
    │   └── mozilla					# bind to $MOZBUILD/mozilla
    ├── {firefox,seamonkey,thunderbird}-build-dir	# build directories
    ├── packaging-{FF,SM,TB}
    │   └── lib						# package source to install to /opt/..
    └── built
        ├── firefox-{version}<span class="red">$LOCN</span>-$ARCH.txz		# the Firefox Slackware package
        ├── seamonkey-{version}<span class="red">$LOCN</span>-$ARCH.txz		# the Seamonkey Slackware package
        └── thunderbird-{version}<span class="red">$LOCN</span>-$ARCH.txz	# the Thunderbird Slackware package
</code>
<p>

<br>
<b>Set variables</b>
<br>
User set:
<br>
<code class="gray">export MOZBUILD=<b>/mozbuild</b>
<span class="dastx">##</span> Set which repositories to clone:
export REPOS="<b>release</b> <b>beta</b> <b>esr52</b> <b>central</b>"
<span class="dastx">##</span> choose which to build:
export REL=<b>esr52</b>
<span class="dastx">##</span> set number of parallel jobs
export NUMJOBS=<b>-j2</b>
<span class="red">export L10N=<b>en-GB</b></span>
<span class="dastx">##</span> the default for quantum [FF57+] stylo builds only
export STYLO=<b>yes</b>
</code>
<br>
From system:
<br>
<code class="gray"><span class="dastx">##</span> 'uname -m' won't identify the architecture where a 64-bit kernel is being used for a 32-bit system
export ARCH=x86_64 &amp;&amp; [[ $(getconf LONG_BIT) == 32 ]] &amp;&amp; export ARCH=i686
<span class="dastx">##</span> 'gtk2' option for esr52 only - 'cairo-gtk2' option has been removed from 53.x; otherwise 'gtk3'
export GTK=gtk3 &amp;&amp; [[ $REL == esr52 ]] &amp;&amp; export GTK=gtk2
<span class="red">export LOCN=-$(echo $L10N | tr - _)</span>
</code>

<p>
<b>Create build directories</b><br>
<code class="gray">mkdir -p $MOZBUILD/sources
<span class="red">mkdir -p $MOZBUILD/l10n/wip</span>

<span class="dastx">##</span> Set which directories to create:
REPOS=$REPOS
(for repo in $REPOS
do
mkdir -p $MOZBUILD/$repo/{packaging-{FF,SM,TB},built}
done)
</code>

<p>
<b>Mercurial bundles and repositories</b><br>
mozilla-unified is downloaded as a bundle [~800<font size="-1">x</font>10<sup>6</sup> B] and is unbundled to a sub-directory of $MOZBUILD.<br>
The key advantage of using a bundle rather than cloning the repo is that an interrupted download can be resumed. <br>
It also puts less of a load on the server - see <a class="extlink" href="http://gregoryszorc.com/blog/2015/05/29/faster-cloning-from-hg.mozilla.org-with-server-provided-bundles/">here</a> and <a class="extlink" href="http://gregoryszorc.com/blog/2015/10/22/cloning-improvements-in-mercurial-3.6/">here</a>.


<p>mozilla-unified<br>
Requires mercurial with zstd support [v4.1.2 works], otherwise view 'bundles' file and choose compression type<br>
<code class="gray">(cd $MOZBUILD/sources
<span class="dastx">##</span> get mozilla-unified bundle
wget -O bundles https://hg.cdn.mozilla.net/
BUNDLE=$(grep mozilla-unified.*zstd bundles | sed 's|.*href="||;s|">.*$||')
wget -O mozilla-unified.zstd.hg https://hg.cdn.mozilla.net/$BUNDLE)

(cd $MOZBUILD
<span class="dastx">##</span> unbundle mozilla-unified
hg init mozilla
hg unbundle $MOZBUILD/sources/mozilla-unified.zstd.hg -R mozilla
<span class="dastx">##</span> set default repo to pull from
echo "[paths]
default = https://hg.mozilla.org/mozilla-unified/" > mozilla/.hg/hgrc
<span class="dastx">##</span> get new changesets since bundle was created
hg pull -R mozilla
<span class="dastx">##</span> update local repo
hg update -R mozilla)
</code>

<p>
comm-$REL, chatzilla, inspector, and locale have to be cloned as no bundle is available.
<br>
There is a comm-central bundle, but to keep things consistent, let's clone that too &hellip;
<br>
<code class="gray"><span class="dastx">##</span> Set which repositories to clone:
REPOS=$REPOS

(for repo in $REPOS
do
cd $MOZBUILD/$repo
RELEASES="/releases" &amp;&amp; [[ $repo == central ]] &amp;&amp; unset RELEASES
hg clone https://hg.mozilla.org${RELEASES:-""}/comm-$repo/
done)
</code>

<p> Add chatzilla [IRC] and inspector [DOM] repos if required.
<br>
Although these are shown as optional, they are in fact default build options for Seamonkey 2.49 and would have to be specifically excluded from the Seamonkey build.
<br>
<code class="green">(cd $MOZBUILD/mozilla/extensions
hg clone https://hg.mozilla.org/chatzilla/ irc
hg clone https://hg.mozilla.org/dom-inspector/ inspector)
</code>
<p>
From FF57:
<br>Chatzilla extension doesn't work from mozilla [firefox quantum] 57 onwards - that is from Seamonkey 2.54 onwards [<a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1392807">bugzilla</a>, <a class="extlink" href="http://chatzilla.hacksrus.com/">Latest News</a>, <a class="extlink" href="https://blog.mozilla.org/addons/2016/11/23/add-ons-in-2017/">why</a>, <a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1322442">solution?</a>]
<br>
Trying to run it from Seamonkey will give a GUI error message:
<br><code class="console">Remote XUL
This page uses an unsupported technology that is no longer available by default.
</code>
<br>
and a console error message:
<br><code class="console">JavaScript error: chrome://chatzilla/content/handlers.js, line 10: TypeError: client.deck is undefined
JavaScript error: chrome://chatzilla/content/static.js, line 927: TypeError: client.statusElement is undefined
</code>

<p>
non-US locale<br>
Use l10n mozilla-central repository and revert to the official revisions when required as per l10n_changesets.txt [FFesr52], or l10n-changesets.json [FF59+].
<br>
<code class="red">(cd $MOZBUILD/l10n/
hg clone https://hg.mozilla.org/l10n-central/$L10N/)
</code>

<br>
If the localization has not been updated for new files or strings from the en-US locale, then the build will fail or run-time failures will occur on those omissions.
<br>
A check should therefore be made to ensure that there are no missing files or strings in the localization, which is done with <i>compare-locales</i> - see '<a href="#l10n">Localization</a>'.
<p>
<a name="UpdateRepoReturn"></a>

Once these locally cloned repositories have been set up, they can be kept up-to-date for future builds - see 'Add new changesets'.
<p>

<b><span class="red">Dictionaries</span></b>
<br>
To avoid this build failure on installation:
<br>
<code class="console">Error: ...browser/installer/package-manifest.in:50: Missing file(s): bin/dictionaries/*</code>
<br>
comment out line 50 in package-manifest.in &hellip;
<br>
<b style="color: darkblue;">OR</b> download and install a dictionary [recommended]:
<br>
Links to dictionaries are available at <a class="extlink" href="https://addons.mozilla.org/language-tools/">Mozilla addons</a>
<br>
<code class="red">(cd $MOZBUILD/sources
wget -O $L10N-dict.xpi https://addons.mozilla.org/firefox/downloads/latest/british-english-dictionary-2/addon-461570-latest.xpi)
</code>

<p>
<b>Autoconf</b>
<br>Building needs autoconf-2.13 for the '--localdir=' option which the later versions don't have.
<br>Build and install to temporary directory for use with this build only.
<br>
<code class="gray">(cd $MOZBUILD/sources
wget http://ftpmirror.gnu.org/autoconf/autoconf-2.13.tar.gz

tar xf autoconf-2.13.tar.gz
cd autoconf-2.13
./configure --prefix=$MOZBUILD/sources/autoconf_213
make
make install)
</code>
<br>
autoconf is now installed at $MOZBUILD/sources/autoconf_213/bin/autoconf and this path is included in mozconfig.common.

<p>
<b>Rust</b>
<br>
What is rust and why should I use it? - see <a class="extlink" href="https://hacks.mozilla.org/2016/07/shipping-rust-in-firefox/">here</a> and <a class="extlink" href="http://www.zdnet.com/article/mozilla-begins-process-of-letting-firefox-rust/">here</a>. Building with rust is the default for 54.x onwards.
<br>
<code class="gray">(cd $MOZBUILD/sources/
wget -O rust.html https://www.rust-lang.org/en-US/other-installers.html
URL=$(grep "rust-[1-9].*$ARCH-unknown-linux-gnu.tar.gz\">" rust.html | sed 's|.*href="||;s|">.*$||')
wget $URL

tar xf rust*$ARCH-unknown-linux-gnu.tar.gz
cd rust*$ARCH-unknown-linux-gnu
./install.sh --prefix=$MOZBUILD/sources/rust-$ARCH --without=rust-docs)
</code>
<br>Building with rust enabled requires rustc to be in the PATH which is set as a shell variable.

<p>
<b><a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1339162">Patch required</a></b> for cargo-0.18.0+:
<br>
<code class="gray">[[ ! $(grep build $MOZBUILD/mozilla/media/libstagefright/binding/mp4parse_capi/Cargo.toml) ]] &amp;&amp; \
sed -i '21ibuild = false\n' $MOZBUILD/mozilla/media/libstagefright/binding/mp4parse_capi/Cargo.toml
</code>

<p>
<b><a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1384062">Patch required</a></b> for esr52 build error:
<br>
<code class="console">AssertionError
  File "..../testing/mozbase/mozsystemmonitor/mozsystemmonitor/resourcemonitor.py", line 289, in stop
    assert self._running
</code>
<br>
<code class="gray">[[ $REL == esr52 ]] &amp;&amp; \
(cd $MOZBUILD/sources/
[[ ! -e 8d9ae8c45dd0 ]] &amp;&amp; wget https://hg.mozilla.org/mozilla-central/raw-rev/8d9ae8c45dd0)
</code>


<p>
<!--
Add new changesets - start
-->
<a name="close_chset"></a>
<br>
<span class="tabs"><a href="#Locrep">Add new changesets</a></span><span style="vertical-align:-30%">&nbsp;&nbsp;to all cloned repositories prior to any <a class="extlink" href="https://wiki.mozilla.org/RapidRelease/Calendar">future release builds</a> [or as required].</span>
<div id="Locrep" class="tab"><div class="b_32bit"><span class="tabs"><a href="#close_chset">close</a></span>
<code class="appx"><span class="dastx">##</span> Set which repositories to update:
REPOS=$REPOS

(cd $MOZBUILD
hg pull -R mozilla
<span class="green">hg pull -R mozilla/extensions/inspector
hg pull -R mozilla/extensions/irc</span>
<span class="red">hg pull -R l10n/$L10N</span>

for repo in $REPOS
do
hg pull -R $repo/comm-$repo
done)
</code>
<span class="tabs"><a href="#close_chset">close</a></span>
</div>
<br></div>
<!--
Add new changesets - end
-->

Set up the local repositories for chosen $REL, removing any changes made for previous builds:<br>
<code class="gray">(cd $MOZBUILD
hg update $REL -C -R mozilla
hg update default -C -R $REL/comm-$REL/
<span class="green">hg update default -C -R mozilla/extensions/inspector
hg update default -C -R mozilla/extensions/irc</span>
<span class="red">hg update default -C -R l10n/$L10N</span>)
</code>
<p>
<!--
Building to a changeset - start
-->
<a name="close_known_rel"></a>
<br>
<span class="tabs prefs"><a href="#known_rel">Building to an official release revision</a></span>
<div id="known_rel" class="tab"><div class="b_prefs"><span class="tabs"><a href="#close_known_rel">close</a></span>
<!-- leave this space -->
<b>Building to the same revision as a <a class="extlink" href="https://wiki.mozilla.org/RapidRelease/Calendar">specific official release</a></b>
This is relevant for release versions only, beta builds have been specifically excluded.

<b><i>Either</b></i>: Prior to the release date, the changesets on which the release candidates are built can be obtained from mozilla.org.
The final release candidate can be as late as the weekend before the scheduled release date.
This finds the latest release candidate build for any specific Firefox version, and sets the bookmark to that revision &hellip;
<code class="green"><span class="dastx">##</span> <b>Firefox</b>:
<span class="dastx">##</span> FF_VER defaults to the current repo Firefox version and will only give a resultant REL_CAND_CS when the release candidate loses its beta suffix which should be 7-12 days before the release date
<b>FF_VER</b>=$(cat $MOZBUILD/mozilla/browser/config/version.txt)
echo $FF_VER
<span class="dastx">##</span> Override with <b>FF_VER</b>=xx.x[.x] for an earlier version
ESR_SUFF="" &amp;&amp; [[ $REL == esr52 ]] &amp;&amp; ESR_SUFF=esr

(cd $MOZBUILD/sources/
<span class="dastx">##</span> [1] Get list of release candidates and find the latest for this release/esr52 version
wget -O candidates.html https://archive.mozilla.org/pub/firefox/candidates/
REL_CAND=$(grep ${FF_VER} candidates.html|grep -v b[0-9] | grep -o ${FF_VER}${ESR_SUFF:-}-candidates | head -n1)

<span class="dastx">##</span> [2] Get list of release candidate builds and find the latest
wget -O $REL_CAND.html https://archive.mozilla.org/pub/firefox/candidates/$REL_CAND/
BUILD=$(grep build $REL_CAND.html|tail -n1|cut -d"/" -f6)

<span class="dastx">##</span> [3] Download the .json file which includes the changeset reference for that build and find the changeset
JSON="firefox-$(echo $REL_CAND |cut -d- -f1).json"
wget -O $JSON https://archive.mozilla.org/pub/firefox/candidates/$REL_CAND/$BUILD/linux-$ARCH/en-US/$JSON
REL_CAND_CS=$(grep stamp $JSON |colrm 1 23|colrm 13)

cd $MOZBUILD/mozilla/
<span class="dastx">##</span> Revert bookmark to changeset
hg bookmark -r $REL_CAND_CS -f $REL
<span class="dastx">##</span> Set bookmark active
hg checkout $REL)
</code>
<b><i>Or</b></i>: Where the FF version is known, i.e. after its release date, the changeset on which it was built can be determined from the repo log and then the repo reverted to that changeset.
The changeset for any specific release is only tagged as FIREFOX_xx_x[_x]_RELEASE on the official release date.
<code class="green"><span class="dastx">##</span> <b>Firefox</b>:
<span class="dastx">##</span> Set to a sufficiently high number for the changeset to be found
<b>LOG_NUM</b>=4000
<span class="dastx">##</span> Set the Firefox version
<b>REL_TAG</b>=52_7_3
[[ $REL == esr52 ]] &amp;&amp; ESR_SUFF=esr

(cd $MOZBUILD/mozilla/
REL_CAND_CS=$(hg log -l $LOG_NUM | grep FIREFOX_${REL_TAG}${ESR_SUFF:-}_RELEASE | grep -o "Tagging [0-9,a-f]*"|colrm 1 8|colrm 13)
<span class="dastx">##</span> Revert bookmark to changeset
hg bookmark -r $REL_CAND_CS -f $REL
<span class="dastx">##</span> Set bookmark active
hg checkout $REL)
</code>

Just for information.
List last NUM_CS changesets for REL only:
<code class="appx">NUM_CS=5
hg log -l $NUM_CS -Gr ::$REL -R $MOZBUILD/mozilla/ | colrm 1 3
</code>
<span class="tabs"><a href="#close_known_rel">close</a></span>
</div></div>
<!--
Building to a changeset - end
-->
<br>
Find the Firefox major version for later comparisons
<br>
<code class="gray">MAJ_VER=$(cat $MOZBUILD/mozilla/browser/config/version.txt | cut -d. -f1)
</code>

<p>
<b>Create mozconfigs</b>
<br>
As three packages are being built, set up mozconfig.{common,firefox,seamonkey,thunderbird}
<br>
'mach' will install wherever '--prefix=' points to.
<br>
Other options can be seen in 'old-configure'
<p>
mozconfig.common:
<br>
<code class="gray">(cd $MOZBUILD/mozilla
cat &gt; mozconfig.common &lt;&lt; "EOF"
mk_add_options MOZ_MAKE_FLAGS=$NUMJOBS

<span class="dastx">##</span> If you have installed DBus-Glib comment out this line:
#ac_add_options --disable-dbus

<span class="dastx">##</span> If you have installed dbus-glib, and you have installed (or will install)
<span class="dastx">##</span> wireless-tools, and you wish to use geolocation web services, comment out
<span class="dastx">##</span> this line
ac_add_options --disable-necko-wifi

<span class="dastx">##</span> Build with gtk2 or gtk3
ac_add_options --enable-default-toolkit=cairo-$GTK

<span class="dastx">##</span> Uncomment this option if you don't have PulseAudio installed
#ac_add_options --disable-pulseaudio

<span class="dastx">##</span> If you have installed GConf, comment out this line
ac_add_options --disable-gconf

ac_add_options --disable-crashreporter
ac_add_options --disable-updater
ac_add_options --disable-tests
ac_add_options --enable-optimize
ac_add_options --disable-official-branding
ac_add_options --with-pthreads
ac_add_options --with-system-zlib

mk_add_options AUTOCONF=$MOZBUILD/sources/autoconf_213/bin/autoconf

EOF
)
</code>

<br>
These options are not recognized from 57.x and cause a build failure:
<br>
<code class="gray">[[ $MAJ_VER -lt 57 ]] &amp;&amp; \
(cd $MOZBUILD/mozilla
cat &gt;&gt; mozconfig.common &lt;&lt; "EOF"
ac_add_options --enable-safe-browsing
ac_add_options --enable-url-classifier

EOF
)
</code>
<br>
For FF57+, with the default stylo build, set LLVM_CONFIG to avoid this error:
<br><code class="console">ERROR: Could not find LLVM/Clang installation for compiling stylo build-time bindgen.  <br>Please specify the 'LLVM_CONFIG' environment variable (recommended), ...</code>
<br>
<code class="gray">[[ $MAJ_VER -ge 57 ]] &amp;&amp; { [[ $STYLO == yes ]] &amp;&amp; \
export LLVM_CONFIG=$MOZBUILD/sources/llvm/usr/bin/llvm-config || \
(cd $MOZBUILD/mozilla
cat &gt;&gt; mozconfig.common &lt;&lt; "EOF"
ac_add_options --disable-stylo

EOF
)
}
</code>
<p>
For optional non-US single locale version for esr52 builds only:&nbsp;
<br>Produces a "TypeError: 'NoneType' object is not iterable" build error for FF57+ - see 'Workaround for FF57+' in 'Localization'
<br><code class="red">[[ $MAJ_VER -lt 57 ]] &amp;&amp; \
(cd $MOZBUILD/mozilla
cat &gt;&gt; mozconfig.common &lt;&lt; "EOF"
<span class="dastx">##</span> To build a single locale version
ac_add_options --enable-ui-locale=$L10N
ac_add_options --with-l10n-base=$MOZBUILD/l10n

EOF
)
</code>

<p>
mozconfig.firefox:
<br>
<code class="gray">(cd $MOZBUILD/mozilla
cat &gt; mozconfig.firefox &lt;&lt; "EOF"
<span class="dastx">##</span> include the common mozconfig
source $MOZBUILD/mozilla/mozconfig.common

<span class="dastx">##</span> for Firefox build
ac_add_options --enable-application=browser
mk_add_options MOZ_OBJDIR=$MOZBUILD/$REL/firefox-build-dir
ac_add_options --prefix=$MOZBUILD/$REL/packaging-FF

EOF
)
</code>

<p>
mozconfig.seamonkey:
<br>
<code class="gray">(cd $MOZBUILD/$REL/comm-$REL
cat &gt; mozconfig.seamonkey &lt;&lt; "EOF"
<span class="dastx">##</span> include the common mozconfig
source $MOZBUILD/mozilla/mozconfig.common

<span class="dastx">##</span> for Seamonkey build
ac_add_options --enable-application=suite
mk_add_options MOZ_OBJDIR=$MOZBUILD/$REL/seamonkey-build-dir
ac_add_options --prefix=$MOZBUILD/$REL/packaging-SM

EOF
)
</code>

<p>
mozconfig.thunderbird:
<br>
<code class="gray">(cd $MOZBUILD/$REL/comm-$REL
cat &gt; mozconfig.thunderbird &lt;&lt; "EOF"
<span class="dastx">##</span> include the common mozconfig
source $MOZBUILD/mozilla/mozconfig.common

<span class="dastx">##</span> for Thunderbird build
ac_add_options --enable-application=mail
mk_add_options MOZ_OBJDIR=$MOZBUILD/$REL/thunderbird-build-dir
ac_add_options --prefix=$MOZBUILD/$REL/packaging-TB

EOF
)
</code>


<p>
Bind the mozilla repository into the comm-$REL tree - linking confuses the build for the ${_topsrcdir} value.
<br>
Needed for Seamonkey/Thunderbird builds, and to simplify the use of compare-locales for localization.
<br>
<code class="gray">(cd $MOZBUILD/$REL/comm-$REL
mkdir -p mozilla
mount -B $MOZBUILD/mozilla mozilla

<span class="dastx">##</span> Remove any stale configure file:
rm -f $MOZBUILD/mozilla/configure)
</code>
<p>

<!--
User preferences - start
-->
<a name="close_prefs"></a>
<br>
<span class="tabs prefs"><a href="#Prefs">User preferences</a></span>
<div id="Prefs" class="tab"><div class="b_prefs"><span class="tabs"><a href="#close_prefs">close</a></span>
<!-- leave this space -->
<b>User preferences options</b>
<b>[1]</b> To enable <a class="extlink" href="https://wiki.mozilla.org/Electrolysis">e10s</a> by default:
<code class="green">cd $MOZBUILD
<span class="dastx">##</span> <b>Firefox</b>:
sed -i 's|pref("browser.tabs.remote.autostart", false);|pref("browser.tabs.remote.autostart", true);|' mozilla/browser/app/profile/firefox.js

<span class="dastx">##</span> <b>Seamonkey</b>:
echo 'pref("browser.tabs.remote.autostart", true);' >> $REL/comm-$REL/suite/browser/browser-prefs.js
echo 'pref("browser.tabs.remote.desktopbehavior", true);' >> $REL/comm-$REL/suite/browser/browser-prefs.js
</code>
<b>[2]</b> Where the server or meta tags don't identify file encoding, setting default fallback encoding to UTF-8 has been <a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=967981#c4">deliberately blocked</a>.
To enable default fallback encoding to be set to UTF-8:
<code class="green"><span class="dastx">##</span> <b>Firefox and Seamonkey</b>:
<span class="dastx">##</span> remove UTF8 block:
[[ $MAJ_VER -ge 56 ]] &amp;&amp; \
sed -i 's|IsAsciiCompatible() .*$|IsAsciiCompatible() ) {|;/UTF_8/d' mozilla/dom/encoding/FallbackEncoding.cpp || \
sed -i 's|(mFallback).*$|(mFallback)) {|;/UTF-8/d' mozilla/dom/encoding/FallbackEncoding.cpp

<span class="dastx">##</span> set "Fallback Text Encoding" to 'Unicode' by default
<span class="dastx">##</span> otherwise, "Fallback Text Encoding" will default to 'Default for Current Locale':
sed -i 's|fallback.override.*$|fallback.override",      "UTF-8");|' mozilla/modules/libpref/init/all.js

<span class="dastx">##</span> <b>Firefox</b>:
<span class="dastx">##</span> To allow manual selection of UTF-8, add Unicode option to "Preferences|Content|Fonts &amp; Colors|Advanced|Fallback Text Encoding" menu:
[[ $MAJ_VER -lt 56 ]] &amp;&amp; line_no=272 || line_no=293
sed -i "${line_no}i\            &lt;menuitem label=\"\&amp;languages.customize.Fallback.unicode;\"     value=\"UTF-8\"/&gt;" mozilla/browser/components/preferences/fonts.xul
sed -i '104i&lt;!ENTITY languages.customize.Fallback.unicode     "Unicode"&gt;' mozilla/browser/locales/en-US/chrome/browser/preferences/fonts.dtd
<span class="dastx">##</span> replace/remove 'legacy' reference in menu:
sed -i 's|Legacy|Unidentified|;s|legacy content|content|' mozilla/browser/locales/en-US/chrome/browser/preferences/fonts.dtd
<span class="dastx">##</span> Change '&hellip; {my,your} selections &hellip;' to '&hellip; the selections &hellip;'
sed -i 's| [a-z]* selections| the selections|' $MOZBUILD/mozilla/browser/locales/en-US/chrome/browser/preferences/{colors,fonts}.dtd

<span class="dastx">##</span> <b>Seamonkey</b>:
<span class="dastx">##</span> To allow manual selection of UTF-8, add Unicode option to "Preferences|Browser|Languages|Fallback Text Encoding" menu:
sed -i '116i\            &lt;menuitem label="\&FallbackCharset.unicode;"     value="UTF-8"/>' $REL/comm-$REL/suite/common/pref/pref-languages.xul
sed -i '37i&lt;!ENTITY FallbackCharset.unicode      "Unicode">' $REL/comm-$REL/suite/locales/en-US/chrome/common/pref/prefutilities.dtd
<span class="dastx">##</span> and for "Preferences|Mail &amp; Newsgroups|Text Encoding" menu:
sed -i '98i\            &lt;menuitem label="\&FallbackCharset.unicode;"     value="UTF-8"/>' $REL/comm-$REL/suite/mailnews/prefs/pref-character_encoding.xul
sed -i '60i\            &lt;menuitem label="\&FallbackCharset.unicode;"     value="UTF-8"/>' $REL/comm-$REL/suite/mailnews/prefs/pref-character_encoding.xul
<span class="dastx">##</span> replace/remove 'legacy' reference in menu:
sed -i 's|Legacy|Unidentified|;s|legacy content|content|' $REL/comm-$REL/suite/locales/en-US/chrome/common/pref/pref-languages.dtd
sed -i 's|Legacy|Unidentified|' $REL/comm-$REL/suite/locales/en-US/chrome/common/help/cs_nav_prefs_navigator.xhtml

<span class="dastx">##</span> <b>Thunderbird</b>:
<span class="dastx">##</span> Change '&hellip; {my,your} selections &hellip;' to '&hellip; the selections &hellip;'
sed -i 's| [a-z]* selections| the selections|' $REL/comm-$REL/mail/locales/en-US/chrome/messenger/preferences/colors.dtd
</code>
<b>[3]</b> To include the Seamonkey search box by default:
<code class="green"><span class="dastx">##</span> <b>Seamonkey</b>:
sed -i 's|nav-bar-inner,|&amp;search-container,|' $REL/comm-$REL/suite/browser/navigator.xul
</code>
<b>[4]</b> Extensions - Chatzilla &amp; Inspector:</span>
<b><i>only for esr52</i></b>
Chatzilla can be built into Firefox, but can't be enabled without turning off Mozilla verification for extensions [xpinstall.signatures.required;false] - so it's not included in this build. As a download from Mozilla addons, it IS verified.
The default extensions for Seamonkey are " inspector irc gio". <span class="comment">[suite/confvars.sh:MOZ_EXTENSIONS_DEFAULT=" inspector irc gio"]</span>

<b>[5]</b> For esr52, set Seamonkey and Thunderbird versions to correspond to the mozilla [FF] release on which they are based:
<code class="green"><span class="dastx">##</span> <b>Seamonkey/Thunderbird</b>:
[[ $REL == esr52 ]] &amp;&amp; \
{ echo 2.49.$(cat $MOZBUILD/mozilla/browser/config/version.txt|cut -d. -f2-) > $MOZBUILD/$REL/comm-$REL/suite/config/version.txt
cp $MOZBUILD/mozilla/browser/config/version.txt $MOZBUILD/$REL/comm-$REL/mail/config/version.txt
}
</code>
<b>[6]</b> For esr52, set new tab page to blank:
<code class="green"><span class="dastx">##</span> <b>Firefox</b>:
[[ $REL == esr52 ]] &amp;&amp; \
echo "body { display:none; }" > $MOZBUILD/mozilla/browser/base/content/newtab/newTab.css
</code>
<b>[7]</b> Change default page options for FF57+:
Ref. aboutNewTabService.js:
<code class="console"> * 1. Browser chrome access:
 *
 * When the user issues a command to open a new tab page, usually clicking a button
 * in the browser chrome or using shortcut keys, the browser chrome code invokes the
 * service to obtain the newtab URL. It then loads that URL in a new tab.
 *
 * When not overridden, the default URL emitted by the service is "about:newtab".
 * When overridden, it returns the overriden URL.
 *
 * 2. Redirector Access:
 *
 * When the URL loaded is about:newtab, the default behavior, or when entered in the
 * URL bar, the redirector is hit. The service is then called to return either of
 * two URLs, a chrome or the activity stream one, based on the
 * browser.newtabpage.activity-stream.enabled pref.
 *
 * NOTE: "about:newtab" will always result in a default newtab page, and never an overridden URL.
 *</code>
<code class="green"><span class="dastx">##</span> <b>Firefox</b>:
[[ $MAJ_VER -ge 57 ]] &amp;&amp; \
{
<span class="dastx">##</span> Default to blank page on start ...
sed -i 's|about:home|about:blank|' $MOZBUILD/mozilla/browser/branding/*/locales/browserconfig.properties
<span class="dastx">##</span> ... and stop the privacy page loading:
sed -i 's|true|false|' $MOZBUILD/mozilla/toolkit/components/telemetry/datareporting-prefs.js
<span class="dastx">##</span> Load a blank page with Ctrl+T or new tab button - about:newtab continues to load the newtab page.
<span class="dastx">##</span> This <span class="appx">"about:blank";</span> replacement could be <span class="appx">"file:///path/to/my/newtab_page.html";</span> to load a customized page:
sed -i 's|"about:newtab";|"about:blank";|' $MOZBUILD/mozilla/browser/components/newtab/aboutNewTabService.js
}
</code>
<span class="tabs"><a href="#close_prefs">close</a></span>
</div>
</div>
<!--
User preferences - end
-->

<!--
Tooltip box - start
-->
<a name="close_ttip"></a>
<br>
<span class="tabs prefs"><a href="#Ttipbox">Gtk3 configuration</a><span style="vertical-align:-30%">&nbsp; Not a part of the build, just some customization options, for example where the defaults for gtk2/gtk3 differ &hellip;</span></span>
<p>
<div id="Ttipbox" class="tab"><div class="b_prefs"><span class="tabs"><a href="#close_ttip">close</a></span>
<!-- leave this space -->
[1] The default <b>tooltip box</b> for the default gtk3 Adwaita theme has white text on a black background with some padding:

<img
src="data:image/png;base64,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
We50eHBNvsTbYGu9vNdL6m3XdOEb7gez1bhCSIqGmTL1y9fq+yxtd9K0VKxo8dVVVjbrA3MW43y7XdSoGOzw0tJOvXJ3+f+hq10
s9Pd+7y126G0WoeeZLvgA/tpVKZUiWvuF/Dsm4ZJeUB2g8qP3xMBGKQ85h7qZ3Bcby51fXllWuuVpdBozIYtDqNWiGXUxSJ4zhJ
Dtg+LIYBz/M04664V9XS2iqlpEqFTCalZFKKklLCHYUD5QvhIwZAcACAYRhJUs3NzoaGhtra2rq6eobp/tT7gUF43o3b7bY3OVp
aWjmO1+s0UooULhL2kVPEQDEwgmuzhWE43vZoEACMICQ4LvGd8hBDEU9voukvPM+zrLvj/KrLNYC2EcME9ARMhKggwSFEBQkOIS
pIcAhRQYJDiAoSHEJUiF8eEfut5wgfERFIlpoG+1FPDJ35RogJ6lIRooIEhxAVJDiEqAzkuVSvyOVyl8uFRo3DEgzDpFJpS0uLl
2KirX6JRIIeETLswXHc8+3xInWpcrkcqe1pgOM4uVzuoYBIGU54f40IjhBPHAzDPCQXkTIcUtvTg+d1jfZSEaKCBIcQFSQ4hKgg
wSFEBQkOISpIcAhRQYJDiAoSHEJUkOAQooIEhxAVJDiEqAxGwS1ZsuT8+fMOh6Opqeny5cvx8fFPOqKBYenSpQaDobdfR48ezfM
8QXi5QnHmzJlff/21QqEAgNjY2AsXLjidzsbGxgsXLixevNiDI6/28/Pz3W632+3mOI7jOGH64MGD27dv3717d18X0iu8KPQ9nq
SkJKvVGhcX5+/vr9PpFi1aZDKZMjIyBmyBnxy3b98eN25cb7/2RXAajaampmbChAkAsHr16sbGxoSEBH9/f4VCsWzZsoaGhtdff
71HRziOd7c/ffr0wMDA7l4OHz78/vvvd3wlCOLatWvz58/v84J6EhUxf9etvhvyNXq9/p133omPjz927JgwJzc312azFRYW7t27
VyqVfvPNN8nJyTExMUFBQadOnVq7di3LslOnTt2xY4fBYGhtbf3DH/7wj3/8IzQ09Pbt26tWrYqLiwsODi4uLl6xYkUX3b/yyiv
vvvuuVqt1u91bt27961//2vnX3ix093X37t3ly5d/+eWXarXaarUmJyfv3LkTAG7cuJGUlPTZZ591LMi4ceMKCgpSU1NzcnJ68x
4fH5+SkqLVao8dO5aYmNjlYsa1a9eeOXPmxo0bSqUyIyPjrbfeys5ue1XV0aNHTSYTTdOdHV26dOnbb7/93e9+l5aWNm/evC6tn
ZiYuH//fpPJ5HmluN3uLVu2bNmy5eTJk31cj55E9eCBRYRPHwNdsGBBa2srjnft6Kuqql5//XVhG01JSQEAlUpVUVGxZMkSnU5X
X1//2muvAUBYWJjNZnvuuecCAwN5nl+/fj0AqNVqi8Uya9aszgalUqndbhe22hkzZjAMM2LEiM4FerTQo68DBw5s2LABAKKjo8+
dO/fPf/4TAAICApqbmztfikgQBM/zQuLp0buwdO+99x6O44GBgbW1tUuWLOnSDt9+++3ChQsBYObMmb1d6tjZUVBQEM/zb7/9No
Zh3TNcbm7unDlzulvokuGEgJubm8PDw7sX7hEPShhcYzi9Xm82m7tfvlddXe3n5ydMHz58GAAcDkdBQUFUVNTs2bOtVuvHH38MA
OXl5cePH+8Yygglm5qa7ty5M2rUqM4GXS7XyJEjP/30UwAoKipiGGbMmDHd4+lioUdfhYWFM2bMAIBZs2bt379/0qRJOI5HRUUV
FRX1doG/B+/vv/8+x3Emk+nkyZNRUVGda2m12oiIiPPnzwsNZbPZvN5AICT1w4cPd87usbGxJpPJZDJFR0cfO3bMZDKVlZV5tuN
yua5evTpt2jTPxfqCqDfReMVsNgcFBUkkki5dSXBwsMXSlibr6+uFCbvdPmrUqMDAwNDQ0Lt37wozZTJZbm6uMN3Y2ChMcBwn6f
b26jfeeGPx4sVCNqUoqnta7W6hR1+nTp3605/+JJFIZs2atX379hUrVkycODEqKqqjM+2R3rx3dHD19fVdNhKj0ciybF1dHQBYL
BaDwaBSqRwOhwcvAh1NJ5CXl5eXlwcAubm5+/fvP3XqlFcLAGA2m3sc8PWXwSW4c+fOuVyuX/ziFwcPPnyzalRUVGBgYGFhoUwm
A4CAgID79+8DgJ+fX11dXU1Nze3btyMjIzvb8do0CxYsSEtLmzJlSkVFBY7jfVltANCjLwC4devWnDlzpFJpbW1tUVHRT3/605k
zZ2ZlZT2Gdz8/v6qqKgAwGAyCtnrkypUrDQ0Nq1at2rFjR8fM+fPnjx8/fteuXV0K92unzdcMri7V6XSmpKRkZWUJO19arTYmJu
bIkSObN2/u2PRXrlwJAH5+fvPmzTt9+vQXX3wRFBQkjIiVSuWBAwcmTZrk1dGIESMsFsu9e/dwHE9NTeV5XqlUeq3Vm6/CwsK0t
LT//Oc/AFBUVBQbGyuTyW7evNm5LsdxLMtqtVrP3juW7tVXXz19+nRnC2azWSKR+Pv7A4DL5UpKSsrIyFi3bt0zzzyj0Wji4uIO
Hz589+7dzo4GEKPR6HX3oi8MLsEBwN69e+Pj4+Pj48vKyqqqqlJSUpKTk3//+993FKipqbl+/fq1a9eOHTuWn59vt9ujo6M3bdp
0586dkpISq9V6/fp1r14++uij6urqO3fuFBcXl5aWHjp0KDs7+9lnn/VcqzdfBQUF06dPP3PmDABcvnx5ypQpBQUFXepyHPfhhx
9+/vnna9eu7dF7eHi4y+WqqakpKSnpWLou3ktLSzsGUtnZ2UuWLImJibl582ZlZWV8fPyiRYvy8vI6O/K8OIsWLepjfyqVSidPn
iwMH78nA/kUcw+MGBHw/Y2MHj26oqKCIAhxXgw8CNm0aVN4ePjy5ctF9rt48eK0tLTnn3++j+U9iGrQZTivPM1v/9i5c+fMmTO9
ZuKBhSCIjRs3bty4cWCsXblyaUAMIUSgsbFx+fLlR44ceemll5qbm8Vxum3btrNnz544caLvVTyISqQboZ/mtPQU4kFUQ69LRQx
pkOAQooIEhxAVJDiEqCDBIUQFCQ4hKkhwCFFBgkOIikiCQwd+nx48r2uRBCeVSsVxhHjieF7X6CnmiIFksDzFHABYlpXJZKhvHa
5gGCaTybxeOYZe7oYQFbSXihAVJDiEqCDBIUQFCQ4hKkhwCFH5fyn0QwztbDFaAAAAAElFTkSuQmCC" alt="">

which is set by the tooltip section in <i>gtk/theme/Adwaita/gtk-contained.css</i> in the gtk3 source:
<pre>
tooltip {
  padding: 4px;
  /* not working */
  border-radius: 5px;
  box-shadow: none;
  text-shadow: 0 1px black; }
tooltip.background {
  background-color: rgba(0, 0, 0, 0.8);
  background-clip: padding-box;
  border: 1px solid rgba(255, 255, 255, 0.1); }
tooltip decoration {
  background-color: transparent; }
tooltip * {
  padding: 4px;
  background-color: transparent;
  color: white; }
</pre>Overriding this with:<br><pre>
tooltip {
  border-radius: 0px;
  text-shadow: none;}
tooltip.background {
  background-color: #eee1b3;
  border: 1px solid gray;}
tooltip * {
  padding: 0px;
  color: black;}
</pre>in <b><i>~/.config/gtk-3.0/gtk.css</i></b>, will show the tooltip as:

<img
src="data:image/png;base64,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" alt="">

[2] <b><i>~/.config/gtk-3.0/gtk.css</b></i>
To show scroll-bar stepper icons and set the slider width/height, add:
<pre>
* {
  -GtkScrollbar-has-backward-stepper: true;
  -GtkScrollbar-has-forward-stepper: true; }
scrollbar slider {
  min-width: 10px;
  min-height: 10px; }
scrollbar.horizontal slider {
  min-width: 40px; }
scrollbar.vertical slider {
  min-height: 40px; }
</pre>
[3] <b><i>/etc/gtk-3.0/settings.ini</b></i>
To set 'Print to &hellip;' options, and scroll by one page when clicking in the scroll-bar, add:
<pre>
[Settings]
gtk-print-backends=lpr,file,cups
gtk-primary-button-warps-slider=false
</pre>
See ../gtk-doc/html/gtk3/GtkSettings.html for defaults and more options.
<!-- leave this space -->
<span class="tabs"><a href="#close_ttip">close</a></span>
</div>
</div>
<!--
Tooltip box - end
-->

<!--
Localization - start
-->
<a name="close_l10n"></a>
<br>
<span class="tabs locn"><a href="#l10n">Localization</a><span style="vertical-align:-30%">&nbsp;</span></span>
<p>
<div id="l10n" class="tab"><div class="b_locn"><span class="tabs"><a href="#close_l10n">close</a></span>
<!-- leave this space -->
<b>compare-locales</b> - needs python-setuptools.
compare-locales will identify new files in the en-US locale which aren't in the $L10N locale; and add any new entity strings that are in the en-US locale files but not in the $L10N locale files to copies in the merge-$L10N directory.
The following process extends that to <b>copy new files</b> to the merge-$L10N directory and display them for editing the localization strings.
And displays any <b>new strings added</b> to existing files to show any that need localizing.

<b>Download, build, and install compare-locales.</b>
<i>Note:</i> that this process is set up to use compare-locales v1.2.3, so the build has been reverted to changeset e413c5aba051.
<code class="red">(cd $MOZBUILD/sources
hg clone https://hg.mozilla.org/l10n/compare-locales/ compare-locales
cd compare-locales
hg checkout e413c5aba051
python setup.py build install)
</code>

<b>Known issues</b>
Remove any previously created temporary file lists and merge-$L10N directory:
<code class="red">rm -f $MOZBUILD/l10n/* 2>/dev/null
rm -rf $MOZBUILD/l10n/merge-$L10N
</code>
To build to a FFesr52 release version, download the l10n_changesets.txt file which contains the l10n revision that it was built to [probably hasn't changed since 52.0]:
<code class="green"><code class="red"><span class="dastx">##</span> This defaults to the current repo Firefox version which won't be a valid release candidate unless the bookmark has been set to the appropriate revision - see '<a href="#known_rel">Building to an official release revision</a>' &hellip;
<span class="dastx">##</span> &hellip; override with <b>FF_VER</b>=xx.x[.x] for an earlier version
<b>FF_VER</b>=$(cat $MOZBUILD/mozilla/browser/config/version.txt)
echo $FF_VER

[[ $REL == esr52 ]] &amp;&amp; {
cd $MOZBUILD/sources/
<span class="dastx">##</span> [1] Get list of release candidates and find the latest for this esr52 version
wget -O candidates.html https://archive.mozilla.org/pub/firefox/candidates/
REL_CAND=$(grep ${FF_VER} candidates.html|grep -v b[0-9] | grep -o ${FF_VER}esr-candidates | head -n1)

<span class="dastx">##</span> [2] Get list of release candidate builds and find the latest
wget -O $REL_CAND.html https://archive.mozilla.org/pub/firefox/candidates/$REL_CAND/
BUILD=$(grep build $REL_CAND.html|tail -n1|cut -d"/" -f6)

<span class="dastx">##</span> [3] Download the .txt file which includes the changeset reference for that build and find the changeset
wget -O ${FF_VER}_${BUILD}_l10n_changesets.txt https://archive.mozilla.org/pub/firefox/candidates/$REL_CAND/$BUILD/l10n_changesets.txt 
L10N_CS=$(grep $L10N ${FF_VER}_${BUILD}_l10n_changesets.txt|cut -d" " -f2)

<span class="dastx">##</span> Revert l10n repo to changeset
hg checkout -r $L10N_CS -C -R $MOZBUILD/l10n/$L10N/

<span class="dastx">##</span> Check that l10n repo is at the correct changeset:
<span class="dastx">##</span> echo $L10N_CS ; hg parent -R $MOZBUILD/l10n/$L10N/
}
</code></code>
From FF59.0, the corresponding l10n revisions are contained in a .json file:
<code class="green"><code class="red">[[ $MAJ_VER -ge 59 ]] &amp;&amp; {
L10N_CS=$(grep -A 13 $L10N $MOZBUILD/mozilla/browser/locales/l10n-changesets.json | grep revision | colrm 1 21 |sed 's|"||')
hg checkout -r $L10N_CS -C -R $MOZBUILD/l10n/$L10N/
}
</code></code>
<i>compare-locales</i> doesn't pick up any locale.version change in chatzilla.properties, so to ensure that it matches the en-US string:
<code class="green"><code class="red">[[ $REL == esr52 ]] &amp;&amp; \
sed -i "s|locale.version =.*$|$(grep "locale.version =" $MOZBUILD/mozilla/extensions/irc/locales/en-US/chrome/chatzilla.properties)|" \
$MOZBUILD/l10n/$L10N/extensions/irc/chrome/chatzilla.properties
</code></code>
Add 'irc' paths for <i>compare-locales</i> to include Chatzilla when creating merge-$L10N:
<code class="green"><code class="red">[[ $REL == esr52 ]] &amp;&amp; \
sed -i 's|devtools_client.*$|&amp;\nextensions_irc = mozilla/extensions/irc/locales/l10n.ini|' $MOZBUILD/$REL/comm-$REL/suite/locales/l10n.ini
sed -i 's|devtools/client",|&amp; "extensions/irc",|' $MOZBUILD/$REL/comm-$REL/suite/locales/filter.py
</code></code>
This string in en-GB chatzilla.properties is not consistently localized in all revisions, so make sure:
<code class="green"><code class="red">[[ $REL == esr52 &amp;&amp; $L10N == en-GB ]] &amp;&amp; \
sed -i 's|msg.mnu.motifs.*$|msg.mnu.motifs     = Co\&amp;lour Scheme|' $MOZBUILD/l10n/$L10N/extensions/irc/chrome/chatzilla.properties
</code></code>

<b>Comparing en-US and $L10N localizations</b> &hellip;
Create a list of default en-US localization files:
<code class="red">tree -fi $MOZBUILD/$REL/comm-$REL/{mozilla,suite,mail} | grep en-US | grep ".*\..*$" > $MOZBUILD/l10n/en-US-l10n-files
</code>
&hellip; <b>copy new files</b> &hellip;
Run compare-locales and identify the new files found &hellip;
<code class="red">echo -e 'mozilla/browser\nsuite\nmail' | while read line ; do
compare-locales -m $MOZBUILD/l10n/merge-$L10N $MOZBUILD/$REL/comm-$REL/$line/locales/l10n.ini $MOZBUILD/l10n $L10N \
| tee $MOZBUILD/l10n/$(echo $line | tr / _)-compare-locales-output | grep -B 1  "add and localize this file" \
| grep -Ev "\-\-|localize" > $MOZBUILD/l10n/$(echo $line | tr / _)-new-files
done
</code>
&hellip; find paths of new files and remove duplications where suite/mail use mozilla files &hellip;
<code class="red">echo -e "mozilla_browser\nsuite\nmail" | while read line ; do
cat $MOZBUILD/l10n/$line-new-files | while read line ; do
grep $line $MOZBUILD/l10n/en-US-l10n-files
done ; done | sort -u | tee $MOZBUILD/l10n/new-files-en-US-path \
| sed 's|locales/en-US/||' \
| sed "s|^.*/comm-$REL/mozilla|$MOZBUILD/l10n/merge-$L10N|" \
| sed "s|^.*/comm-$REL|$MOZBUILD/l10n/merge-$L10N|" > $MOZBUILD/l10n/new-files-$L10N-path
</code>
&hellip; and create any new directories in merge-$L10N required by new files &hellip;
<code class="red">cat $MOZBUILD/l10n/new-files-$L10N-path | while read line
do
echo $line | rev | cut -d/ -f2- | rev
done | sort -u | while read line
do
[[ ! -d $line ]] &amp;&amp; mkdir -p $line
done
</code>
&hellip; and copy the new en-US files to the merge-$L10N directory &hellip;
<code class="red">(cd $MOZBUILD/l10n/
paste -d ' ' new-files-en-US-path new-files-$L10N-path | while read line
do
cp $line
done)
</code>
&hellip; and then edit them for localizations:
<code class="red"><b>MY_FAV_EDITOR</b>=kate
$MY_FAV_EDITOR $(cat $MOZBUILD/l10n/new-files-$L10N-path)
</code>

&hellip; <b>new strings added</b>
<i>compare-locales</i> will append any new lines to existing localization files while copying them to merge-$L10N.
The following displays the additional lines to show whether any of them need localizing.
Edit the <b><i>merge-$L10N</b></i> file because that has priority over the equivalent $L10N file during the build [except Chatzilla - see next].
<code class="red">(cd $MOZBUILD/l10n/
<span class="dastx">##</span> list the files that have been added to:
echo -e 'mozilla_browser\nsuite\nmail' | while read line ; do
grep "adding to" $line-compare-locales-output | sed 's|adding to ||g' | tee -a adding-to | sed 's|merge-||g' >> added-from
done

<span class="dastx">##</span> remove duplicate files and display the additional lines:
paste -d " " added-from adding-to | sort -u | while read line
do
diff -U 0 $line
done > added-diffs

<span class="dastx">##</span> display the diff in a syntax highlighting editor to more easily show lines that might need localizing:
$MY_FAV_EDITOR added-diffs)
</code>

A further issue with <i>compare-locales</i> is that the Seamonkey build doesn't include any Chatzilla files from merge-$L10N.
So, copy any new or modified 'irc' files from merge-$L10N to $L10N.
<code class="green"><code class="red">(cd $MOZBUILD/l10n/$L10N/
cp -a ../merge-$L10N/extensions/irc/* extensions/irc)
</code></code>

<b>Set up searchplugins for locale.</b>
This is en-GB specific, but might be adaptable for other locales &hellip;
Set up google search on google.co.uk:
<code class="red">(cd $MOZBUILD/mozilla/browser/locales/searchplugins/
cat google.xml | sed 's|google.com|google.co.uk|g' > google-$L10N.xml)
</code>
<a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1303636">eBay was removed</a> from the list of built-in searchplugins, although it has been re-instated with a nondescript icon.
To recover the previous icon for this personal build, extract the file from a changeset that contains it:
<code class="red">(cd $MOZBUILD/l10n/$L10N
hg revert -r 1a7204 mail/searchplugins/eBay-$L10N.xml
mv mail/searchplugins/eBay-$L10N.xml $MOZBUILD/mozilla/browser/locales/searchplugins)
</code>
Set the default Firefox searchplugins of choice:
<code class="red">sed -i "s|.*chambers-en-GB.*|          \"google-$L10N\", \"eBay-$L10N\", \"amazon-$L10N\", \"ddg\", \"wikipedia\", \"bing\", \"chambers-$L10N\"|" $MOZBUILD/mozilla/browser/locales/search/list.json
</code>

<b>To enable default fallback encoding to be set to UTF-8</b>:
Requires <b>[2]</b> in the previous section '<a href="#Prefs">User preferences</a>' to have been set up.
<code class="green"><code class="red"><span class="dastx">##</span> <b>Firefox</b>:
<span class="dastx">##</span> Modify files in the $L10N and merge-$L10N directories

(cd $MOZBUILD/l10n/
sed -i -e 's|Legacy|Unidentified|;s|legacy content|content|' \
-e '104i&lt;!ENTITY languages.customize.Fallback.unicode     "Unicode">' \
{,merge-}$L10N/browser/chrome/browser/preferences/fonts.dtd  2>/dev/null)
</code>
<code class="red"><span class="dastx">##</span> <b>Seamonkey</b>:
<span class="dastx">##</span> Modify files in the $L10N and merge-$L10N directories

(cd $MOZBUILD/l10n/
sed -i '37i&lt;!ENTITY FallbackCharset.unicode      "Unicode">' {,merge-}$L10N/suite/chrome/common/pref/prefutilities.dtd 2>/dev/null
sed -i 's|Legacy|Unidentified|;s|legacy content|content|' {,merge-}$L10N/suite/chrome/common/pref/pref-languages.dtd 2>/dev/null
sed -i 's|Legacy|Unidentified|' {,merge-}$L10N/suite/chrome/common/help/cs_nav_prefs_navigator.xhtml 2>/dev/null)
</code></code>

Change '&hellip; {my,your} selections &hellip;' to '&hellip; the selections &hellip;'
<code class="green"><code class="red"><span class="dastx">##</span> <b>Firefox</b>:
sed -i 's| [a-z]* selections| the selections|' $MOZBUILD/l10n/{,merge-}$L10N/browser/chrome/browser/preferences/{colors,fonts}.dtd

<span class="dastx">##</span> <b>Thunderbird</b>:
sed -i 's| [a-z]* selections| the selections|' $MOZBUILD/l10n/{,merge-}$L10N/mail/chrome/messenger/preferences/colors.dtd
</code></code>

<b>Workaround for FF57+.</b>

Firstly, a brief explanation.
Up to FF56, it was possible to build a single localized version using 
ac_add_options --enable-ui-locale=
ac_add_options --with-l10n-base=
and
LOCALE_MERGEDIR=

This enabled the additional lines and files identified by compare-locales to be localized prior to the build<sup>§</sup>.

The localization build method was changed for FF57 [<a class="extlink" href="https://blog.mozilla.org/l10n/2017/08/04/create-a-localized-build-locally/">blog</a>, <a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1402564">bugzilla</a>, <a class="extlink" href="https://firefox-source-docs.mozilla.org/build/buildsystem/locales.html">single locale build</a>], but I don't want to change the build method before esr52 EOL [c. 2018-08-20], and am not sure it would allow a pre-set merge-ab-CD directory which is necessary for the above [§].

What I've done is continue from the previous setup for using localized files and copied them to the corresponding en-US locations so the default en-US build uses localized files. A minor issue is that internal localization directories are referenced as en-US, but the dictionary and localization messages are in the intended locale.
<code class="red"><span class="dastx">##</span> Copy en-US and $L10N to a working area:
while read file
do
cp -a --parents $file $MOZBUILD/l10n/wip
done &lt; $MOZBUILD/l10n/en-US-l10n-files
cp -a --parents $MOZBUILD/l10n/$L10N $MOZBUILD/l10n/wip

<span class="dastx">##</span> Remove unwanted mercurial files:
rm -rf $MOZBUILD/l10n/wip$MOZBUILD/l10n/$L10N/.hg*

<span class="dastx">##</span> Overwrite wip&hellip;$L10N with merge-$L10N files:
cp -a $MOZBUILD/l10n/merge-$L10N/* $MOZBUILD/l10n/wip/$MOZBUILD/l10n/$L10N

<span class="dastx">##</span> Create a list of all localized files [unchanged, added to, and new files]:
(cd $MOZBUILD/l10n/wip/
tree -fi * | grep ".*\..*$" | grep -v en-US > $MOZBUILD/l10n/wip/$L10N-l10n-files)

<span class="dastx">##</span> Read from the list of localized files ...
<b>TEST_CP=no</b>
  cat $MOZBUILD/l10n/wip/$L10N-l10n-files | while read line
  do
<span class="dastx">##</span> ... extract the filename ...
  FILE=$(echo $line | rev | cut -d/ -f1 | rev)
<span class="dastx">##</span> ... find the path/file of all en-US occurrences ...
  en_US_file_PATHS=$(grep $FILE $MOZBUILD/l10n/en-US-l10n-files)
<span class="dastx">##</span> ... for each en-US file occurrence, convert it to $L10N path/filename ...
    for en_US_file in $en_US_file_PATHS
    do
    ab_CD_file_PATH=$(echo $en_US_file \
    | sed 's|locales/en-US/||' \
    | sed "s|^.*/comm-$REL/mozilla|$MOZBUILD/l10n/$L10N|" \
    | sed "s|^.*/comm-$REL|$MOZBUILD/l10n/$L10N|")
<span class="dastx">##</span> ... and if the conversion matches the list file, copy the $L10N file to en-US
      for path in $ab_CD_file_PATH
      do
      [[ $TEST_CP == no ]] &amp;&amp; \
      {
      [[ $path == /$line ]] &amp;&amp; cp $MOZBUILD/l10n/wip/$line $en_US_file
      true
      } || \
      {
      echo /$line
      echo $path
      [[ $path == /$line ]] &amp;&amp; echo -e "would copy \n $MOZBUILD/l10n/wip/$line \nto \n $en_US_file"
      echo
      }
      done
    done
  done
</code>
Set the default Firefox searchplugins of choice:
<code class="red">cp $MOZBUILD/mozilla/browser/locales/search/list.json $MOZBUILD/l10n/wip
sed -i "s|.*amazondotcom.*|          \"google-$L10N\", \"eBay-$L10N\", \"amazon-$L10N\", \"ddg\", \"wikipedia\", \"bing\", \"chambers-$L10N\"|" $MOZBUILD/mozilla/browser/locales/search/list.json
</code>
Set the default Seamonkey searchplugins of choice - source them from the browser locale or the L10N repo:
<code class="red">rm $MOZBUILD/$REL/comm-$REL/suite/locales/en-US/searchplugins/*
cp $MOZBUILD/mozilla/browser/locales/searchplugins/{{eBay,google}-$L10N,bing,wikipedia,ddg}.xml \
$MOZBUILD/$REL/comm-$REL/suite/locales/en-US/searchplugins/
cp $MOZBUILD/l10n/$L10N/mail/searchplugins/amazon-$L10N.xml \
$MOZBUILD/$REL/comm-$REL/suite/locales/en-US/searchplugins/
echo "ddg
amazon-$L10N
eBay-$L10N
google-$L10N
wikipedia
bing" > $MOZBUILD/$REL/comm-$REL/suite/locales/en-US/searchplugins/list.txt
</code>
<span class="tabs"><a href="#close_l10n">close</a></span>
</div>
</div>
<!--
Localization - end
-->

<!--
32-bit - start
-->
<a name="close_32bit"></a>
<br>
<span class="tabs th2"><a href="#Th2bit">32-bit version build</a><span style="vertical-align:-30%">&nbsp;&nbsp;Additional configuration where a 64-bit kernel is being used.</span></span>
<p>
<div id="Th2bit" class="tab"><div class="b_32bit"><span class="tabs"><a href="#close_32bit">close</a></span>
<!-- leave this space -->
<code class="thtwo">ARCH=i686
</code>
In this scenario, the installed version of rust is 64-bit, so download and install the 32-bit version
<code class="thtwo">(cd $MOZBUILD/sources/
wget -O rust.html https://www.rust-lang.org/en-US/other-installers.html
URL=$(grep "rust-[1-9].*$ARCH-unknown-linux-gnu.tar.gz\">" rust.html | sed 's|.*href="||;s|">.*$||')
wget $URL

tar xf rust*$ARCH-unknown-linux-gnu.tar.gz
cd rust*$ARCH-unknown-linux-gnu
./install.sh --prefix=$MOZBUILD/sources/rust-$ARCH --without=rust-docs)
</code>
<code class="thtwo">[[ $(uname -m) == x86_64 ]] &amp;&amp; \
(cd $MOZBUILD/mozilla
cat &gt;&gt; mozconfig.common &lt;&lt; "EOF"
<span class="dastx">##</span> For 32 bit version
ac_add_options --target=i686-pc-linux-gnu
ac_add_options --host=i686-pc-linux-gnu

EOF
)
</code>

<b><i>Set up and switch to chroot</i></b>, if required:
<code class="thtwo">mkdir $MOZBUILD/chrt
</code>
<b><i>Either</i></b>:
[1] Build in a 32-bit environment which has been installed in a directory:
<code class="thtwo">CHRT=$MOZBUILD/chrt
</code>
<b><i>Or</i></b>:
Mount 32-bit installation from either [2] VFS (offset according to fdisk setup), or [3] partition:
<code>CHRT=$MOZBUILD/chrt
mkdir $CHRT
[2] mount -o loop -o offset=$((2048*512)) VFS $CHRT
or
[3] mount /dev/sdx $CHRT
</code>
<b><i>Then</i></b>:
<code class="thtwo">mkdir -p $CHRT$MOZBUILD/{mozilla,sources}
mkdir -p $CHRT$MOZBUILD/$REL/{packaging-{FF,SM,TB},built,comm-$REL/mozilla}
<span class="red">mkdir -p $CHRT$MOZBUILD/l10n</span>

<span class="dastx">##</span> mount the required existing directories into the chroot:
mount -B /dev $CHRT/dev
mount -t proc proc $CHRT/proc
mount -B $MOZBUILD/mozilla $CHRT$MOZBUILD/mozilla
mount -B $MOZBUILD/sources $CHRT$MOZBUILD/sources
mount -B $MOZBUILD/$REL/comm-$REL $CHRT$MOZBUILD/$REL/comm-$REL
<span class="red">mount -B $MOZBUILD/l10n $CHRT$MOZBUILD/l10n</span>

chroot $CHRT /bin/bash
<code class="thtwo"><span class="dastx">##</span> Now, in the chroot:
source /etc/profile

<span class="dastx">##</span> Remove any stale configure file:
rm -f $MOZBUILD/mozilla/configure
<span class="dastx">##</span> set a dummy variable to be able to test whether the build is in a chroot
CHRT_TEST=" "
<span class="dastx">##</span> Bind the mozilla repository into the comm-$REL tree:
mount -B $MOZBUILD/mozilla $MOZBUILD/$REL/comm-$REL/mozilla
</code></code>
<span class="tabs"><a href="#close_32bit">close</a></span>
</div>
</div>
<!--
32-bit - end
-->
<p><br>
<b>Set up rust.configure</b> for i686.
<br>
This applies only to 52.x versions because for 53.x versions onwards, rust.configure includes i686-unknown-linux-gnu.
<br>
To avoid a "can't find crate for `std`" error:
<br>
<code class="thtwo">[[ $ARCH == i686 ]] &amp;&amp; [[ $MAJ_VER -eq 52 ]] &amp;&amp; \
sed -i 's|i586-unknown-linux-gnu|i686-unknown-linux-gnu|' $MOZBUILD/mozilla/build/moz.configure/rust.configure
</code>

<p><br>
Record revisions that these builds are based on to add to application.ini in the packaged builds.
<br>
<code class="green"><span class="dastx">##</span> Mozilla:
Gecko_Rev=$(hg bookmarks -R $MOZBUILD/mozilla/ | grep \* |cut -d: -f2)
<span class="red"><span class="dastx">##</span> Localization:
[[ ! $L10N_CS ]] &amp;&amp; L10N_CS=$(hg parent -R $MOZBUILD/l10n/$L10N | grep changeset | cut -d: -f3)</span>
</code>

<p><br>
If not building Firefox, skip to <b><a href="#Building_SeamonkeyThunderbird">Building Seamonkey/Thunderbird</a></b>
<p>
<a name="BuildingFFReturn"></a>
<div style="background: #FFFADD;"><span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAADBElEQVR42qWTa0jTURiHs6sWSmnp
vCyZ2/9sS0vwkiuibFp20zStnBElzktKYSubWgyJCnVWaCS2LiRipXZDMyv8oq6yskRXXip1S2eR
TiXSLuj/11nESKpPHXg4nHNenvO+5zJltrvvf/HHhOLxIDep/mNRbN1An7zexMq1w2xsvcmwp+FD
vvxet8s/BaZs0RbZZa085MLjUVJQh4BSLaR3+7G+dgCSaiMCy3QobuoYLq84m/ntuaPVJEGf0nN+
VxKZUGUqJxKzFLh6Pgxb1IfgdqUNvFsG2JW9BbegEUlU2tNzH02VyTWTBNU7xGs7ZAS9qUIYjzLQ
F/AQkJ4Lt1O3MeNiK2w0LbDPeQjvjNsYGdTiU68aA032oRbBo1gm/108g3f7CIwqAv1xD7SnrsaZ
rBQ45DRggaoWnIPV4MSXQFN5AxjMRv+LaSctgrY4gVG/i8CQQtCnJHh/mo9j8eEgqWVwU1RhQVI5
bGXnYLM5DxV3LoI1FaK9Rmy0CHQywXj3DrpzAoEuWgjVuqVYvF2BOTEazJEVwTpUDes1WbCW7MX3
kRKwQ4dRfUHKfm92mvpT8CxCMPE6iqCHZvEkSIjSGAmcAlPgtukAQuTxcAhOg61PItz9ZPjSEYRx
gxCd1xaOWjKoDGZadBsJ3m4neCOjmSQSdCtE0KcT1MQJERoeAXtRNFTK5Rh76IrRxnloOc69YxGU
rCDKxpUEbWEEXTLKToJLwV6IEvrD3WMDHD3CwPeQ4lUxH0PXXdF5goeqreIjFkGGn5dDjZ/g49PA
X5JoWs5ugluRXkhe5g/1Bl/0ZhIM5ghgSGNQFSlim6OYVZNeosaT2fbAm7DmTMzlmM+kK8Z8LvR6
Exj07WWglzN4uVXA1ofw8/54yrTZJTs6594UCb42SAieB1HRJoL2cILOSILWcAY3VjDsfh7nPI11
+ZtgOmURf5Z1upLj3HyZzxurWiJgK334bLH3ws9qsevrSKe5hTRmGcXmn7/RvEjhUswD6UwrqzW0
l1D4FFuK1e/xPwCy1KrpkpT5rQAAAABJRU5ErkJggg=="><span style="vertical-align:20%"><b> Building Firefox [Nightly]</b></span></span>
<code class="gray">cd $MOZBUILD/mozilla/
[[ $REL == esr52 ]] &amp;&amp; patch -p1 &lt; $MOZBUILD/sources/8d9ae8c45dd0
export PATH=$MOZBUILD/sources/rust-$ARCH/bin:$PATH
export NO_MERCURIAL_SETUP_CHECK=1
export MOZCONFIG=$MOZBUILD/mozilla/mozconfig.firefox
<span class="red">[[ -e $MOZBUILD/l10n/merge-$L10N ]] &amp;&amp; export LOCALE_MERGEDIR=$MOZBUILD/l10n/merge-$L10N</span>
./mach build
</code>
A successful build will end with a message like:
<code class="console">95:38.04 We know it took a while, but your build finally finished successfully!
To view resource usage of the build, run |mach resource-usage|.
To take your build for a test drive, run: |mach run|
</code>
<b>Installation</b>
Install a dictionary:
<code class="red">(cd $MOZBUILD/$REL/firefox-build-dir/dist/bin
rm -rf dictionaries
unzip $MOZBUILD/sources/$L10N-dict.xpi dictionaries/*)
</code>
If eyedropper.properties is duplicated the installation will fail, in which case remove one of them:
<code class="red">[[ $MAJ_VER -lt 57 ]] &amp;&amp; \
(cd $MOZBUILD/$REL/firefox-build-dir/dist/bin/browser/chrome/$L10N/locale/$L10N/devtools/
[[ -e client/eyedropper.properties ]] &amp;&amp; \
[[ -e shared/eyedropper.properties ]] &amp;&amp; \
rm client/eyedropper.properties)
</code>
Let's take it for a test drive:
<code>./mach run
</code>                                                    <!-- mach package - start -->
<b>Installation:</b> <a name="close_machpk"></a>
Use either './mach install' or &nbsp;<span class="tabs prefs"><a href="#Mpack">'./mach package'</a></span>
<div id="Mpack" class="tab">
<div class="b_prefs"><span class="tabs"><a href="#close_machpk">close</a>
<!-- leave this space -->
<b>Using './mach package'</b>&nbsp;
<code class="gray">./mach package</code>
will create -
for esr52 builds:
<code class="console">$MOZBUILD/$REL/firefox-build-dir/dist/firefox-{version}.<span class="red">$L10N.</span>linux-$ARCH.tar.bz2
<span class="red">$MOZBUILD/$REL/firefox-build-dir/dist/linux-$ARCH/xpi/firefox-{version}.$L10N.langpack.xpi</span>
</code>
for 57+ builds:
<code class="console"></code>
<span class="tabs"><a href="#close_machpk">close</a></span>
</div></div>                                                     <!-- mach package - end -->
Install to --prefix, which has been set to $MOZBUILD/packaging-FF:
<code class="gray">./mach install
</code>
<b>Create package</b>
Includes setting up a relative link for /usr/bin/firefox &hellip;
<code class="gray">cd ../$REL/packaging-FF/lib
mkdir -p pkg/{opt,usr/bin}
[[ $REL == esr52 ]] &amp;&amp; FF_SUFF="-[0-9]*"
mv firefox${FF_SUFF:-} pkg/opt/firefox-$(cat $MOZBUILD/mozilla/browser/config/version.txt)
<span class="red"><span class="dastx">##</span> 'for the record', add the l10n revision that this build is based on:
sed -i "s|SourceStamp.*$|&amp;\nL10n_revision=$L10N_CS|" pkg/opt/firefox-*/application.ini</span>
(cd pkg/usr/bin
ln -s ../../opt/firefox-*/firefox .)
cd pkg
makepkg -l y -c n ../../../built/firefox-$(cat $MOZBUILD/mozilla/browser/config/version.txt)${LOCN:-}-${ARCH:-}.txz
</code>
</div>
<p>


<br>
<b><a name="Building_SeamonkeyThunderbird"></a>
Building Seamonkey/Thunderbird</b>
<p>
<a name="BuildingSMReturn"></a>
<div style="background: #E5F1FF;"><span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJ
bWFnZVJlYWR5ccllPAAAAuxJREFUOE9lUktME1EUPW9mWqbFtmPDLxFCiYghfiiCESKRmhgWuqAr
o2EhMWqEjWhYEF2IO6Ms0AWRlbpg4wbcaIzRBXFBNJrSYPxA+CqRXwv90Ol0Zp7vTamg3uTm3pe8
c8+5H4L/rK+8rMzZ5Xbb/fxlmtwpVDWzvrS0OaKq3U93/iY7H4ry4LbP5+pVFNkC6boJw6CW81zT
dKyuqqHl5WQ70DP+VwGHo+9aXV1JP89zIMMwLWDTqb243tMEQRJAUyrqDwzORqOqnxXZkLLwe81V
Vd5+Xd8G5QoUF+fjVu8JTCwBYz8ojqYWYbeLPlmWWDs4aRWoqHD322wi61O3QDnJPJ4+74eaAb6s
UHjsBpoafCgqciKR0ALA/VYBuFsjy6Kfg9NpgxUxsJ3rCAar8GYG+LwCpDQT31ZMtLRUsHkYEEXa
LpWWugJutwNra8kdfWdjR0ct0lTA7DoQT7PZUIJkxoTHkweXy4mCAk9Aqq8/rLQGj4PydVGAbjlf
X01DBgMf2Ap1Aq9MIbKR/9ygCASOoLikEZOT84oUDmusnziTAwjMTcbs9UpobHTgu2EHUwqFgSMJ
HaVugjKPiBfPNITDKuJxHdLc3EYoEkkwybA8Kx9o68zD6KqIDGurtshA3EPgYYXy1imGhmKw2cBm
FAlJhjEdSqUqmWSvBeTyHw7sxvCahF1s6k7BgMsuYH8BoLFVXroYhSwTq0Ay+Su0dUgvHxNyqJ1n
HDxWKONstW5d2XyM4Fghwae3aQw+SjJWCkkijHAZExOvfFuHNN4FuIM3bh5UJssd6Nyjw9wEFqcN
rH3N4MpICqkULFbOToiGhYVwL9A9ZymglJaPfEw+UfOcAWdEw9VzEfY5K5Oz8cjfEqPTtAhmZt73
xmIX7nCswMDD7+bpbLUvH5XqcrDtzOsRUUxaTNwdjmyUJA2x2PTs1NRoew7MjbACzSyuE0LG8cf6
yr3efUG7XVY4q8DuNRqdD8Xjl5/jH/sNIBmHpcHZfUMAAAAASUVORK5CYII="><span style="vertical-align:20%"><b> Building Seamonkey</b></span></span>
<code class="gray">cd $MOZBUILD/$REL/comm-$REL
export PATH=$MOZBUILD/sources/rust-$ARCH/bin:$PATH
export NO_MERCURIAL_SETUP_CHECK=1
export MOZCONFIG=$MOZBUILD/$REL/comm-$REL/mozconfig.seamonkey
<span class="red">[[ -e $MOZBUILD/l10n/merge-$L10N ]] &amp;&amp; export LOCALE_MERGEDIR=$MOZBUILD/l10n/merge-$L10N</span>
./mozilla/mach build
</code>
A successful build will end with a message like:
<code class="console">104:24.69 We know it took a while, but your build finally finished successfully!
To view resource usage of the build, run |mach resource-usage|.
To take your build for a test drive, run: |mach run|</code>
<b>Installation</b>
Install a dictionary:
<code class="red">(cd $MOZBUILD/$REL/seamonkey-build-dir/dist/bin
rm -rf dictionaries
unzip $MOZBUILD/sources/$L10N-dict.xpi dictionaries/*)
</code>

Add searchplugins of choice:
<code class="red">[[ $REL == esr52 ]] &amp;&amp; {
rm $MOZBUILD/$REL/seamonkey-build-dir/dist/bin/searchplugins/google*
cp $MOZBUILD/mozilla/browser/locales/searchplugins/{amazon,eBay,google}-$L10N.xml \
$MOZBUILD/$REL/seamonkey-build-dir/dist/bin/searchplugins/
}
</code>

Let's take it for a test drive:
<code>./mozilla/mach run
</code>
Install to --prefix, which has been set to $MOZBUILD/packaging-SM:
<code class="gray">./mozilla/mach install
</code>
<b>Create package</b>
Includes setting up a relative link for /usr/bin/seamonkey &hellip;
<code class="gray">cd ../packaging-SM/lib
mkdir -p pkg/{opt,usr/bin}
[[ $REL == esr52 ]] &amp;&amp; FF_SUFF="-[0-9]*"
mv seamonkey${FF_SUFF:-} pkg/opt/seamonkey-$(cat $MOZBUILD/$REL/comm-$REL/suite/config/version.txt)
<span class="green"><span class="dastx">##</span> 'for the record', add the mozilla and l10n revisions that this build is based on:</span>
<span class="red">sed -i "s|SourceStamp.*$|&amp;\nL10n_revision=$L10N_CS|" pkg/opt/seamonkey-*/application.ini</span>
<span class="green">sed -i "s|SourceStamp.*$|&amp;\nGecko_revision=$Gecko_Rev|" pkg/opt/seamonkey-*/application.ini</span>
(cd pkg/usr/bin
ln -s ../../opt/seamonkey-*/seamonkey .)
cd pkg
makepkg -l y -c n ../../../built/seamonkey-$(cat $MOZBUILD/$REL/comm-$REL/suite/config/version.txt)${LOCN:-}-${ARCH:-}.txz
</code>
</div>

<p>
<a name="BuildingTBReturn"></a>
<div style="background:#F4f4f4"><span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A
/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sIDw0JOVohvckAAATpSURBVDjL
rZV7aFNnGMaf7+QkOUmTaG+x96qb1ehab+i8TKtT62VCq2ODsQvCZMLYGIx1F8YYQ53MiezixA1F
1DGdwlTQOaUVhU5rtWrtnNraJrXJ0ubWnJxzcnKu3/5wc7roHGwPfPDxfrw/Xh5eng94iJKUWjfv
P189unadFQAWbjiC/6TGredAKeVe39zUtG7PBXomKJzFs58NA4DhT299aL/lQQ9njm6HUlm/Y+TY
ESuKfGX0VHt3mRJT3lNGLS7xCOJJ/uYJreqJ9YjfOnnffubvhciFYwCAhrWd08dOrngJHgcVpQTh
YwIxTQpDN16hIF3j5nxc09XyPkbWffTvwIqiWGnH91NnPJ7bDIeOXI9JwkEe125EMJjRYYBAtttK
RY7tKFm2zhs48eGd3uCZQ3fu5G5ouPVIma7rPTrL2Y7bquFymbTtbB85vrMFYkEhmJGFcJkGOM5O
OYYh4VhKDsTM8b81uhdSQ2sundXgv2fiq8f2IhrqhsQn1vLRkE0QJSh6hgb7U+TgnnaseuQK1k+6
hP5bcZS5rJg7sYx4cz10SlU5Vz8+p0sY6P3GBGnMsmLC0ucQ7GhbnkwmVsXDIZqJh3Hz6gD5pTOM
mjwLbkSiaMmZDxfP4/T+g+i6EkK+x0VsrIWonnLrtjYWeizwwq8/7q7J8lilpFG3OyFGwuS7cxGU
ui2YPSYX8UIn9o9ag8MtERToKkZ5q9C6byuSogGbhYEHaXTnzyU93X3utMW2KwtsAFOGV/owGBnA
mBmLMOfRfPiKOMwl7ZicDCMnJcGq6rAYaXisTnBWCl01YOcYlOdb0Wt/DKCYlAVmKFyqxNM5L7+F
Nct98FUUojfgx4SZK/Dq0okY7rCDNVVYTB42jkFJmQfeAhdCoRTKTR7TplRQg/y1ZOwdMMsiIwlk
/Ixl2HukAwdOXcPJqyGIkoyV0ypR7eXRGhyEKvjB+mZjUTGDBXWliNba4bKI6AsoJKPp2WDO6bou
SUPjhHgQn/5wCRoxUN9Qh8FEAm6ksW3DM2g9246yEi8GdCd8xQ6oqowcGxCLilBVFQxhYllgXVU2
Waz27YP9XVg5z4fRE3xYMs6BuKjDH1WgUQa1tdNhmjoqDQOmJkPNZJCWBGTSEjRNg93p/CTLY4fD
dchuc6jJWJTOn16FF6e5sfNcDCFehagasBIKLSNAzUjQZBGKLEGRRYh8EmlJpBaGVQ1V35MF9s1e
FC8oKtpBKYiDpOmsjVfQPyjielCCIhtQdR1SMnYbLqcgC0nw8SiEFE+1jErcebm7py5eOXjfrJg3
88k3C7zFnaXDWDLUm6B5hGDZxHz4vDlQNR2BXj+UtIxkPIp4dAB8Mkk1TSN53uLIpg8+fftu1j1Z
se/rTe4bgVDF6tfevQiGtUlDfQj19aHf3w2Gmqjy+eAdUQRJFJAailMLIcTtyfOvfuOdeT+3tYet
LKtpup4NTsWC32aExPOdHZcjhJpejnPAM8wDG+eE1WqFYRgwTROGpoDnU0O8kG5vamr+KhhLnt57
4PDQAyfu83fVlJaUdEiigK7O81+u3/jFIVmUJzc8Vbc8Nz8/j8JkEpFY/ODREz+BGO1btny+a0RR
UfHFy53OBUvq5fsGc6j/duKdOt1ccFeZBcAByAGQ98dxAXD8uaqSJFRTSv/5n+rpuY7/S78DHAti
UD80RecAAAAASUVORK5CYII="><span style="vertical-align:40%"><b> Building Thunderbird [Daily]</b></span></span>
<code class="gray">cd $MOZBUILD/$REL/comm-$REL
export PATH=$MOZBUILD/sources/rust-$ARCH/bin:$PATH
export NO_MERCURIAL_SETUP_CHECK=1
export MOZCONFIG=$MOZBUILD/$REL/comm-$REL/mozconfig.thunderbird
<span class="red">[[ -e $MOZBUILD/l10n/merge-$L10N ]] &amp;&amp; export LOCALE_MERGEDIR=$MOZBUILD/l10n/merge-$L10N</span>
./mozilla/mach build
</code>
A successful build will end with a message like:
<code class="console">102:29.70 We know it took a while, but your build finally finished successfully!
To view resource usage of the build, run |mach resource-usage|.
To take your build for a test drive, run: |mach run|</code>
<b>Installation</b>
Install a dictionary:
<code class="red">(cd $MOZBUILD/$REL/thunderbird-build-dir/dist/bin
rm -rf dictionaries
unzip $MOZBUILD/sources/$L10N-dict.xpi dictionaries/*)
</code>
If eyedropper.properties is duplicated the installation will fail, in which case remove one of them:
<code class="red">(cd $MOZBUILD/$REL/thunderbird-build-dir/dist/bin/chrome/$L10N/locale/$L10N/devtools/
[[ -e client/eyedropper.properties ]] &amp;&amp; \
[[ -e shared/eyedropper.properties ]] &amp;&amp; \
rm client/eyedropper.properties)
</code>
Let's take it for a test drive:
<code>./mozilla/mach run
</code>
Install to --prefix, which has been set to $MOZBUILD/packaging-TB:
<code class="gray">./mozilla/mach install
</code>
<b>Create package</b>
Includes setting up a relative link for /usr/bin/thunderbird &hellip;
<code class="gray">cd ../packaging-TB/lib
mkdir -p pkg/{opt,usr/bin}
[[ $REL == esr52 ]] &amp;&amp; FF_SUFF="-[0-9]*"
mv thunderbird${FF_SUFF:-} pkg/opt/thunderbird-$(cat $MOZBUILD/$REL/comm-$REL/mail/config/version.txt)
<span class="green"><span class="dastx">##</span> 'for the record', add the mozilla and l10n revisions that this build is based on:</span>
<span class="red">sed -i "s|SourceStamp.*$|&amp;\nL10n_revision=$L10N_CS|" pkg/opt/thunderbird-*/application.ini</span>
<span class="green">sed -i "s|SourceStamp.*$|&amp;\nGecko_revision=$Gecko_Rev|" pkg/opt/thunderbird-*/application.ini</span>
(cd pkg/usr/bin
ln -s ../../opt/thunderbird-*/thunderbird .)
cd pkg
makepkg -l y -c n ../../../built/thunderbird-$(cat $MOZBUILD/$REL/comm-$REL/mail/config/version.txt)${LOCN:-}-${ARCH:-}.txz
</code>
</div>


<p>
If in a chroot, exit and unmount additional 32-bit build bindings:
<br>
<code class="thtwo">[[ $CHRT_TEST ]] &amp;&amp; unset CHRT_TEST &amp;&amp; exit

[[ $CHRT != "" ]] &amp;&amp; \
(umount $CHRT$MOZBUILD/$REL/comm-$REL/mozilla
umount $CHRT$MOZBUILD/l10n
umount $CHRT$MOZBUILD/$REL/comm-$REL
umount $CHRT$MOZBUILD/sources
umount $CHRT$MOZBUILD/mozilla
umount $CHRT/proc
umount $CHRT/dev)

<span class="dastx">##</span> Reset everything for a 64-bit build
[[ $CHRT != "" ]] &amp;&amp; unset CHRT &amp;&amp; export ARCH=x86_64 &amp;&amp; \
sed -i '/For 32 bit version/,+3 d' $MOZBUILD/mozilla/mozconfig.common
</code>

<P>
Reset FF57+ localization work-arounds:<br>
<code class="red"><span class="dastx">##</span> RESET searchplugins
rm $MOZBUILD/$REL/comm-release/suite/locales/en-US/searchplugins/*
cp -a $MOZBUILD/l10n/wip/list.json $MOZBUILD/mozilla/browser/locales/search/

<span class="dastx">##</span> RESET all en-US files
<b>TEST_CP=no</b>
(cd $MOZBUILD/l10n/wip
while read file
do
[[ $TEST_CP == no ]] &amp;&amp; cp -a .$file $file \
|| echo -e "would copy en-US backup \n.$file \nto original location \n$file \n"
done &lt; $MOZBUILD/l10n/en-US-l10n-files)

<span class="dastx">##</span> and remove temporary content
rm -rf $MOZBUILD/l10n/wip/*
</code>

<p>
Unmount the mozilla repository binding:
<br>
<code class="gray">umount $MOZBUILD/$REL/comm-$REL/mozilla
rm -rf $MOZBUILD/$REL/comm-$REL/mozilla
</code>

</body></html>
