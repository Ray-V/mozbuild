<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta name="google-site-verification" content="xO3y2fv-X8oZAKtnao0t7127tULo8Xu6MaMV10EdwFI" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Building Firefox, SeaMonkey and Thunderbird from mercurial repositories</title>

<!-- page -->
<style>
body {font:14px sans;max-width: 1000px;padding:0px 10px;margin: 0 auto; /* center page */} 
.red {background-color: #FFdddd;}
.gray {background-color: #e7e7e7;}
.green {background-color: #E7F5E7;}
.thtwo {background-color: #Fafafa;border: dotted 1px;}
.thtwob {border: dotted 1px;}
.central {border: dashed 1px;display: inline-block;padding: 2px;}
.appx {background-color: #Fafafa;}
.console {border-left: 3px solid lightgrey;margin-left: 15px;}
.dhash {color: #978DFF;}
.comment {color: #acacac;}
.off_rel  {color: magenta;}
div {padding: 5px;white-space: pre-wrap;}
code {font-size:12px;padding: 5px;display: inline-block;white-space: pre-wrap;margin: 5px 0;}
pre {font-size:12px;}
div code {margin: 10px 0;}
a, a:visited {text-decoration: none;font-style: oblique;color: #0000c5;}
a.extlink, a:visited.extlink {color: #c50000;}
a.intlink, a:visited.intlink {color: #00c500;}
hr {width: 100%;height: 2px;}
</style>

<!-- pop-up buttons -->
<style type="text/css">
.b_locn {border-left: 10px solid #FFdddd;padding-left: 10px;}
.b_prefs {border-left: 10px solid #E7F5E7;padding-left: 10px;}
.b_32bit {border-left: 10px solid #Fafafa;padding-left: 10px;}

/* basic for close tab */
span.tabs a {box-shadow:1px 1px 3px gray; /* shift-horz|-vert|width|colour */
border-radius:6px;padding: 2px 4px;color:#0000c5;}
span.tabs.locn a {background-color:#FFdddd;}
span.tabs.prefs a {background-color:#E7F5E7;}
span.tabs.th2 a {background-color:#Fafafa;}

div.tab {display: none;}
div.tab:target {display: block;}
:target div.tab {display: block;}
:target div.tab + div.tab {display: none;}
</style>

<!-- nav box  -->
<style type="text/css">
/*http://www.websitecodetutorials.com/code/css-nav-menus/css3-mega-drop-down-menu.php*/
#menu {
list-style:none;
font-weight:bold;
 font-size: .85em;
}

#menu li {
position:fixed;
top:20;right:10;
background:none;
padding:5px 9px 0px 9px;
border:1px solid #e3e3e3;
border-radius:6px;
text-align:center;
z-index:1;
}

#menu a {display:block;}

/* ----------- Hide/Show Div ---------- */
#menu div {
position:fixed;
top:20;right:10;bottom:10;
max-height: 360px;
 overflow-y: auto;
 white-space: nowrap;
z-index:4;
border:1px solid #000;
font-weight:normal;
text-align:left; 
box-shadow:0 2px 8px #000;
border-radius:6px;
    -moz-transition: all .2s ease-in-out;
 -webkit-transition: all .2s ease-in-out;
      -o-transition: all .2s ease-in-out;
     -ms-transition: all .2s ease-in-out;
         transition: all .2s ease-in-out;
visibility:hidden;
opacity:0;
}

/* ---- CSS3 Transform Fade In/Out ----- */
#menu li:hover div {
visibility:visible;
background:#fff;
opacity:1;
}

#menu div p {padding-right:20px;}

#menu div p a {
color:darkblue;
text-decoration:none;
clear:left;
line-height:1.1;
}

#menu div a:hover, #menu div a:focus, #menu div a:active {
text-decoration:none;
color:darkred;
}

/* print styling - no nav box */
@media print {#menu { display: none;} body, p, a {color:#000; background:#fff;}}
</style>


</head><body>
<br>
<h3> Building Firefox, SeaMonkey and Thunderbird from mercurial repositories</h3>
Build <b>esr60/68</b>, <b>release</b>, <b>beta</b>, or <b>central</b> from the <b>mozilla-unified</b> repository.
<p>This page has been laid out around a mainly distro-independent build script, defaulting to an <span class="gray">en-US</span> build on unmodified source.
<br>
Packaging is Slackware specific, but installation for that is to DESTDIR, so I guess would be adaptable to other packaging systems.
<br>
Packaging from the 'mach' built packages is generic.
<p>
Build <span style="background:#FFFADD;">Firefox</span> with gtk3, using mach, and rust; and package it to install to /opt/firefox-{version} ...<br>
and/or <span style="background:#E5F1FF;">SeaMonkey</span> and/or <span style="background:#F8F8F8">Thunderbird</span> based on that mozilla source.
<br>
<p>Builds default to x86_64 with additional setting up for cross compiling <a href="#FF_xcompile"><span class="green">Firefox</span> </a> - <a href="#SM_xcompile"><span class="green">Seamonkey</span></a> - <a href="#TB_xcompile"><span class="green">Thunderbird</span></a> for armv7 or aarch64 [optimized for Raspberry Pi3], or i686.
<p>Customization options with <a href="#Prefs"><span class="green">user preferences</span></a> and <a href="#l10n"><span class="red">single localization</span></a>.
<br>
<hr>
<b>References</b><br>
<a class="extlink" href="http://www.linuxfromscratch.org/blfs/view/svn/xsoft/firefox.html">LFS</a> for mozconfig setup and the inspiration to do this
<br>
<a class="extlink" href="https://developer.mozilla.org/en-US/docs/Mozilla/Developer_guide/Build_Instructions/Simple_Firefox_build">Simple Firefox build</a><br>
<a class="extlink" href="https://developer.mozilla.org/en-US/docs/Simple_Firefox_build/Linux_and_MacOS_build_preparation">Linux Build Prerequisites</a>
<br>
&hellip; and other Mozilla Developer pages &hellip;

<p><a name="Latest"></a><br>
<b>Latest builds</b>
<br>
These are builds which have been completed and run, not always current for each repository.
<br>
l10n files are updated from the l10n-central base revisions during <a href="#l10n"><span class="red">Localization</span></a> using compare-locales 
<br><code class="appx">                                                   built to <span class="off_rel">{released}</span> revision/changeset
        <u>Firefox</u>   <u>SeaMonkey</u>   <u>Thunderbird</u>       <u>mozilla</u>         <u>comm-$REL</u>       <u>l10n-central</u>   <u>Options</u>
</code>
<br><br>
<b><i>esr68</i></b>
<br>
<code class="appx">        68.3.0                                  <span class="off_rel">fd17b62d5247</span>    <span class="comment">n/a</span>             a1cd22844353   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
<span class="comment green">armv7</span>&diamondsuit;  68.3.0                                  <span class="">fd17b62d5247</span>    <span class="comment">n/a</span>             a1cd22844353   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
<span class="comment green">aarch64</span> 68.3.0                                  <span class="">fd17b62d5247</span>    <span class="comment">n/a</span>             a1cd22844353   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
<span class="comment green">i686</span>    68.3.0                                  <span class="off_rel">fd17b62d5247</span>    <span class="comment">n/a</span>             a1cd22844353   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
                              68.3.0            <span class="off_rel">78ab5e054eb0</span>    <span class="off_rel">228eab07a730</span>    a1cd22844353   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
<span class="comment green">armv7</span>&diamondsuit;                        68.3.0            78ab5e054eb0    228eab07a730    a1cd22844353   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
<span class="comment green">aarch64</span>                       68.3.0            78ab5e054eb0    228eab07a730    a1cd22844353   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
<span class="comment green">i686</span>                          68.3.0            <span class="off_rel">78ab5e054eb0</span>    <span class="off_rel">228eab07a730</span>    a1cd22844353   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
</code>
<br>
&diamondsuit; <span class="comment">FF66+ for armv7 requires <a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1526653">patching</a> for error: <i>field ‘ufp’ has incomplete type ‘user_vfp’</i></span>
<p>
<b><i>release</i></b>
<br>
<code class="appx">        71.0                                    <span class="off_rel">501aef7fe1d9</span>    <span class="comment">n/a</span>             a163b7571caf   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
<span class="comment green">armv7</span>&diamondsuit;  71.0                                    <span class="">501aef7fe1d9</span>    <span class="comment">n/a</span>             a163b7571caf   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
<span class="comment green">aarch64</span> 71.0                                    <span class="">501aef7fe1d9</span>    <span class="comment">n/a</span>             a163b7571caf   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
<span class="comment green">i686</span>    71.0                                    <span class="off_rel">501aef7fe1d9</span>    <span class="comment">n/a</span>             a163b7571caf   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
                  <span class="comment">2.61                          8337ebb86a42    f2b7084210a3    <span class="">not used&nbsp;&nbsp;&nbsp;&nbsp;</span>   <span class="gray"> </span> <span class=""> </span> <span class=""> </span> <span class=""> </span></span>
                              67.0b3            2a7896ba9aa5    <span class="off_rel">ac7b1df1919b</span>    a6ac37b9e82b   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
</code>
<br>
<span class="comment">SM2.61 builds but continues to be <a class="extlink" href="https://wiki.mozilla.org/SeaMonkey/StatusMeetings/2019-04-28#Status_of_the_SeaMonkey_Source_Tree">unusable</a>.</span>
<br><br>
<b><i>beta</i></b>
<br>
<code class="appx">        68.0b5                                  c246934cd0fa    <span class="comment">n/a</span>             c00e6692735c   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
<span class="comment green">armv7</span>&diamondsuit;  68.0b5                                  c246934cd0fa    <span class="comment">n/a</span>             c00e6692735c   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
<span class="comment green">aarch64</span> 68.0b5                                  c246934cd0fa    <span class="comment">n/a</span>             c00e6692735c   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
                  <span class="comment">2.64                          d1a98fb42cb8    5d37c065e0f2</span>    <span class="comment">not used&nbsp;&nbsp;&nbsp;&nbsp;</span>   <span class="gray"> </span><span class=""> </span> <span class=""> </span> <span class=""> </span>
                              68.0b1            c246934cd0fa    7eeeb32bfd07    c00e6692735c   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
</code>
<br>
<span class="comment">SM2.64 builds but continues to be <a class="extlink" href="https://wiki.mozilla.org/SeaMonkey/StatusMeetings/2019-04-28#Status_of_the_SeaMonkey_Source_Tree">unusable</a>.</span>
<br><br>
<b><i>central [Nightly]</i></b>
<br>
<code class="appx">        69.0a1                                  afb588ff0931    <span class="comment">n/a</span>             c00e6692735c   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
</code>
<br>
<span class="comment">Builds from mozilla changeset f080a35baf6a [61.0] require gcc 6.1+.</span>
<br><br>
<b><i>esr60</i></b> <span class="comment"> [SM/TB versions as per '<a href="#Prefs">User preferences</a>[4]'</span>
<br>
This has been retained for SeaMonkey 2.57 builds
<br>
<code class="appx">        60.7.0                                  <span class="off_rel">64ee63facd4f</span>    <span class="comment">n/a</span>             <span class="">24a583bfc5c7</span>   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
<span class="comment green">armv7</span>   60.7.0                                  <span class="">64ee63facd4f</span>    <span class="comment">n/a</span>             24a583bfc5c7   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
                  2.57.9.1 <b>&#x02021;</b>                    1aeaa33a64f9    b05f05a590f4    <span class="">24a583bfc5c7</span>   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
<span class="comment green">armv7</span>             2.57.7.0                      64ee63facd4f    5822a83963e3    24a583bfc5c7   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
                              60.7.0            64ee63facd4f    33572eeede63    <span class="">24a583bfc5c7</span>   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
<span class="comment green">armv7</span>                         60.7.0            64ee63facd4f    5822a83963e3    24a583bfc5c7   <span class="gray"> </span> <span class="green"> </span> <span class="red"> </span> <span class=""> </span>
</code>
<br>
<span class="comment"><b>&#x02021;</b> - the mozilla and comm revisions are the changesets at tip at the time of compiling</span>
</code>
<p>

<br>
<b>Build times</b>
<br><code>Machine			dual-core 2.2 GHz	2x quad-core 3GHz
MOZ_MAKE_FLAGS		-j2			-j12
Firefox 		~298 mins [FF70]	~62 mins [FF70]
SeaMonkey/Thunderbird	~289 mins [TB68]	~41 mins [SM2.57esr/TB60esr]</code>
<br>
Higher values for '-j' on the dual-core machine cause random build errors, unless built with adequate memory or swap.
<br>
Typical usage is 6GB actual, 3GB swap for -j2.

<p><a name="DirStructure"></a><br>
    <b>Directory structure</b><br>
    The build is done within this directory structure [key directories only]:<br>
    <code>$MOZBUILD
├── mozilla					# unpacked mozilla-unified bundle
├── sources
│   ├── autoconf_213				# autoconf-2.13 installation
│   ├── llvm-$ARCH				# for LLVM_CONFIG for stylo build
│   ├── mozilla-unified.zstd.hg			# mercurial bundle
│   ├── rust&hellip;					# download and installation
│   <span class="red">└── compare-locales				# to create merge-$L10N</span>
├<span class="red">── l10n</span>
│   <span class="red">├── $L10N					# mercurial clone</span>
│   <span class="red">├── merge-$L10N 				# updated $L10N files</span>
│   <span class="red">└── wip 					# temporary workspace for FF57+ builds</span>
└───$REL							# build tree for each of esr, release, beta, central
    ├── comm-$REL						# mercurial clone
    │   └── mozilla						# bind to $MOZBUILD/mozilla
    │       <span class="thtwo">└── comm						# work-around for TB 64+ &amp; SM 2.57+</span>
    ├── {firefox,seamonkey,thunderbird}-build-dir-$PKG_ARCH	# build directories
    ├── packaging-{FF,SM,TB}-$PKG_ARCH
    │   └── usr
    │       └── lib						# install here to create package
    └── built
        ├── firefox-{version}$LOCZN-$PKG_ARCH.txz		# the Firefox Slackware package
        ├── seamonkey-{version}$LOCZN-$PKG_ARCH.txz		# the SeaMonkey Slackware package
        └── thunderbird-{version}$LOCZN-$PKG_ARCH.txz		# the Thunderbird Slackware package
</code>
<p>

<a name="Set_variables"></a><br>
<b>Set variables</b>
<br>
<code class="gray">export MOZBUILD=<b>/mozbuild</b>
<span class="dhash">##</span> Set which repositories to clone:
export REPOS="<b>release</b> <b>beta</b> <b>esr60</b> <b>esr68</b> <b>central</b>"
<span class="dhash">##</span> choose which to build:
export REL=<span class="comment"><b>esr68</b></span>
<span class="dhash">##</span> set number of parallel jobs
export NUMJOBS=-j$[$(getconf _NPROCESSORS_ONLN)*2]
export ARCH=x86_64
export PKG_ARCH=$ARCH
export LOCZN=-$(echo en-US | tr - _)
<span class="red">export L10N=<span class="comment"><b>en-GB</b></span> &amp;&amp; export LOCZN=-$(echo $L10N | tr - _)</span>
</code>

<p>
<b>Create build directories</b><br>
<code class="gray"><span class="red">mkdir -p $MOZBUILD/l10n/wip</span>
mkdir -p $MOZBUILD/sources

<span class="dhash">##</span> Set which directories to create:
REPOS=$REPOS
(for repo in $REPOS
do
mkdir -p $MOZBUILD/$repo/built
done)
</code>

<p><a name="Mercurial_bundles"></a>
<b>Mercurial bundles and repositories</b><br>
mozilla-unified is downloaded as a compressed bundle [~1<font size="-1">x</font>10<sup>9</sup> B] and is unbundled to a sub-directory of $MOZBUILD.<br>
The key advantage of using a bundle rather than cloning the repo is that an interrupted download can be resumed. <br>
It also puts less of a load on the server - see <a class="extlink" href="http://gregoryszorc.com/blog/2015/05/29/faster-cloning-from-hg.mozilla.org-with-server-provided-bundles/">here</a> and <a class="extlink" href="http://gregoryszorc.com/blog/2015/10/22/cloning-improvements-in-mercurial-3.6/">here</a>.


<p>mozilla-unified<br>
Requires mercurial with zstd support [v4.1.2 works], otherwise view 'bundles' file and choose compression type<br>
<code class="gray">cd $MOZBUILD/sources
<span class="dhash">##</span> get mozilla-unified bundle
<span style="color: #c50000;">wget -O bundles https://hg.cdn.mozilla.net/</span>
BUNDLE=$(grep mozilla-unified.*zstd bundles | sed 's|.*href="||;s|">.*$||')
<span style="color: #c50000;">wget -O mozilla-unified.bundle https://hg.cdn.mozilla.net/$BUNDLE</span>

cd $MOZBUILD
<span class="dhash">##</span> unbundle mozilla-unified
hg init mozilla
hg unbundle sources/mozilla-unified.bundle -R mozilla
<span class="dhash">##</span> set default repo to pull from
echo "[paths]
default = https://hg.mozilla.org/mozilla-unified/" > mozilla/.hg/hgrc
<span class="dhash">##</span> get new changesets since bundle was created
hg pull -R mozilla
<span class="dhash">##</span> update local repo
hg update -R mozilla
</code>

<p>
<b>TB68</b>esr needs additional setting up &hellip;
<br>
The TB68esr release[-candidates] might be built from the THUNDERBIRD_68_VERBRANCH branch of the https://hg.mozilla.org/releases/mozilla-esr68 repository, and use changesets not in mozilla-unified.
<br>
So pull these into the local mozilla-unified clone, ready for checkout if required.
<br>
This is a minimal update - when I did it, the result was:
<br>
<code class="console"> added 62 changesets with 35 changes to 74 files</code>
<br>
<code class="gray">(cd $MOZBUILD/mozilla
hg pull -b THUNDERBIRD_68_VERBRANCH https://hg.mozilla.org/releases/mozilla-esr68}
</code>

<p>
comm-$REL and locale have to be cloned as no bundle is available.
<br>
There is a comm-central bundle, but to keep things consistent, let's clone that too &hellip;
<br>
<code class="gray"><span class="dhash">##</span> Set which repositories to clone:
REPOS=$REPOS

(for repo in $REPOS
do
cd $MOZBUILD/$repo
RELEASES="/releases" &amp;&amp; [[ $repo == central ]] &amp;&amp; unset RELEASES
hg clone https://hg.mozilla.org${RELEASES:-""}/comm-$repo/
done)
</code>

<p>
non-US locale<br>
Use l10n mozilla-central repository and revert to the official revisions when required as per l10n-changesets.json.
<br>
<code class="red">(cd $MOZBUILD/l10n/
hg clone https://hg.mozilla.org/l10n-central/$L10N/)
</code>

<br>
If the localization has not been updated for new files or strings from the en-US locale, then the build will fail or run-time failures will occur on those omissions.
<br>
A check should therefore be made to ensure that there are no missing files or strings in the localization, which is done with <i>compare-locales</i> - see '<a href="#l10n">Localization</a>'.
<p>
<a name="UpdateRepoReturn"></a>

Once these locally cloned repositories have been set up, they can be kept up-to-date for future builds - see '<a href="#Locrep">Add new changesets</a>'.
<p>

<b><span class="red">Dictionaries</span></b>
<br>
To avoid this build failure on installation:
<br>
<code class="console">Error: ...browser/installer/package-manifest.in:50: Missing file(s): bin/dictionaries/*</code>
<br>
comment out line 50 in package-manifest.in &hellip;
<br>
<b style="color: darkblue;">OR</b> download and install a dictionary [recommended]:
<br>
Links to dictionaries are available at <a class="extlink" href="https://addons.mozilla.org/language-tools/">Mozilla addons</a>
<br>
<code class="red">cd $MOZBUILD/sources
<span style="color: #c50000;">wget -O $L10N-dict.xpi https://addons.mozilla.org/firefox/downloads/latest/<span class="comment">british-english-dictionary-2/addon-461570-latest.xpi</span></span>
</code>

<p>
<b>Autoconf</b>
<br>Building needs autoconf-2.13 for the '--localdir=' option which the later versions don't have.
<br>Build and install to temporary directory for use with this build only.
<br>
<code class="gray">cd $MOZBUILD/sources
<span style="color: #c50000;">wget https://ftpmirror.gnu.org/autoconf/autoconf-2.13.tar.gz</span>

tar xf autoconf-2.13.tar.gz
cd autoconf-2.13
./configure --prefix=$MOZBUILD/sources/autoconf_213
make
make install
</code>
<br>
autoconf is now installed at $MOZBUILD/sources/autoconf_213/bin/autoconf and this path is included in mozconfig.common.

<p>
<b>Rust</b>
<br>
Download and install the x86_64 version of rust which includes the rustc and cargo binaries, and the x86_64 crate.
<br>
armv7[hf], aarch64, and i686 crates for cross compiling will be downloaded and added to this installation as required.
<code class="gray">cd $MOZBUILD/sources/
<span style="color: #c50000;">wget -O rust.html https://forge.rust-lang.org/other-installation-methods.html</span>
URL=$(grep "rust-[1-9].*$ARCH-unknown-linux-gnu.tar.gz\">" rust.html | sed 's|.*href="||;s|">.*$||;s|tar.gz|tar.xz|')
<span style="color: #c50000;">wget $URL</span>

tar xf rust*$ARCH-unknown-linux-gnu.tar.xz
cd rust*$ARCH-unknown-linux-gnu
./install.sh --prefix=$MOZBUILD/sources/rust-$ARCH --components=rustc,cargo,rust-std-$ARCH-unknown-linux-gnu
</code>
<br>Building with rust enabled requires rustc to be in the PATH which is set as a shell variable:<br>
<code class="gray">export PATH=$MOZBUILD/sources/rust-$ARCH/bin:$PATH
</code>

<p>
<!--
Add new changesets - start
-->
<a name="close_chset"></a>
<br>
<span class="tabs"><a href="#Locrep">Add new changesets</a></span><span style="vertical-align:-30%">&nbsp;&nbsp;to all cloned repositories prior to any <a class="extlink" href="https://wiki.mozilla.org/RapidRelease/Calendar">future release builds</a> [or as required].</span>
<div id="Locrep" class="tab"><div class="b_32bit"><span class="tabs"><a href="#close_chset">close</a></span>
<code class="appx"><span class="dhash">##</span> Set which repositories to update:
REPOS=$REPOS

cd $MOZBUILD
hg pull -R mozilla
hg pull -b THUNDERBIRD_68_VERBRANCH https://hg.mozilla.org/releases/mozilla-esr68 -R mozilla
<span class="red">hg pull -R l10n/$L10N</span>

for repo in $REPOS
do
hg pull -R $repo/comm-$repo
done

<span class="dhash">##</span> De-clutter the mozilla[-unified] bookmarks list
sed -i '/ au/d;/esr[1-5]/d;/fx-team/d;/inbound/d' $MOZBUILD/mozilla/.hg/bookmarks
</code>
<span class="tabs"><a href="#close_chset">close</a></span>
</div>
<br></div>
<!--
Add new changesets - end
-->

Set up the local repositories for chosen $REL, removing any changes made for previous builds:<br>
<code class="gray">cd $MOZBUILD
hg update $REL -C -R mozilla
hg update default -C -R $REL/comm-$REL/
<span class="red">hg update default -C -R l10n/$L10N</span>
</code>
<p>
<!--
Building to a changeset - start
-->
<a name="close_known_rel"></a>
<br>
<span class="tabs prefs"><a href="#known_rel">Building to a specific revision</a></span>
<div id="known_rel" class="tab"><div class="b_prefs"><span class="tabs"><a href="#close_known_rel">close</a></span>
<!-- leave this space -->
<b>Building to the same revision as an <a class="extlink" href="https://wiki.mozilla.org/RapidRelease/Calendar">official</a></b> or <a class="extlink" href="https://www.mozilla.org/en-US/firefox/releases/">bug fix</a> release.
This is relevant for release versions only, beta builds have been specifically excluded.

<b><i>Either</b></i>: Prior to the release date, the changesets on which the release candidates are built can be obtained from mozilla.org.
The final release candidate can be as late as the weekend before the scheduled release date.
This finds the latest release candidate build for any specific Firefox version, and sets up a new bookmark to that revision &hellip;
<code class="green"><span class="dhash">##</span> <b>Firefox</b>:
<span class="dhash">##</span> FF_VER defaults to the current repo Firefox version and will only give a resultant release candidate changeset [REL_CAND_CS] when the release candidate loses its beta suffix which should be 7-12 days before the release date
<b>FF_VER</b>=$(cat $MOZBUILD/mozilla/browser/config/version.txt)
<span class="appx">echo $FF_VER</span>
<span class="dhash">##</span> Override with <b>FF_VER</b>=xx.x[.x] for an earlier version
ESR_SUFF="" &amp;&amp; [[ $REL == esr?? ]] &amp;&amp; ESR_SUFF=esr

cd $MOZBUILD/sources/
<span class="dhash">##</span> [1] Get list of release candidates and find the latest for this release/esr version
<span style="color: #c50000;">wget -O candidates.html https://archive.mozilla.org/pub/firefox/candidates/</span>
REL_CAND=$(grep $FF_VER candidates.html|grep -v b[0-9] | grep -o $FF_VER${ESR_SUFF:-}-candidates | head -n1)
<span class="appx">echo $REL_CAND</span>

<span class="dhash">##</span> [2] Get list of release candidate builds and find the latest
<span style="color: #c50000;">wget -O $REL_CAND.html https://archive.mozilla.org/pub/firefox/candidates/$REL_CAND/</span>
BUILD=$(grep build $REL_CAND.html|tail -n1|cut -d"/" -f6)
<span class="appx">echo $BUILD</span>

<span class="dhash">##</span> [3] Download the .json file which includes the changeset reference for that build and find the changeset
JSON="firefox-$(echo $REL_CAND |cut -d- -f1).json"
<span style="color: #c50000;">wget -O $JSON https://archive.mozilla.org/pub/firefox/candidates/$REL_CAND/$BUILD/linux-$ARCH/en-US/$JSON</span>
REL_CAND_CS=$(grep stamp $JSON |colrm 1 23|colrm 13)
<span class="appx">echo $REL_CAND_CS</span>

<span class="dhash">##</span> Create new bookmark to that release candidate changeset
hg bookmark -r $REL_CAND_CS ${REL}_$FF_VER -R $MOZBUILD/mozilla
<span class="dhash">##</span> Set the new bookmark active
hg checkout ${REL}_$FF_VER -R $MOZBUILD/mozilla
</code>
<b><i>Or</b></i>: Where the FF version is known, i.e. after its release date, the changeset on which it was built can be determined from the repo log and then the repo reverted to that changeset.
The changeset for any specific release is only tagged as FIREFOX_xx_x[_x]_RELEASE on the official release date.
<code class="green"><span class="dhash">##</span> <b>Firefox</b>:
cd $MOZBUILD/mozilla/

<span class="dhash">##</span> Set to a sufficiently high number for the changeset to be found
<b>LOG_NUM</b>=<span class="comment">500</span>
ESR_SUFF="" &amp;&amp; [[ $REL == esr?? ]] &amp;&amp; ESR_SUFF=esr
<span class="dhash">##</span> Print the latest release version ..
hg log -l $LOG_NUM -Gr ::$REL | grep -o FIREFOX_.*_RELEASE |head -n2
<span class="dhash">##</span> .. then from that set the Firefox version - excluding any esr suffix
<b>REL_TAG</b>=<span class="comment">68_1_0</span>

REL_CS=$(hg log -l $LOG_NUM -Gr ::$REL | grep FIREFOX_$REL_TAG${ESR_SUFF:-}_RELEASE | grep -o "Tagging [0-f]*"|colrm 1 8|colrm 13)
<span class="appx">echo $REL_CS</span>
<span class="dhash">##</span> Create new bookmark to that release changeset
hg bookmark -r $REL_CS ${REL}_$REL_TAG
<span class="dhash">##</span> Set the new bookmark active
hg checkout ${REL}_$REL_TAG
</code>
<b><i>Building to any other revision</b></i>:
Find the changesets within mozilla-unified applicable to REL only.
<code class="green"><span class="dhash">##</span> List last NUM_CS changesets:
cd $MOZBUILD/mozilla/
<b>NUM_CS</b>=<span class="comment">5</span>
hg log -l $NUM_CS -Gr ::$REL -R $MOZBUILD/mozilla | colrm 1 3

<span class="dhash">##</span> Select a changeset from that list, and create a bookmark and set it active:
<b>BUILD_CS</b>=<span class="comment">xxxxxxxxxxxx</span>

<span class="dhash">##</span> Create new bookmark to that changeset
hg bookmark -r $BUILD_CS ${REL}_$BUILD_CS
<span class="dhash">##</span> Set the new bookmark active
hg checkout ${REL}_$BUILD_CS
</code>

<b><u>comm-$REL</b></u>
SeaMonkey doesn't run beyond 2.57, so for mozilla > 60, this applies to TB only ..
SeaMonkey releases are ad-hoc and the Thunderbird release revision hashes are available from the candidates repository.
This procedure is for Thunderbird releases - for other TB builds, just set the revisions as required.
<code class="green"><span class="dhash">##</span> <b>Thunderbird</b>:
TB_VER=$(cat $MOZBUILD/$REL/comm-$REL/mail/config/version.txt)
<span class="appx">echo $TB_VER</span>

cd $MOZBUILD/sources/
<span class="dhash">##</span> [1] Get list of release candidates and find the latest for this release version
<span style="color: #c50000;">wget -O TB-candidates.html https://archive.mozilla.org/pub/thunderbird/candidates/</span>
TB_REL_CAND=$(grep -oE "${TB_VER}-candidates|${TB_VER}b[0-9]-candidates" TB-candidates.html | tail -n 1)
<span class="appx">echo $TB_REL_CAND</span>

<span class="dhash">##</span> [2] Get list of release candidate builds and find the latest
<span style="color: #c50000;">wget -O $TB_REL_CAND.html https://archive.mozilla.org/pub/thunderbird/candidates/$TB_REL_CAND/</span>
TB_BUILD=$(grep build $TB_REL_CAND.html|tail -n1|cut -d"/" -f6)
<span class="appx">echo $TB_BUILD</span>

<span class="dhash">##</span> [3] Download the .txt file which includes the changeset reference for that build ...
TB_TXT="thunderbird-$(echo $TB_REL_CAND |cut -d- -f1).txt"
<span class="appx">echo $TB_TXT</span>
<span style="color: #c50000;">wget https://archive.mozilla.org/pub/thunderbird/candidates/$TB_REL_CAND/$TB_BUILD/linux-$ARCH/en-US/$TB_TXT</span>
<span style="color: #E7F5E7;">&lt;&lt;'comment'</span>
For example for TBesr 68.3.0, the contents of this file are:
20191129091924
https://hg.mozilla.org/releases/comm-esr68/rev/228eab07a730c48763e1cd0ccff9491f66e4580e
https://hg.mozilla.org/releases/mozilla-esr68/rev/78ab5e054eb0a2a71f3d1f1875de5fc4c575ac91
<span style="color: #E7F5E7;">comment</span>
<span class="dhash">##</span> &hellip; and find the changesets
COMM_BUILD_CS=$(grep comm- $TB_TXT | cut -d"/" -f7 | colrm 13)
<span class="appx">echo $COMM_BUILD_CS</span>
TB_MOZ_BUILD_CS=$(grep mozilla- $TB_TXT | cut -d"/" -f7 | colrm 13)
<span class="appx">echo $TB_MOZ_BUILD_CS</span>
</code>
For non-release builds, set revisions here:
<code class="appx"><span class="dhash">##</span> The comm-$REL revision
COMM_BUILD_CS=
<span class="dhash">##</span> The mozilla revision
TB_MOZ_BUILD_CS=
<span class="dhash">##</span> The TB version - only used here to set a name for the bookmark
TB_VER=
</code>
<code class="green"><span class="dhash">##</span> <b>Thunderbird<span class="comment">/SeaMonkey</span></b>:
hg checkout -r $COMM_BUILD_CS -R $MOZBUILD/$REL/comm-$REL

<span class="dhash">##</span> <b>Firefox</b>:
<span class="dhash">##</span> Create new bookmark to TB changeset
hg bookmark -r $TB_MOZ_BUILD_CS TB_$TB_VER -R $MOZBUILD/mozilla
<code class="thtwo"><span class="dhash">##</span> update and switch to THUNDERBIRD_68_VERBRANCH if the changeset cannot be found in mozilla &hellip;
[[ $(echo $?) != 0 ]] &amp;&amp; hg update THUNDERBIRD_68_VERBRANCH -C -R $MOZBUILD/mozilla &amp;&amp; \
hg bookmark -r $TB_MOZ_BUILD_CS TB_$TB_VER -R $MOZBUILD/mozilla
</code>
<span class="dhash">##</span> Set the new bookmark active
hg checkout TB_$TB_VER -R $MOZBUILD/mozilla
</code>
Record the mozilla revision that the SeaMonkey/Thunderbird builds are based on to add to application.ini in the packages.
<code class="green">export Gecko_Rev=$TB_MOZ_BUILD_CS
</code>
Check that the repositories are set up for the correct revisions:
<code class="appx"><span class="dhash">##</span> FF:
hg bookmarks -R $MOZBUILD/mozilla
<span class="dhash">##</span> SM/TB:
hg parent -R $MOZBUILD/$REL/comm-$REL
</code>

Delete any bookmark when no longer required:
<code class="appx">hg bookmark --delete xxxxxx -R $MOZBUILD/mozilla
</code>

<span class="tabs"><a href="#close_known_rel">close</a></span>
</div></div>
<!--
Building to a changeset - end
-->
<p>

Find the Firefox major version for later version dependent settings
<br>
<code class="gray">export MAJ_VER=$(cat $MOZBUILD/mozilla/browser/config/version.txt | cut -d. -f1)
</code>

<p><a name="Create_mozconfigs"></a>
<b>Create mozconfigs</b>
<br>
As three packages are being built, set up mozconfig.{common,firefox,seamonkey,thunderbird}
<br>
'mach' will install wherever '--prefix=' points to.
<br>
Other options can be seen in 'old-configure'
<p>
mozconfig.common:
<br>
<code class="gray">(cd $MOZBUILD/mozilla
cat &gt; mozconfig.common &lt;&lt; "EOF"
<span class="dhash">##</span> From FF66, AUTOCONF has to be 'exported' to be found by the js/src configuration
<span class="dhash">##</span> so to attempt to forestall any future problems, let's export everything
mk_add_options "export MOZ_MAKE_FLAGS=$NUMJOBS"
mk_add_options "export NO_MERCURIAL_SETUP_CHECK=1"
mk_add_options "export AUTOCONF=$MOZBUILD/sources/autoconf_213/bin/autoconf"
<span class="dhash">##</span> llvm installed off PATH for the use of this build only
mk_add_options "export LLVM_CONFIG=$MOZBUILD/sources/llvm-$ARCH/usr/bin/llvm-config"

ac_add_options --prefix=/usr

<span class="dhash">##</span> If you have installed DBus-Glib comment out this line:
<span class="dhash">#</span>ac_add_options --disable-dbus

<span class="dhash">##</span> If you have installed dbus-glib, and you have installed (or will install)
<span class="dhash">##</span> wireless-tools, and you wish to use geolocation web services, comment out
<span class="dhash">##</span> this line
ac_add_options --disable-necko-wifi

<span class="dhash">##</span> Build with cairo-gtk3
<span class="dhash">##</span> Other option is cairo-gtk3-wayland
ac_add_options --enable-default-toolkit=cairo-gtk3

<span class="dhash">##</span> Uncomment this option if you don't have PulseAudio installed
<span class="dhash">#</span>ac_add_options --disable-pulseaudio

<span class="dhash">##</span> If you have installed GConf, comment out this line
ac_add_options --disable-gconf

ac_add_options --disable-crashreporter
ac_add_options --disable-updater
ac_add_options --disable-tests
ac_add_options --enable-optimize
<span class="dhash">##</span> build Firefox as 'Nightly' and Thunderbird as 'Daily'
ac_add_options --disable-official-branding
ac_add_options --with-system-zlib

<span class="dhash">##</span> option to disable stylo for [ FF -le 60 ]
<span class="dhash">#</span>ac_add_options --disable-stylo

EOF
)
</code>

<p>
<b>FF64</b>+ needs additional setting up, including when used for SM/TB builds
<br>
<code class="gray">[[ $MAJ_VER -ge 64 ]] &amp;&amp; {
<span class="dhash">##</span> [1] <b>cbindgen</b> - download, build, and install to the same directory as rustc &amp; cargo
cd $MOZBUILD/sources
<span class="dhash">##</span> for the latest version:
<span style="color: #c50000;">wget -O cbindgen-releases.html https://github.com/eqrion/cbindgen/releases</span>
CBINDGEN_REL=$(grep archive.*tar.gz cbindgen-releases.html | head -n1 | cut -d'"' -f2 | cut -d'/' -f5)
<span style="color: #c50000;">wget -O cbindgen-$CBINDGEN_REL https://github.com/eqrion/cbindgen/archive/$CBINDGEN_REL</span>
tar xf cbindgen-$CBINDGEN_REL
cd cbindgen-[0-9]*
cargo install --root $MOZBUILD/sources/rust-$ARCH cbindgen

<span class="dhash">##</span> if cbindgen decides it can't find some rustc libs, set RPATH as per rustc:
patchelf --force-rpath --set-rpath \$ORIGIN/../lib $MOZBUILD/sources/rust-$ARCH/bin/cbindgen

<span class="dhash">##</span> [2] <b>nodejs</b> - v8.12.0 builds from the script at slackbuilds.org
installpkg nodejs-8.12.0-x86_64-1_SBo.txz

<span class="dhash">##</span> [3] Set MOZBUILD_STATE_PATH so the build completes without prompting
echo 'mk_add_options "export MOZBUILD_STATE_PATH=$MOZBUILD/.mozilla"' >> $MOZBUILD/mozilla/mozconfig.common

<span class="dhash">##</span> [4] With mozilla as the topsrcdir, need to set the suite/mail applications to the <a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1515812">'comm' directory</a>
export COMM=comm/
}
</code>

<p>
<b>FF69</b>+ needs additional setting up if clang isn't in the PATH
<br>
<code class="gray">[[ $MAJ_VER -ge 69 ]] &amp;&amp; {
<span class="dhash">##</span> From FF69, bindgen needs clang
echo 'ac_add_options --with-clang-path=$MOZBUILD/sources/llvm-x86_64/usr/bin/clang++' >> $MOZBUILD/mozilla/mozconfig.common
}
</code>

<p>
mozconfig.firefox:
<br>
<code class="gray">(cd $MOZBUILD/mozilla
cat &gt; mozconfig.firefox &lt;&lt; "EOF"
<span class="dhash">##</span> include the common mozconfig
source $MOZBUILD/mozilla/mozconfig.common

<span class="dhash">##</span> for Firefox build
ac_add_options --enable-application=browser
mk_add_options MOZ_OBJDIR=$MOZBUILD/$REL/firefox-build-dir-$PKG_ARCH

EOF
)
</code>
<p>
mozconfig.seamonkey:
<br>
<code class="gray">(cd $MOZBUILD/$REL/comm-$REL
cat &gt; mozconfig.seamonkey &lt;&lt; "EOF"
<span class="dhash">##</span> include the common mozconfig
source $MOZBUILD/mozilla/mozconfig.common

<span class="dhash">##</span> for SeaMonkey build
ac_add_options --enable-application=${COMM:-}suite
mk_add_options MOZ_OBJDIR=$MOZBUILD/$REL/seamonkey-build-dir-$PKG_ARCH

EOF
)
</code>

<p>
mozconfig.thunderbird:
<br>
<code class="gray">(cd $MOZBUILD/$REL/comm-$REL
cat &gt; mozconfig.thunderbird &lt;&lt; "EOF"
<span class="dhash">##</span> include the common mozconfig
source $MOZBUILD/mozilla/mozconfig.common

<span class="dhash">##</span> for Thunderbird build
ac_add_options --enable-application=${COMM:-}mail
mk_add_options MOZ_OBJDIR=$MOZBUILD/$REL/thunderbird-build-dir-$PKG_ARCH

EOF
)
</code>

<p>
[a] For Thunderbird esr60 builds, and to simplify the use of compare-locales for localization, bind the mozilla repository into the comm-$REL tree - linking confuses the build for the ${_topsrcdir} value.
<br>
[b] For SM2.57, and TB64 onwards [maybe earlier - I didn't build TB62-63], with <b>mozilla as topsrcdir</b>, the comm-$REL directory needs to be placed as a comm directory in mozilla. This won't be used for, nor affect, builds of prior versions.
<br>
<code class="gray">(cd $MOZBUILD/$REL/comm-$REL
<span class="dhash">##</span> [a]
mkdir -p mozilla
mount -B $MOZBUILD/mozilla mozilla

<span class="dhash">##</span> [b]
cd mozilla
mkdir -p comm
mount -B $MOZBUILD/$REL/comm-$REL comm)
</code>
<p>
Remove any stale configure file:
<br>
<code class="gray">rm -f $MOZBUILD/mozilla/configure
</code>
<p>
<a class="extlink" href="http://lists.linuxfromscratch.org/pipermail/blfs-book/2019-July/082190.html">Patch esr60</a> for SM 2.57 build failure for undocumented macros with rust-1.33+
<br>
<code class="gray">[[ $REL == esr60 ]] &amp;&amp; {
cd $MOZBUILD/mozilla
sed -i -e 's/#!\[deny(unsafe_code, missing_docs)\]/#!\[deny(unsafe_code)\]/g' servo/components/style_traits/lib.rs
sed -i -e '/#!\[deny(missing_docs)\]/d' servo/components/style/lib.rs
}
</code>
<p>
<!--
User preferences - start
-->
<a name="close_prefs"></a>
<br>
<span class="tabs prefs"><a href="#Prefs">User preferences</a></span>
<div id="Prefs" class="tab"><div class="b_prefs"><span class="tabs"><a href="#close_prefs">close</a></span>
<!-- leave this space -->
<b>User preferences options</b>
<b>[1]</b> To enable <a class="extlink" href="https://wiki.mozilla.org/Electrolysis">e10s</a> by default:
<code class="green">cd $MOZBUILD
<span class="dhash">##</span> <b>Firefox</b>:
sed -i 's|pref("browser.tabs.remote.autostart", false);|pref("browser.tabs.remote.autostart", true);|' mozilla/browser/app/profile/firefox.js

<span class="dhash">##</span> <b>SeaMonkey</b>:
echo 'pref("browser.tabs.remote.autostart", true);' >> $REL/comm-$REL/suite/browser/browser-prefs.js
echo 'pref("browser.tabs.remote.desktopbehavior", true);' >> $REL/comm-$REL/suite/browser/browser-prefs.js
</code>
<b>[2]</b> Where the server or meta tags don't identify file encoding, setting default fallback encoding to UTF-8 has been <a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=967981#c4">deliberately blocked</a>.
To enable default fallback encoding to be set to UTF-8:
<code class="green"><span class="dhash">##</span> <b>Firefox and SeaMonkey</b>:
<span class="dhash">##</span> remove UTF8 block:
sed -i 's|IsAsciiCompatible() .*$|IsAsciiCompatible() ) {|;/UTF_8/d' mozilla/dom/encoding/FallbackEncoding.cpp

<span class="dhash">##</span> set "Fallback Text Encoding" to 'Unicode' by default
<span class="dhash">##</span> otherwise, "Fallback Text Encoding" will default to 'Default for Current Locale':
sed -i 's|fallback.override.*$|fallback.override",      "UTF-8");|' mozilla/modules/libpref/init/all.js

<span class="dhash">##</span> <b>Firefox</b>:
<span class="dhash">##</span> To allow manual selection of UTF-8, add Unicode option to "Preferences|Content|Fonts &amp; Colors|Advanced|Fallback Text Encoding" menu -
<span class="dhash">##</span> Replace/remove 'legacy' reference in menu -
<span class="dhash">##</span> Change '&hellip; {my,your} selections &hellip;' to '&hellip; the selections &hellip;' -
[[ $MAJ_VER == 60 ]] &amp;&amp; {
sed -i "293i\            &lt;menuitem label=\"\&amp;languages.customize.Fallback.unicode;\"     value=\"UTF-8\"/&gt;" mozilla/browser/components/preferences/fonts.xul
sed -i '104i&lt;!ENTITY languages.customize.Fallback.unicode     "Unicode"&gt;' mozilla/browser/locales/en-US/chrome/browser/preferences/fonts.dtd
sed -i 's|Legacy|Unidentified|;s|legacy content|content|' mozilla/browser/locales/en-US/chrome/browser/preferences/fonts.dtd
sed -i 's| [a-z]* selections| the selections|' mozilla/browser/locales/en-US/chrome/browser/preferences/{colors,fonts}.dtd
} || {
sed -i 's|^.*turkish.*$|&amp;\n            &lt;menuitem data-l10n-id="fonts-languages-fallback-name-unicode"     value="UTF-8"/>|' mozilla/browser/components/preferences/fonts.xul
sed -i 's|^.*turkish.*$|&amp;\n                fonts-languages-fallback-name-unicode.label,|' mozilla/browser/components/preferences/in-content/main.xul
sed -i 's|^.*Turkish.*$|&amp;\nfonts-languages-fallback-name-unicode =\n    .label = Unicode|' mozilla/browser/locales/en-US/browser/preferences/fonts.ftl
sed -i 's|Legacy|Unidentified|;s|legacy content|content|' mozilla/browser/locales/en-US/browser/preferences/fonts.ftl
sed -i 's| [a-z]* selections| the selections|' mozilla/browser/locales/en-US/browser/preferences/{colors,fonts}.ftl
}

<span class="dhash">##</span> <b>SeaMonkey</b>:
<span class="dhash">##</span> To allow manual selection of UTF-8, add Unicode option to "Preferences|Browser|Languages|Fallback Text Encoding" menu:
sed -i '116i\            &lt;menuitem label="\&FallbackCharset.unicode;"     value="UTF-8"/>' $REL/comm-$REL/suite/components/pref/content/pref-languages.xul
sed -i '37i&lt;!ENTITY FallbackCharset.unicode      "Unicode">' $REL/comm-$REL/suite/locales/en-US/chrome/common/pref/prefutilities.dtd
<span class="dhash">##</span> and for "Preferences|Mail &amp; Newsgroups|Text Encoding" menu:
sed -i '98i\            &lt;menuitem label="\&FallbackCharset.unicode;"     value="UTF-8"/>' $REL/comm-$REL/suite/mailnews/components/prefs/content/pref-character_encoding.xul
sed -i '60i\            &lt;menuitem label="\&FallbackCharset.unicode;"     value="UTF-8"/>' $REL/comm-$REL/suite/mailnews/components/prefs/content/pref-character_encoding.xul
<span class="dhash">##</span> replace/remove 'legacy' reference in menu:
sed -i 's|Legacy|Unidentified|;s|legacy content|content|' $REL/comm-$REL/suite/locales/en-US/chrome/common/pref/pref-languages.dtd
sed -i 's|Legacy|Unidentified|' $REL/comm-$REL/suite/locales/en-US/chrome/common/help/cs_nav_prefs_navigator.xhtml

<span class="dhash">##</span> <b>Thunderbird</b>:
<span class="dhash">##</span> Change '&hellip; {my,your} selections &hellip;' to '&hellip; the selections &hellip;'
sed -i 's| [a-z]* selections| the selections|' $REL/comm-$REL/mail/locales/en-US/chrome/messenger/preferences/colors.dtd
</code>
<b>[3]</b> To include the search box by default:
<code class="green"><span class="dhash">##</span> <b>Firefox</b>:
sed -i 's|urlbar-container",|&amp;\n      "search-container",|' mozilla/browser/components/customizableui/CustomizableUI.jsm

<span class="dhash">##</span> <b>SeaMonkey</b>:
sed -i 's|nav-bar-inner,|&amp;search-container,|' $REL/comm-$REL/suite/browser/navigator.xul
</code>
<b>[4]</b> For esr??, set SeaMonkey and Thunderbird versions to correspond to the mozilla [FF] release on which they are based:
<code class="green"><span class="dhash">##</span> <b>SeaMonkey/Thunderbird</b>:
[[ $REL == esr* ]] &amp;&amp; {
echo 2.$[$MAJ_VER-3].$(cat $MOZBUILD/mozilla/browser/config/version.txt|cut -d. -f2-) > $MOZBUILD/$REL/comm-$REL/suite/config/version.txt
[[ $TB_VER ]] &amp;&amp; echo $TB_VER > $MOZBUILD/$REL/comm-$REL/mail/config/version.txt || \
cp $MOZBUILD/mozilla/browser/config/version.txt $MOZBUILD/$REL/comm-$REL/mail/config/version.txt
}
</code>
<b>[5]</b> Change default page options for FF57+:
Ref. [aA]boutNewTabService.js{,m}:
<code class="console"> * 1. Browser chrome access:
 *
 * When the user issues a command to open a new tab page, usually clicking a button
 * in the browser chrome or using shortcut keys, the browser chrome code invokes the
 * service to obtain the newtab URL. It then loads that URL in a new tab.
 *
 * When not overridden, the default URL emitted by the service is "about:newtab".
 * When overridden, it returns the overriden URL.
 *
 * 2. Redirector Access:
 *
 * When the URL loaded is about:newtab, the default behavior, or when entered in the
 * URL bar, the redirector is hit. The service is then called to return either of
 * two URLs, a chrome or the activity stream one, based on the
 * browser.newtabpage.activity-stream.enabled pref.
 *
 * NOTE: "about:newtab" will always result in a default newtab page, and never an overridden URL.
 *</code>
<code class="green"><span class="dhash">##</span> <b>Firefox</b>:
<span class="dhash">##</span> Default to blank page on start &hellip;
<span class="dhash">##</span> This <span class="appx">"about:blank";</span> replacement could be <span class="appx">"file:///path/to/my/startup_page.html";</span> to load a customized page:
[[ $MAJ_VER == 60 ]] &amp;&amp; \
sed -i 's|about:home|about:blank|' $MOZBUILD/mozilla/browser/branding/*/locales/browserconfig.properties || \
sed -i 's|pref("browser.startup.homepage".*$|pref("browser.startup.homepage","about:blank");|' $MOZBUILD/mozilla/browser/app/profile/firefox.js

<span class="dhash">##</span> &hellip; and stop the privacy page loading:
sed -i 's|true|false|' $MOZBUILD/mozilla/toolkit/components/telemetry/datareporting-prefs.js

<span class="dhash">##</span> Load a blank page with Ctrl+T or new tab button.
sed -i 's|"about:newtab";|"about:blank";|' $MOZBUILD/mozilla/browser/components/newtab/[aA]boutNewTabService.js*

<span class="dhash">##</span> <b>SeaMonkey</b>:
<span class="dhash">##</span> Default to blank page on start &hellip;
sed -i 's|http://www.seamonkey-project.org/start/|about:blank|' $MOZBUILD/$REL/comm-$REL/suite/locales/en-US/chrome/browser/region.properties
</code>
<b>[6]</b> Record the mozilla revision that the SeaMonkey/Thunderbird builds are based on to add to application.ini in the packages.
<code class="green"><span class="dhash">##</span> <b>SeaMonkey/Thunderbird</b>:
[[ ! $Gecko_Rev ]] &amp;&amp; export Gecko_Rev=$(hg bookmarks -R $MOZBUILD/mozilla | grep \* |cut -d: -f2)
</code>
<span class="tabs"><a href="#close_prefs">close</a></span>
</div>
</div>
<!--
User preferences - end
-->

<!--
Tooltip box - start
-->
<a name="close_ttip"></a>
<br>
<span class="tabs prefs"><a href="#Ttipbox">Gtk3 configuration</a><span style="vertical-align:-30%">&nbsp; Not a part of the build, just some customization options, for example where the defaults for gtk2/gtk3 differ &hellip;</span></span>
<p>
<div id="Ttipbox" class="tab"><div class="b_prefs"><span class="tabs"><a href="#close_ttip">close</a></span>
<!-- leave this space -->
[1] The default <b>tooltip box</b> for the default gtk3 Adwaita theme has white text on a black background with some padding:

<img
src="data:image/png;base64,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
We50eHBNvsTbYGu9vNdL6m3XdOEb7gez1bhCSIqGmTL1y9fq+yxtd9K0VKxo8dVVVjbrA3MW43y7XdSoGOzw0tJOvXJ3+f+hq10
s9Pd+7y126G0WoeeZLvgA/tpVKZUiWvuF/Dsm4ZJeUB2g8qP3xMBGKQ85h7qZ3Bcby51fXllWuuVpdBozIYtDqNWiGXUxSJ4zhJ
Dtg+LIYBz/M04664V9XS2iqlpEqFTCalZFKKklLCHYUD5QvhIwZAcACAYRhJUs3NzoaGhtra2rq6eobp/tT7gUF43o3b7bY3OVp
aWjmO1+s0UooULhL2kVPEQDEwgmuzhWE43vZoEACMICQ4LvGd8hBDEU9voukvPM+zrLvj/KrLNYC2EcME9ARMhKggwSFEBQkOIS
pIcAhRQYJDiAoSHEJUiF8eEfut5wgfERFIlpoG+1FPDJ35RogJ6lIRooIEhxAVJDiEqAzkuVSvyOVyl8uFRo3DEgzDpFJpS0uLl
2KirX6JRIIeETLswXHc8+3xInWpcrkcqe1pgOM4uVzuoYBIGU54f40IjhBPHAzDPCQXkTIcUtvTg+d1jfZSEaKCBIcQFSQ4hKgg
wSFEBQkOISpIcAhRQYJDiAoSHEJUkOAQooIEhxAVJDiEqAxGwS1ZsuT8+fMOh6Opqeny5cvx8fFPOqKBYenSpQaDobdfR48ezfM
8QXi5QnHmzJlff/21QqEAgNjY2AsXLjidzsbGxgsXLixevNiDI6/28/Pz3W632+3mOI7jOGH64MGD27dv3717d18X0iu8KPQ9nq
SkJKvVGhcX5+/vr9PpFi1aZDKZMjIyBmyBnxy3b98eN25cb7/2RXAajaampmbChAkAsHr16sbGxoSEBH9/f4VCsWzZsoaGhtdff
71HRziOd7c/ffr0wMDA7l4OHz78/vvvd3wlCOLatWvz58/v84J6EhUxf9etvhvyNXq9/p133omPjz927JgwJzc312azFRYW7t27
VyqVfvPNN8nJyTExMUFBQadOnVq7di3LslOnTt2xY4fBYGhtbf3DH/7wj3/8IzQ09Pbt26tWrYqLiwsODi4uLl6xYkUX3b/yyiv
vvvuuVqt1u91bt27961//2vnX3ix093X37t3ly5d/+eWXarXaarUmJyfv3LkTAG7cuJGUlPTZZ591LMi4ceMKCgpSU1NzcnJ68x
4fH5+SkqLVao8dO5aYmNjlYsa1a9eeOXPmxo0bSqUyIyPjrbfeys5ue1XV0aNHTSYTTdOdHV26dOnbb7/93e9+l5aWNm/evC6tn
ZiYuH//fpPJ5HmluN3uLVu2bNmy5eTJk31cj55E9eCBRYRPHwNdsGBBa2srjnft6Kuqql5//XVhG01JSQEAlUpVUVGxZMkSnU5X
X1//2muvAUBYWJjNZnvuuecCAwN5nl+/fj0AqNVqi8Uya9aszgalUqndbhe22hkzZjAMM2LEiM4FerTQo68DBw5s2LABAKKjo8+
dO/fPf/4TAAICApqbmztfikgQBM/zQuLp0buwdO+99x6O44GBgbW1tUuWLOnSDt9+++3ChQsBYObMmb1d6tjZUVBQEM/zb7/9No
Zh3TNcbm7unDlzulvokuGEgJubm8PDw7sX7hEPShhcYzi9Xm82m7tfvlddXe3n5ydMHz58GAAcDkdBQUFUVNTs2bOtVuvHH38MA
OXl5cePH+8Yygglm5qa7ty5M2rUqM4GXS7XyJEjP/30UwAoKipiGGbMmDHd4+lioUdfhYWFM2bMAIBZs2bt379/0qRJOI5HRUUV
FRX1doG/B+/vv/8+x3Emk+nkyZNRUVGda2m12oiIiPPnzwsNZbPZvN5AICT1w4cPd87usbGxJpPJZDJFR0cfO3bMZDKVlZV5tuN
yua5evTpt2jTPxfqCqDfReMVsNgcFBUkkki5dSXBwsMXSlibr6+uFCbvdPmrUqMDAwNDQ0Lt37wozZTJZbm6uMN3Y2ChMcBwn6f
b26jfeeGPx4sVCNqUoqnta7W6hR1+nTp3605/+JJFIZs2atX379hUrVkycODEqKqqjM+2R3rx3dHD19fVdNhKj0ciybF1dHQBYL
BaDwaBSqRwOhwcvAh1NJ5CXl5eXlwcAubm5+/fvP3XqlFcLAGA2m3sc8PWXwSW4c+fOuVyuX/ziFwcPPnyzalRUVGBgYGFhoUwm
A4CAgID79+8DgJ+fX11dXU1Nze3btyMjIzvb8do0CxYsSEtLmzJlSkVFBY7jfVltANCjLwC4devWnDlzpFJpbW1tUVHRT3/605k
zZ2ZlZT2Gdz8/v6qqKgAwGAyCtnrkypUrDQ0Nq1at2rFjR8fM+fPnjx8/fteuXV0K92unzdcMri7V6XSmpKRkZWUJO19arTYmJu
bIkSObN2/u2PRXrlwJAH5+fvPmzTt9+vQXX3wRFBQkjIiVSuWBAwcmTZrk1dGIESMsFsu9e/dwHE9NTeV5XqlUeq3Vm6/CwsK0t
LT//Oc/AFBUVBQbGyuTyW7evNm5LsdxLMtqtVrP3juW7tVXXz19+nRnC2azWSKR+Pv7A4DL5UpKSsrIyFi3bt0zzzyj0Wji4uIO
Hz589+7dzo4GEKPR6HX3oi8MLsEBwN69e+Pj4+Pj48vKyqqqqlJSUpKTk3//+993FKipqbl+/fq1a9eOHTuWn59vt9ujo6M3bdp
0586dkpISq9V6/fp1r14++uij6urqO3fuFBcXl5aWHjp0KDs7+9lnn/VcqzdfBQUF06dPP3PmDABcvnx5ypQpBQUFXepyHPfhhx
9+/vnna9eu7dF7eHi4y+WqqakpKSnpWLou3ktLSzsGUtnZ2UuWLImJibl582ZlZWV8fPyiRYvy8vI6O/K8OIsWLepjfyqVSidPn
iwMH78nA/kUcw+MGBHw/Y2MHj26oqKCIAhxXgw8CNm0aVN4ePjy5ctF9rt48eK0tLTnn3++j+U9iGrQZTivPM1v/9i5c+fMmTO9
ZuKBhSCIjRs3bty4cWCsXblyaUAMIUSgsbFx+fLlR44ceemll5qbm8Vxum3btrNnz544caLvVTyISqQboZ/mtPQU4kFUQ69LRQx
pkOAQooIEhxAVJDiEqCDBIUQFCQ4hKkhwCFFBgkOIikiCQwd+nx48r2uRBCeVSsVxhHjieF7X6CnmiIFksDzFHABYlpXJZKhvHa
5gGCaTybxeOYZe7oYQFbSXihAVJDiEqCDBIUQFCQ4hKkhwCFH5fyn0QwztbDFaAAAAAElFTkSuQmCC" alt="">

which is set by the tooltip section in <i>gtk/theme/Adwaita/gtk-contained.css</i> in the gtk3 source:
<pre>
tooltip {
  padding: 4px;
  /* not working */
  border-radius: 5px;
  box-shadow: none;
  text-shadow: 0 1px black; }
tooltip.background {
  background-color: rgba(0, 0, 0, 0.8);
  background-clip: padding-box;
  border: 1px solid rgba(255, 255, 255, 0.1); }
tooltip decoration {
  background-color: transparent; }
tooltip * {
  padding: 4px;
  background-color: transparent;
  color: white; }
</pre>Overriding this in <b><i>~/.config/gtk-3.0/gtk.css</i></b> with:<br><pre>
tooltip {
  border-radius: 0px;
  text-shadow: none;}
tooltip.background {
  background-color: #eee1b3;
  border: 1px solid gray;}
tooltip * {
  padding: 0px;
  color: black;}
</pre>will show the tooltip as:

<img
src="data:image/png;base64,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" alt="">

[2] <b><i>~/.config/gtk-3.0/gtk.css</b></i>
To show scroll-bar stepper icons and set the slider width/height, add:
<pre>
* {
  -GtkScrollbar-has-backward-stepper: true;
  -GtkScrollbar-has-forward-stepper: true; }
scrollbar slider {
  min-width: 10px;
  min-height: 10px; }
scrollbar.horizontal slider {
  min-width: 40px; }
scrollbar.vertical slider {
  min-height: 40px; }
</pre>
[3] <b><i>/etc/gtk-3.0/settings.ini</b></i>
To set 'Print to &hellip;' options, and scroll by one page when clicking in the scroll-bar, add:
<pre>
[Settings]
gtk-print-backends=lpr,file,cups
gtk-primary-button-warps-slider=false
</pre>
See ../gtk-doc/html/gtk3/GtkSettings.html for defaults and more options.
<!-- leave this space -->
<span class="tabs"><a href="#close_ttip">close</a></span>
</div>
</div>
<!--
Tooltip box - end
-->

<!--
Localization - start
-->
<a name="close_l10n"></a>
<br>
<span class="tabs locn"><a href="#l10n">Localization</a><span style="vertical-align:-30%">&nbsp;</span></span>
<p>
<div id="l10n" class="tab"><div class="b_locn"><span class="tabs"><a href="#close_l10n">close</a></span>
<!-- leave this space -->
<b>compare-locales</b> - needs python-setuptools.
compare-locales will identify new files in the en-US locale which aren't in the $L10N locale; and add any new entity strings that are in the en-US locale files but not in the $L10N locale files to copies in the merge-$L10N directory.
The following process extends that to <b>copy new files</b> to the merge-$L10N directory and display them for editing the localization strings.
And displays any <b>new strings added</b> to existing files to show any that need localizing.

<b>Download, build, and install compare-locales.</b>
<i>Note:</i> that this process is set up to use compare-locales v1.2.3, so the build has been reverted to changeset e413c5aba051.
<code class="red">(cd $MOZBUILD/sources
hg clone https://hg.mozilla.org/l10n/compare-locales/ compare-locales
cd compare-locales
hg checkout e413c5aba051
python setup.py build install)
</code>

<b>Known issues</b>
There will be some error messages here about files not found.
This is a consequence of the localization transition and it's becoming too onerous to test for them.
I've found them to be harmless .. and in the issues I've covered, the results are as required.

Remove any previously created temporary file lists and merge-$L10N directory:
<code class="red">rm -f $MOZBUILD/l10n/* 2>/dev/null
rm -rf $MOZBUILD/l10n/merge-$L10N
rm -rf $MOZBUILD/l10n/wip/*

<span class="dhash">##</span> unmount 'comm' directory as it duplicates the search results
umount $MOZBUILD/$REL/comm-$REL/mozilla/comm
</code>
To build to a release version:
<code class="green"><b>Either:</b>
From FF59.0, the l10n revisions are contained in the l10n-changesets.json file:
<code class="red">export L10N_CS=$(grep -A 15 $L10N $MOZBUILD/mozilla/browser/locales/l10n-changesets.json | grep revision | colrm 1 21 |sed 's|"||')
<span class="appx">echo $L10N_CS</span>
[[ $L10N_CS == default ]] &amp;&amp; L10N_CS=$(hg log -l 1 -R $MOZBUILD/l10n/$L10N | head -n1 | cut -d":" -f3)
hg checkout -r $L10N_CS -C -R $MOZBUILD/l10n/$L10N
</code>
<b>Or:</b>
For a known changeset:
<code class="red"><span class="dhash">##</span> <b>Firefox</b>:
export <b>L10N_CS</b>=<span class="comment">xxxxxxxxxxxx</span>
hg checkout -r $L10N_CS -C -R $MOZBUILD/l10n/$L10N
</code></code>

<b>Comparing en-US and $L10N localizations</b> &hellip;
Create a list of default en-US localization files:
<code class="red">tree -fi $MOZBUILD/$REL/comm-$REL/{mozilla,suite,editor,mail} | grep -v android | grep en-US | grep ".*\..*$" > $MOZBUILD/l10n/en-US-l10n-files
</code>
&hellip; <b>copy new files</b> &hellip;
Run compare-locales and identify the new files found &hellip;
<code class="red">echo -e 'mozilla/browser\nsuite\nmail' | while read line ; do
compare-locales -m $MOZBUILD/l10n/merge-$L10N $MOZBUILD/$REL/comm-$REL/$line/locales/l10n.ini $MOZBUILD/l10n $L10N \
| tee $MOZBUILD/l10n/$(echo $line | tr / _)-compare-locales-output | grep -B 1  "add and localize this file" \
| grep -Ev "\-\-|localize" > $MOZBUILD/l10n/$(echo $line | tr / _)-new-files
done
</code>
&hellip; find paths of new files and remove duplications where suite/mail use mozilla files &hellip;
<code class="red">echo -e "mozilla_browser\nsuite\nmail" | while read line ; do
cat $MOZBUILD/l10n/$line-new-files | while read line ; do
grep $line $MOZBUILD/l10n/en-US-l10n-files
done ; done | sort -u | tee $MOZBUILD/l10n/new-files-en-US-path \
| sed 's|locales/en-US/||' \
| sed "s|^.*/comm-$REL/mozilla|$MOZBUILD/l10n/merge-$L10N|" \
| sed "s|^.*/comm-$REL|$MOZBUILD/l10n/merge-$L10N|" > $MOZBUILD/l10n/new-files-$L10N-path
</code>
&hellip; and create any new directories in merge-$L10N required by new files &hellip;
<code class="red">cat $MOZBUILD/l10n/new-files-$L10N-path | while read line
do
echo $line | rev | cut -d/ -f2- | rev
done | sort -u | while read line
do
[[ ! -d $line ]] &amp;&amp; mkdir -p $line
done
</code>
&hellip; and copy the new en-US files to the merge-$L10N directory &hellip;
<code class="red">(cd $MOZBUILD/l10n/
paste -d ' ' new-files-en-US-path new-files-$L10N-path | while read line
do
cp $line
done)
</code>
&hellip; and then edit them for localizations:
<code class="red"><b>MY_FAV_EDITOR</b>=kate
$MY_FAV_EDITOR $(cat $MOZBUILD/l10n/new-files-$L10N-path)
</code>

&hellip; <b>new strings added</b>
<i>compare-locales</i> will append any new lines to existing localization files while copying them to merge-$L10N.
The following displays the additional lines to show whether any of them need localizing.
Edit the <b><i>merge-$L10N</b></i> file because that has priority over the equivalent $L10N file during the build.
<code class="red">(cd $MOZBUILD/l10n/
<span class="dhash">##</span> list the files that have been added to:
echo -e 'mozilla_browser\nsuite\nmail' | while read line ; do
grep "adding to" $line-compare-locales-output | sed 's|adding to ||g' | tee -a adding-to | sed 's|merge-||g' >> added-from
done

<span class="dhash">##</span> remove duplicate files and display the additional lines:
paste -d " " added-from adding-to | sort -u | while read line
do
diff -U 0 $line
done > added-diffs

<span class="dhash">##</span> display the diff in a syntax highlighting editor to more easily show lines that might need localizing:
$MY_FAV_EDITOR added-diffs)
</code>

<b>Set up searchplugins for locale.</b>
This is en-GB specific, but should be adaptable for other locales &hellip;
Set up google search on google.co.uk:
<code class="red">[[ $MAJ_VER -ge 62 ]] &amp;&amp; SEARCHPLUGINS_DIR=$MOZBUILD/mozilla/browser/components/search/searchplugins/ || \
SEARCHPLUGINS_DIR=$MOZBUILD/mozilla/browser/locales/searchplugins/
(cd $SEARCHPLUGINS_DIR
cat google.xml | sed 's|google.com|google.co.uk|;s|Google&lt;|Google.co.uk&lt;|' > google-$L10N.xml)
</code>
<a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1303636">eBay was removed</a> from the list of built-in searchplugins, although it has been re-instated.
To recover the previous icon for this personal build, extract the file from a changeset that contains it:
<code class="red">(cd $MOZBUILD/l10n/$L10N
hg revert -r 1a7204 mail/searchplugins/eBay-$L10N.xml
mv mail/searchplugins/eBay-$L10N.xml $SEARCHPLUGINS_DIR)
</code>

<b>To enable default fallback encoding to be set to UTF-8</b>:
Requires <b>[2]</b> in the previous section '<a href="#Prefs">User preferences</a>' to have been set up.
<code class="green"><code class="red"><span class="dhash">##</span> <b>Firefox</b>:
<span class="dhash">##</span> Modify files in the $L10N and merge-$L10N directories
(cd $MOZBUILD/l10n/
[[ $MAJ_VER == 60 ]] &amp;&amp; \
sed -i -e 's|Legacy|Unidentified|;s|legacy content|content|;104i&lt;!ENTITY languages.customize.Fallback.unicode     "Unicode">' {,merge-}$L10N/browser/chrome/browser/preferences/fonts.dtd 2>/dev/null || \
sed -i 's|Legacy|Unidentified|;s|legacy content|content|;s|^.*Turkish.*$|&amp;\nfonts-languages-fallback-name-unicode =\n    .label = Unicode|' {,merge-}$L10N/browser/browser/preferences/fonts.ftl 2>/dev/null)
</code>
<code class="red"><span class="dhash">##</span> <b>SeaMonkey</b>:
<span class="dhash">##</span> Modify files in the $L10N and merge-$L10N directories

(cd $MOZBUILD/l10n/
sed -i '37i&lt;!ENTITY FallbackCharset.unicode      "Unicode">' {,merge-}$L10N/suite/chrome/common/pref/prefutilities.dtd 2>/dev/null
sed -i 's|Legacy|Unidentified|;s|legacy content|content|' {,merge-}$L10N/suite/chrome/common/pref/pref-languages.dtd 2>/dev/null
sed -i 's|Legacy|Unidentified|' {,merge-}$L10N/suite/chrome/common/help/cs_nav_prefs_navigator.xhtml 2>/dev/null)
</code></code>

Change '&hellip; {my,your} selections &hellip;' to '&hellip; the selections &hellip;'
<code class="green"><code class="red"><span class="dhash">##</span> <b>Firefox</b>:
[[ $MAJ_VER == 60 ]] &amp;&amp; \
sed -i 's| [a-z]* selections| the selections|' $MOZBUILD/l10n/{,merge-}$L10N/browser/chrome/browser/preferences/{colors,fonts}.dtd || \
sed -i 's| [a-z]* selections| the selections|' $MOZBUILD/l10n/{,merge-}$L10N/browser/browser/preferences/{colors,fonts}.ftl

<span class="dhash">##</span> <b>Thunderbird</b>:
sed -i 's| [a-z]* selections| the selections|' $MOZBUILD/l10n/{,merge-}$L10N/mail/chrome/messenger/preferences/colors.dtd
</code></code>

Default to blank page on start &hellip;
<code class="green"><code class="red"><span class="dhash">##</span> <b>SeaMonkey</b>:
sed -i 's|http://www.seamonkey-project.org/start/|about:blank|' $MOZBUILD/l10n/$L10N/suite/chrome/browser/region.properties
</code></code>

<b>Workaround for FF57+.</b>

Firstly, a brief explanation.
Up to FF56, it was possible to build a single localized version using 
ac_add_options --enable-ui-locale=
ac_add_options --with-l10n-base=
and
LOCALE_MERGEDIR=

This enabled the additional lines and files identified by compare-locales to be localized prior to the build.

The localization build method was changed for FF57 [<a class="extlink" href="https://blog.mozilla.org/l10n/2017/08/04/create-a-localized-build-locally/">blog</a>, <a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1402564">bugzilla</a>, <a class="extlink" href="https://firefox-source-docs.mozilla.org/build/buildsystem/locales.html">single locale build</a>], but I haven't checked yet whether it would allow a pre-set merge-ab-CD directory which is necessary for checking localization.

What I've done is continue from the previous setup for using localized files and copied them to the corresponding en-US locations so the default en-US build uses localized files. A minor issue is that internal localization directories are referenced as en-US, but the dictionary, texts and messages in the final build are in the intended localization.
<code class="red"><span class="dhash">##</span> Copy en-US and $L10N to a working area:
while read file
do
cp -a --parents $file $MOZBUILD/l10n/wip
done &lt; $MOZBUILD/l10n/en-US-l10n-files
cp -a --parents $MOZBUILD/l10n/$L10N $MOZBUILD/l10n/wip

<span class="dhash">##</span> Remove unwanted mercurial files:
rm -rf $MOZBUILD/l10n/wip$MOZBUILD/l10n/$L10N/.hg*

<span class="dhash">##</span> Overwrite wip&hellip;$L10N with merge-$L10N files:
cp -a $MOZBUILD/l10n/merge-$L10N/* $MOZBUILD/l10n/wip/$MOZBUILD/l10n/$L10N

<span class="dhash">##</span> Create a list of all localized files [unchanged, added to, and new files]:
(cd $MOZBUILD/l10n/wip/
tree -fi * | grep ".*\..*$" | grep -v en-US > $MOZBUILD/l10n/wip/$L10N-l10n-files)

<span class="dhash">##</span> Copy localized files to en-US locations with a test run if required:
<b>TEST_CP=no</b>
<span class="dhash">##</span> Read from the list of localized files ...
  cat $MOZBUILD/l10n/wip/$L10N-l10n-files | while read line
  do
<span class="dhash">##</span> ... extract the filename ...
  FILE=$(echo $line | rev | cut -d/ -f1 | rev)
<span class="dhash">##</span> ... find the path of all en-US file occurrences ...
  en_US_file_PATHS=$(grep $FILE $MOZBUILD/l10n/en-US-l10n-files)
<span class="dhash">##</span> ... for each en-US file occurrence, convert it to $L10N path/filename ...
    for en_US_file in $en_US_file_PATHS
    do
    ab_CD_file_PATH=$(echo $en_US_file \
    | sed 's|locales/en-US/||' \
    | sed "s|^.*/comm-$REL/mozilla|$MOZBUILD/l10n/$L10N|" \
    | sed "s|^.*/comm-$REL|$MOZBUILD/l10n/$L10N|")
<span class="dhash">##</span> ... and if the conversion matches the list entry, copy that $L10N file to en-US
      for path in $ab_CD_file_PATH
      do
      [[ $TEST_CP == no ]] &amp;&amp; \
      {
      [[ $path == /$line ]] &amp;&amp; cp $MOZBUILD/l10n/wip/$line $en_US_file
      true
      } || \
      {
      echo /$line
      echo $path
      [[ $path == /$line ]] &amp;&amp; echo -e "would copy \n $MOZBUILD/l10n/wip/$line \nto \n $en_US_file"
      echo
      }
      done
    done
  done
</code>
Set the default Firefox searchplugins of choice by overriding the en-US string.
The line to change is 3 lines beyond the unique identifier 'en-US':
<code class="red">[[ $MAJ_VER -ge 68 ]] &amp;&amp; {
TLD=<span class="comment">.co.uk</span>
LIST_JSON=$MOZBUILD/mozilla/browser/components/search/extensions/list.json
<span class="dhash">##</span> for eBay<span class="comment">.co.uk</span> [<span class="comment">_locales/uk</span>] -> set as default:
EBAY=ebay-uk
(cd $MOZBUILD/mozilla/browser/components/search/extensions/ebay/_locales
sed -i "s|eBay\"|eBay$TLD\"|" uk/messages.json
sed -i "s|\"en|\"uk|" ../manifest.json)
<span class="dhash">##</span> for Google -> create Google<span class="comment">.co.uk</span> and set as default, and set 'ddg' as second choice:
(cd $MOZBUILD/mozilla/browser/components/search/extensions/google/_locales
cp -rT <span class="comment">b-d</span> $L10N
sed -i "s|google.com|google$TLD|;s|Google\"|Google$TLD\"|" $L10N/messages.json
sed -i "s|\"en|\"$L10N|" ../manifest.json
sed -i "s|\"Google\"|\"Google$TLD\"|;s|\"Bing\"|\"ddg\"|" $LIST_JSON)
} || {
EBAY=eBay-$L10N
[[ $MAJ_VER -ge 62 ]] &amp;&amp; LIST_JSON=$MOZBUILD/mozilla/browser/components/search/searchplugins/list.json || \
LIST_JSON=$MOZBUILD/mozilla/browser/locales/search/list.json
}
LINE_NO=$[$(grep -n en-US $LIST_JSON | cut -d: -f1)+3]
sed -i "${LINE_NO}s|.*|          \"google-$L10N\", \"$EBAY\", \"amazon-$L10N\", \"ddg\", \"wikipedia\", \"bing\", \"chambers-$L10N\"|" $LIST_JSON
</code>
Set the default SeaMonkey searchplugins of choice - source them from the browser locale and the L10N repo:
<code class="red">rm $MOZBUILD/$REL/comm-$REL/suite/locales/en-US/searchplugins/*
cp $MOZBUILD/mozilla/browser/locales/searchplugins/{{eBay,google}-$L10N,bing,wikipedia,ddg}.xml $MOZBUILD/$REL/comm-$REL/suite/locales/en-US/searchplugins/
cp $MOZBUILD/l10n/$L10N/mail/searchplugins/amazon-$L10N.xml $MOZBUILD/$REL/comm-$REL/suite/locales/en-US/searchplugins/
echo "ddg
amazon-$L10N
eBay-$L10N
google-$L10N
wikipedia
bing" > $MOZBUILD/$REL/comm-$REL/suite/locales/en-US/searchplugins/list.txt
</code>
Remount 'comm' directory
<code class="red">mount -B $MOZBUILD/$REL/comm-$REL $MOZBUILD/$REL/comm-$REL/mozilla/comm
</code>
<span class="tabs"><a href="#close_l10n">close</a></span>
</div>
</div>
<!--
Localization - end
-->

<p><br>
<a name="BuildingFFReturn"></a>
<div style="background: #FFFADD;"><span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAADBElEQVR42qWTa0jTURiHs6sWSmnp
vCyZ2/9sS0vwkiuibFp20zStnBElzktKYSubWgyJCnVWaCS2LiRipXZDMyv8oq6yskRXXip1S2eR
TiXSLuj/11nESKpPHXg4nHNenvO+5zJltrvvf/HHhOLxIDep/mNRbN1An7zexMq1w2xsvcmwp+FD
vvxet8s/BaZs0RbZZa085MLjUVJQh4BSLaR3+7G+dgCSaiMCy3QobuoYLq84m/ntuaPVJEGf0nN+
VxKZUGUqJxKzFLh6Pgxb1IfgdqUNvFsG2JW9BbegEUlU2tNzH02VyTWTBNU7xGs7ZAS9qUIYjzLQ
F/AQkJ4Lt1O3MeNiK2w0LbDPeQjvjNsYGdTiU68aA032oRbBo1gm/108g3f7CIwqAv1xD7SnrsaZ
rBQ45DRggaoWnIPV4MSXQFN5AxjMRv+LaSctgrY4gVG/i8CQQtCnJHh/mo9j8eEgqWVwU1RhQVI5
bGXnYLM5DxV3LoI1FaK9Rmy0CHQywXj3DrpzAoEuWgjVuqVYvF2BOTEazJEVwTpUDes1WbCW7MX3
kRKwQ4dRfUHKfm92mvpT8CxCMPE6iqCHZvEkSIjSGAmcAlPgtukAQuTxcAhOg61PItz9ZPjSEYRx
gxCd1xaOWjKoDGZadBsJ3m4neCOjmSQSdCtE0KcT1MQJERoeAXtRNFTK5Rh76IrRxnloOc69YxGU
rCDKxpUEbWEEXTLKToJLwV6IEvrD3WMDHD3CwPeQ4lUxH0PXXdF5goeqreIjFkGGn5dDjZ/g49PA
X5JoWs5ugluRXkhe5g/1Bl/0ZhIM5ghgSGNQFSlim6OYVZNeosaT2fbAm7DmTMzlmM+kK8Z8LvR6
Exj07WWglzN4uVXA1ofw8/54yrTZJTs6594UCb42SAieB1HRJoL2cILOSILWcAY3VjDsfh7nPI11
+ZtgOmURf5Z1upLj3HyZzxurWiJgK334bLH3ws9qsevrSKe5hTRmGcXmn7/RvEjhUswD6UwrqzW0
l1D4FFuK1e/xPwCy1KrpkpT5rQAAAABJRU5ErkJggg=="><span style="vertical-align:20%"><b> Building Firefox [<img style="vertical-align:-20%" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAADBklEQVR4AV2SAxjENgBGX9L0ONu2
bdv+zNm2bdu2bdu2fUavbq/XLJ23V+NHm6irP2zzF3me02t3+OrjT3nlqWeJ45g1NlyPJZZflhlm
mRmlFP9H8ieB73PjhZcxmHLmJcRiK96y5K4Hdxfd6eD816kXnDz4zi/tm+5+4aaPv22vwP8QRYPQ
Dzj94CPY4ZRzju14yXGfuLFqpzmW42N3HZxuB/nLN0xtpeMV1lzxws23WPvQvxsUte+8+nq2P/Xc
437yxyd+G+TKqdRwlSLTQLFlObnjEHz/k/36rXcf/MyDz175t0G/02WlXfZZquWnx/WELTIhSZWF
nOTGXYMJ0BqyaWdGV6dCx2Px3kPP7PT2y++tAyC//uxzHMc96ksnsn5KMxoVm1GYUIoSVJKSJQm6
10T5DqJUwZI2frOhvvrg2/MA1EuPPcWSuy65UTtM8YaBSSlTNkYVLzSiEM/z0KGHcjpYpg1pBDrH
6biLAEJlWUYQptPozgA7m5jqE8q5pjTRhCOXyB1RLsRZioxDyMZ/jlpUBaZTq6y7Fr96ATRaqCBA
pAlihplx45TIcxFGJEpVpDc05oVYI4Q090p0BoGtFl9uGb7+sDuIeu3phUljnJI0fyKZbjZUFGCH
LiWTagNoTUGpPjWVqWrZTNPVu3LGWWfBdH1Run3oNRHDLpbTo9L7lYq5V/EGlH0H+Wf1gsp0szPl
tLXvgIlUSmEFo4sqtpXZkU+xKbOVC4NRF9vpItIIKSQFlWlmRk81jZ5i+qlO+3sqf3r/la/ONtds
19tlW6vYmMSmuj9EBSOUEAgj1kBt+tmpz7UgMy025wsv33rerX8bXPjQY9lnt5907HTzz/VsZfpZ
c6lzhKYQAqL4iVRmnBd77oXQ06pPP7zr1D0KDYDiTyaJP/jmmauPmnGxtXauL7P89iKvTGsZUCUy
ci1E7Pr9T59qvfTMVToNfgX4j8GVb34z3n+rzd7vf/32sb2v3rzcknKW6eacd3bTwnJaP7fHcdTQ
iIY95Qx9oWZP+ZPfAJM8k1+jkGe4AAAAAElFTkSuQmCC"> Nightly]</b></span></span>
<code class="gray">unset XCOMPILE
</code>
</code> <a name="close_FF_xcompile"></a>                                                    <!-- FF xcompile - start -->
<span class="tabs prefs"><a href="#FF_xcompile">Cross compiling</a></span><span style="vertical-align:-30%">&nbsp;&nbsp;additional setting up for cross compiling.</span>
<div id="FF_xcompile" class="tab">
<div class="b_prefs"><span class="tabs th2"><a href="#close_FF_xcompile">close</a></span>
<!-- leave this space -->
The additions fit into the build tree like this:
<code>$MOZBUILD
<span class="comment">├── sources
│   └── rust-&hellip;
│       └── lib
│           └── rustlib
│               ├── x86_64-unknown-linux-gnu		<i>x86_64 crate</i> - already in place for native build</span>
│               ├── i686-unknown-linux-gnu		<i>i686 crate</i>
│               ├── armv7-unknown-linux-gnueabihf	<i>armv7 crate</i>
│               └── aarch64-unknown-linux-gnu		<i>aarch64 crate</i>
└── $TARGET_INSTN					<i>target libs and headers installation - bind mounted to sysroot</i> *

opt
└── cross-pi-gcc
    ├── bin						<i>cross compiler</i>
    └── sysroot *					<i>set in cross compiler build</i>
</code>

[1] Set variables for an armv7, aarch64, or i686 build.
<b>Don't</b> use variables used by mozilla - confuses libloading for example ..
   and setting flags with CC etc in the shell environment will fail configure,
   so set architecture specific variables here and re-assign them in mozconfig.cross.
<b>Add</b> '-v' to X_CC/X_CXX exports for verbose output to aid troubleshooting
<b>The toolchain</b> used is the custom built gcc cross compiler <a class="extlink" href="https://ray-v.github.io/tde-slackbuilds/cross-compiling-TDE-for-the-RPi3.html#gcc_x">here</a>,
   which includes some compiler optimizations for the arm versions, and creating a kernel headers package.
<code class="thtwob"><b>32-bit</b> armv7_hf
<code class="green">export CRATE=armv7-unknown-linux-gnueabihf
export X_TARGET=arm-linux-gnueabihf
export X_CC=$X_TARGET-gcc
export X_CXX=$X_TARGET-g++
export LIBDIRSUFFIX=""
<span class="dhash">##</span> Slack_base = where the Slackware packages a-y directories are:
export Slack_base=<span class="comment">/path_to_Slackware_arm_current</span>
export TARGET_INSTN=<span class="comment">FF-RPi3-arm-sysroot</span>
<span class="dhash">##</span> Set variable for the package name
export PKG_ARCH=armv7_hf
<span class="dhash">##</span> Disable webrtc for FF64+ on armv7 because of multiple definitions[&diamondsuit;] relating to arm webrtc code causing <a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1523162">linker error</a>
[[ $MAJ_VER -ge 64 ]] &amp;&amp; export DISABLE_WEBRTC='ac_add_options --disable-webrtc'
<span class="dhash">##</span> running elfhack during the build doesn't fail, but corrupts libxul.so
export DISABLE_ELFHACK='ac_add_options --disable-elf-hack'
</code>
<span class="dhash">##</span> [&diamondsuit;] To include webrtc in this build, <a class="extlink" href="https://hg.mozilla.org/mozilla-central/rev/af7f8f492855">remove the duplicate code</a>:
<code class="green">[[ $MAJ_VER -lt 69 ]] &amp;&amp; {
cd $MOZBUILD/mozilla
echo $'--- media/webrtc/trunk/webrtc/system_wrappers/source/cpu_features.cc
+++ media/webrtc/trunk/webrtc/system_wrappers/source/cpu_features.cc
@@ -70,13 +69,0 @@
-
-#if !defined(ANDROID)
-#ifdef WEBRTC_ARCH_ARM_V7
-uint64_t WebRtc_GetCPUFeaturesARM(void) {
-  return kCPUFeatureARMv7
-#ifdef WEBRTC_ARCH_ARM_NEON
-         | kCPUFeatureNEON
-#endif
-         | kCPUFeatureVFPv3;
-}
-#endif // WEBRTC_ARCH_ARM_V7
-#endif // !ANDROID
-
' | while read line
do
patch -N -p0
done

export DISABLE_WEBRTC=''
}
</code></code>
<b>OR:</b>
<code class="thtwob"><b>64-bit</b> aarch64
<code class="green">export CRATE=aarch64-unknown-linux-gnu
export X_TARGET=aarch64-linux-gnu
<span class="dhash">##</span> -march=armv8-a+crc is the compiler default, so just add -mtune=cortex-a53
export X_CC="$X_TARGET-gcc -mtune=cortex-a53"
export X_CXX="$X_TARGET-g++ -mtune=cortex-a53"
export LIBDIRSUFFIX=64
<span class="dhash">##</span> Slack_base = where the Slarm64 packages a-y directories are:
<span class="dhash">##</span> Download from a Slackware mirror - for example <a class="extlink" href="https://slackware.uk/slarm64/slarm64-current/slarm64/">slackware.uk</a>
export Slack_base=<span class="comment">/path_to_Slarm64</span>
export TARGET_INSTN=<span class="comment">FF-RPi3-aarch64-sysroot</span>
export PKG_ARCH=aarch64
<span class="dhash">##</span> webrtc builds ok for aarch64
export DISABLE_WEBRTC=''
<span class="dhash">##</span> 'disable-elf-hack' isn't an option for aarch64
export DISABLE_ELFHACK=''
</code></code>
<b>OR:</b>
<code class="thtwob"><b>32-bit</b> i686
<code class="green">export CRATE=i686-unknown-linux-gnu
export X_TARGET=i686-linux-gnu
<code class="thtwo"><span class="dhash">##</span> <b>gcc optimization for HOST</b>, so only use if TARGET == same machine architecture
OPTM=$(echo $(gcc -Q -O2 -march=native --help=target | grep -E "^  -march=|^  -mtune=|^  -mfpmath=" | tr -d [:blank:]))
<span class="dhash">##</span> otherwise, if required, set OPTM for TARGET machine &hellip;
echo $OPTM
<span class="dhash">##</span> should be something like:
<span style="color:#fafafa">#</span><span class="console"> -march=core2 -mfpmath=sse -mtune=core2</span>
</code>
<span class="dhash">##</span> the '-msse -msse2' flags are included as per the Mozilla release buildconfig
export X_CC="$X_TARGET-gcc -msse -msse2 ${OPTM:-}"
export X_CXX="$X_TARGET-g++ -msse -msse2 ${OPTM:-}"
export LIBDIRSUFFIX=""
<span class="dhash">##</span> Slack_base = where the Slackware32 packages a-y directories are:
<span class="dhash">##</span> Download from a Slackware mirror - for example <a class="extlink" href="https://slackware.uk/">slackware.uk</a>
export Slack_base=<span class="comment">/path_to_Slackware32</span>
export TARGET_INSTN=<span class="comment">FF-i686-sysroot</span>
export PKG_ARCH=i686
<span class="dhash">##</span> webrtc builds ok
export DISABLE_WEBRTC=''
<span class="dhash">##</span> 'elf-hack' is ok
export DISABLE_ELFHACK=''
</code>
</code>

[2] Additional rust requirements

For <b>rust</b>, host relates to the architecture that the program is built on, and target relates to the architecture that the program will run on.

rustc and cargo and the rust-std crate are already installed for x86_64 [host].
Download and install the target crate for building RPi3 or i686 apps.
This <b>must</b> be the same version as the host crate, and installed to the same prefix.
<code class="green">cd $MOZBUILD/sources/
RUST_VER=$(rustc -V|cut -d" " -f2)
<span style="color: #c50000;">wget https://static.rust-lang.org/dist/rust-std-$RUST_VER-$CRATE.tar.xz</span>

tar xf rust-std-$RUST_VER-$CRATE.tar.xz
cd rust-std-$RUST_VER-$CRATE
./install.sh --prefix=$MOZBUILD/sources/rust-$ARCH
</code>

[3] Cross compiler

Set the cross tools directories
<code class="green">export XGCC_DIR=<span class="comment">/opt/cross-pi-gcc</span>
export SYSROOT=<span class="comment">$XGCC_DIR/sysroot</span>
</code>
Install the cross compiler
<code class="green">installpkg <span class="comment">/tmp/</span>xgcc910-glibc2.29-4.19.27-<span class="comment">&lt;re: $PKG_ARCH></span>.txz
</code>

There is an issue with the different limits.h priorities which occurs in cross compiling for Firefox.

The error is:
<code class="console">/opt/cross-pi-gcc/arm-linux-gnueabihf/include/bits/stdlib.h:90:3: error: #error "Assumed value of MB_LEN_MAX wrong"
&hellip;
/opt/cross-pi-gcc/arm-linux-gnueabihf/include/bits/wchar2.h:448:3: error: #error "Assumed value of MB_LEN_MAX wrong"</code>
I've used the solution <a class="extlink" href="https://www.linuxquestions.org/questions/linux-software-2/tar-cross-compile-error-arm-linux-gnueabi-4175642648/">here</a> to resolve this.
<code class="green">(cd $XGCC_DIR/lib/gcc/*-linux-gnu*/9.1.0/plugin/include/
cat limitx.h glimits.h limity.h > ../../include-fixed/limits.h)
</code>

[4] Set up a sysroot for the target libs and headers needed for the Firefox build.
<b>OR</b>
Skip this and use an existing installation.

My preference is to set this up in a separate directory and bind-mount it to the cross compiler sysroot directory.
This enables me to set up different sysroots for whatever is being cross compiled.

Install kernel headers and Slackware/Slarm64 libs/headers as used for the target OS
<code class="green">export ROOT=$MOZBUILD/$TARGET_INSTN
installpkg <span class="comment">/tmp/</span>kernel-headers-4.19.27-<span class="comment">&lt;re: $PKG_ARCH></span>.txz

cd $Slack_base
installpkg l/pango-*.txz
installpkg l/glib2-*.txz
installpkg l/pcre-*.txz
installpkg l/fribidi-*.txz
installpkg l/freetype-*.txz
installpkg l/zlib-*.txz
installpkg a/bzip2-*.txz
installpkg l/libpng-*.txz
installpkg x/fontconfig-*.txz
installpkg a/util-linux-*.txz
installpkg l/expat-*.txz
installpkg l/harfbuzz-*.txz
installpkg l/cairo-*.txz
installpkg x/pixman-*.txz
installpkg x/mesa-*.txz
installpkg x/libglvnd-*.txz
installpkg x/libdrm-*.txz
installpkg x/libX11-*.txz
installpkg x/xorgproto-*.txz
installpkg x/libxcb-*.txz
installpkg x/libpthread-stubs-*.txz
installpkg x/libXau-*.txz
installpkg x/libXdmcp-*.txz
installpkg x/libXext-*.txz
installpkg x/libXdamage-*.txz
installpkg x/libXfixes-*.txz
installpkg x/libXxf86vm-*.txz
installpkg x/libXrender-*.txz
installpkg l/gtk+3-3.*.txz
installpkg l/gdk-pixbuf2-*.txz
installpkg x/libXtst-*.txz
installpkg x/libXinerama-*.txz
installpkg x/libXi-*.txz
installpkg x/libXrandr-*.txz
installpkg x/libXcursor-*.txz
installpkg x/libXcomposite-*.txz
installpkg x/libepoxy-*.txz
installpkg l/atk-*.txz
installpkg l/at-spi2-atk-*.txz
installpkg l/at-spi2-core-*.txz
installpkg a/dbus-*.txz
installpkg l/gtk+2-*.txz
installpkg l/dbus-glib-*.txz
installpkg l/pulseaudio-*.txz
installpkg x/libXt-*.txz
installpkg x/libSM-*.txz
installpkg x/libICE-*.txz
installpkg l/libffi-*.txz
installpkg x/libxshmfence-*.txz
installpkg n/openssl-1.1.*.txz
installpkg x/glu-*.txz
installpkg l/graphite2-*.txz
installpkg l/shared-mime-info-*.txz
<span class="dhash">##</span> move ldconfig out of the way - links will be set up by doinst.sh
mv /sbin/ldconfig /sbin/ldconfig-bak
installpkg l/glibc-2.29*.txz
mv /sbin/ldconfig-bak /sbin/ldconfig
unset ROOT
</code>

[5] Set up shell variables.

pkg-config needs to access the libs and headers for the target system and this sets it up to prefix $SYSROOT to the -L and -I paths in the .pc files
<code class="green">export PKG_CONFIG_PATH=
export PKG_CONFIG_SYSROOT_DIR=$SYSROOT
export PKG_CONFIG_LIBDIR=$SYSROOT/usr/lib$LIBDIRSUFFIX/pkgconfig:$SYSROOT/usr/share/pkgconfig
</code>
Mount SYSROOT
<code class="green">mount -B $MOZBUILD/$TARGET_INSTN $SYSROOT
</code>
Add the cross compiler [$X_TARGET-gcc etc..] bin directory to the PATH
<code class="green">export PATH=$XGCC_DIR/bin:$PATH
</code>
Set suffix for additional mozconfigs
<code class="green">export XCOMPILE=.cross
</code>

[6] The build needs to be set up to use the cross compiler [CC] and the rust target crate [--target=]

Create an additional common mozconfig &Rightarrow; mozconfig.cross
<code class="green">cd $MOZBUILD/mozilla
cat > mozconfig.cross << "EOF"

ac_add_options --target=$CRATE

<span class="dhash">##</span> Set CC/CXX to enable compiler optimization set in X_CC and X_CXX
CC=$X_CC
CXX=$X_CXX

<span class="dhash">##</span> the i686 build sets host == target if HOST_C* not set,
[[ $CRATE == *i686* ]] &amp;&amp; {
mk_add_options "export HOST_CC=gcc"
mk_add_options "export HOST_CXX=g++"
}

<span class="dhash">##</span> elfhack corrupts libxul.so on an armv7-hf build
$DISABLE_ELFHACK

<span class="dhash">##</span> use LD_LIBRARY_PATH to find libstdc++ etc crosstools versions
mk_add_options "export LD_LIBRARY_PATH=$XGCC_DIR/$X_TARGET/lib$LIBDIRSUFFIX"

<span class="dhash">##</span> use the cross tools to strip the arm libraries during installation
mk_add_options "export STRIP=$XGCC_DIR/$X_TARGET/bin/strip"

<span class="dhash">##</span> Add <b>BINDGEN_CFLAGS</b> for the servo/style [stylo] build,
<span class="dhash">##</span> setting include paths for the cross compiler being used,
<span class="dhash">##</span> with BINDGEN_PLUS for some includes specific to each x86/arm architecture
[[ $CRATE == *i686* ]] &amp;&amp; {
BINDGEN_PLUS=-I$XGCC_DIR/$X_TARGET/include
} || {
BINDGEN_PLUS="-I$XGCC_DIR/lib/gcc/$X_TARGET/9.1.0/include \
-I$XGCC_DIR/lib/gcc/$X_TARGET/9.1.0/include-fixed"
}
mk_add_options "export BINDGEN_CFLAGS=--sysroot=$SYSROOT \
-I$XGCC_DIR/$X_TARGET/include/c++/9.1.0 \
-I$XGCC_DIR/$X_TARGET/include/c++/9.1.0/$X_TARGET \
${BINDGEN_PLUS:-}"

<span class="dhash">##</span> maybe disable webrtc for FF64+ on armv7
$DISABLE_WEBRTC

EOF
</code>

Create mozconfig.firefox.cross
<code class="green">cd $MOZBUILD/mozilla
cat > mozconfig.firefox.cross << "EOF"
<span class="dhash">##</span> include the common mozconfig
source $MOZBUILD/mozilla/mozconfig.common

<span class="dhash">##</span> include the cross build mozconfig
source $MOZBUILD/mozilla/mozconfig.cross

<span class="dhash">##</span> for Firefox build
ac_add_options --enable-application=browser
mk_add_options MOZ_OBJDIR=$MOZBUILD/$REL/firefox-build-dir-$PKG_ARCH

EOF
</code>

[7] Error patches:
<code class="console"> {standard input}: Assembler messages:
 {standard input}:1022: Error: bad expression -- `b #_ZL14SigprofHandleriP9siginfo_tPv'</code>
This is caused by the <a class="extlink" href="https://hg.mozilla.org/mozilla-central/rev/537f4d1d837a">SignalTrampoline to work properly with clang</a> fix which needs to be <a class="extlink" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1434526#c2">reverted</a> to work with gcc when cross compiling.</code>
<code class="green">cd $MOZBUILD/mozilla
echo $'--- mfbt/LinuxSignal.h
+++ mfbt/LinuxSignal.h
@@ -29 +29 @@
-    "b %0"
+    "bx %0"
@@ -31 +31 @@
-    : "X"(H)
+    : "r"(H), "l"(aSignal), "l"(aInfo), "l"(aContext)
' | while read line
do
patch -N -p0
done
</code>
<b>OR</b>:
<code class="green">cd $MOZBUILD/mozilla
echo $'--- mfbt/LinuxSignal.h
+++ mfbt/LinuxSignal.h
@@ -25 +25,5 @@
-  asm volatile("b %0" : : "X"(H) : "memory");
+  asm volatile (
+    "bx %0"
+    :
+    : "r"(H), "l"(aSignal), "l"(aInfo), "l"(aContext)
+    : "memory");
' | while read line
do
patch -N -p0
done
</code>
<code class="console">error: field ‘ufp’ has incomplete type ‘user_vfp’</code>
<code class="green">[[ $MAJ_VER -ge 66 ]] &amp;&amp; {
cd $MOZBUILD/mozilla
echo $'--- js/src/wasm/WasmSignalHandlers.cpp
+++ js/src/wasm/WasmSignalHandlers.cpp
@@ -232 +232,10 @@
-#  include &lt;sys/user.h>
+struct user_vfp {
+	unsigned long long fpregs[32];
+	unsigned long fpscr;
+};
+
+struct user_vfp_exc {
+	unsigned long	fpexc;
+	unsigned long	fpinst;
+	unsigned long	fpinst2;
+};
' | while read line
do
patch -N -p0
done
}
</code>
<code class="console">fatal error: main_FIX.h: No such file or directory</code>
<code class="green">cd $MOZBUILD/mozilla/
echo $'--- media/libopus/silk/arm/arm_silk_map.c
+++ media/libopus/silk/arm/arm_silk_map.c
@@ -31 +31 @@
-#include "main_FIX.h"
+#include "../fixed/main_FIX.h"
' | while read line
do
patch -N -p0
done
</code>
</code>
<span class="tabs th2"><a href="#close_FF_xcompile">close</a></span>
</div></div>                                                     <!-- FF xcompile - end -->
<code class="gray">cd $MOZBUILD/mozilla/
export MOZCONFIG=$MOZBUILD/mozilla/mozconfig.firefox${XCOMPILE:-}
./mach build
</code>
A successful build will end with a message like:
<code class="console">mmm:ss.xx We know it took a while, but your build finally finished successfully!
To take your build for a test drive, run: |mach run|
</code>
<b>Installation</b>
Install a dictionary:
<code class="red">(cd $MOZBUILD/$REL/firefox-build-dir-$PKG_ARCH/dist/bin
rm -rf dictionaries
unzip $MOZBUILD/sources/$L10N-dict.xpi dictionaries/*
<span class="dhash">##</span> workaround for FF67+ for l10n method used:
[[ ! $MAJ_VER == 60 ]] &amp;&amp; rename $L10N en-US dictionaries/*)
</code>
Let's take it for a test drive:
<code>./mach run
</code>                                                    <!-- mach package - start -->
<b>Installation:</b> <a name="close_machpk"></a>
Use either './mach install' or &nbsp;<span class="tabs prefs"><a href="#Mpack">'./mach package'</a></span>
<div id="Mpack" class="tab">
<div class="b_prefs"><span class="tabs th2"><a href="#close_machpk">close</a></span>
<!-- leave this space -->
<b>Using './mach package'</b>&nbsp;
<code class="gray">./mach package</code>
will create -
for 57+ builds:
<code class="console">** WiP **</code>
<span class="tabs th2"><a href="#close_machpk">close</a></span>
</div></div>                                                     <!-- mach package - end -->
Install to $DESTDIR for packaging:
<code class="gray">DESTDIR=$MOZBUILD/$REL/packaging-FF-$PKG_ARCH ./mach install
</code>
<b>Create package</b>
Includes setting up a relative link for /usr/bin/firefox &hellip;
<code class="gray">cd ../$REL/packaging-FF-$PKG_ARCH/usr/lib
mkdir -p pkg/{opt,usr/bin}
mv firefox pkg/opt/firefox-$(cat $MOZBUILD/mozilla/browser/config/version.txt)
<span class="red"><span class="dhash">##</span> 'for the record', add the l10n revision that this build is based on:
sed -i "s|SourceStamp.*$|&amp;\nL10n_revision=${L10N_CS:-}|" pkg/opt/firefox-*/application.ini</span>
(cd pkg/usr/bin
ln -s ../../opt/firefox-*/firefox .)
cd pkg
makepkg -l y -c n ../../../../built/firefox-$(cat $MOZBUILD/mozilla/browser/config/version.txt)$LOCZN-$PKG_ARCH.txz
</code>
</div>

<p><br>
<a name="BuildingSMReturn"></a>
<div style="background: #E5F1FF;"><span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJ
bWFnZVJlYWR5ccllPAAAAuxJREFUOE9lUktME1EUPW9mWqbFtmPDLxFCiYghfiiCESKRmhgWuqAr
o2EhMWqEjWhYEF2IO6Ms0AWRlbpg4wbcaIzRBXFBNJrSYPxA+CqRXwv90Ol0Zp7vTamg3uTm3pe8
c8+5H4L/rK+8rMzZ5Xbb/fxlmtwpVDWzvrS0OaKq3U93/iY7H4ry4LbP5+pVFNkC6boJw6CW81zT
dKyuqqHl5WQ70DP+VwGHo+9aXV1JP89zIMMwLWDTqb243tMEQRJAUyrqDwzORqOqnxXZkLLwe81V
Vd5+Xd8G5QoUF+fjVu8JTCwBYz8ojqYWYbeLPlmWWDs4aRWoqHD322wi61O3QDnJPJ4+74eaAb6s
UHjsBpoafCgqciKR0ALA/VYBuFsjy6Kfg9NpgxUxsJ3rCAar8GYG+LwCpDQT31ZMtLRUsHkYEEXa
LpWWugJutwNra8kdfWdjR0ct0lTA7DoQT7PZUIJkxoTHkweXy4mCAk9Aqq8/rLQGj4PydVGAbjlf
X01DBgMf2Ap1Aq9MIbKR/9ygCASOoLikEZOT84oUDmusnziTAwjMTcbs9UpobHTgu2EHUwqFgSMJ
HaVugjKPiBfPNITDKuJxHdLc3EYoEkkwybA8Kx9o68zD6KqIDGurtshA3EPgYYXy1imGhmKw2cBm
FAlJhjEdSqUqmWSvBeTyHw7sxvCahF1s6k7BgMsuYH8BoLFVXroYhSwTq0Ay+Su0dUgvHxNyqJ1n
HDxWKONstW5d2XyM4Fghwae3aQw+SjJWCkkijHAZExOvfFuHNN4FuIM3bh5UJssd6Nyjw9wEFqcN
rH3N4MpICqkULFbOToiGhYVwL9A9ZymglJaPfEw+UfOcAWdEw9VzEfY5K5Oz8cjfEqPTtAhmZt73
xmIX7nCswMDD7+bpbLUvH5XqcrDtzOsRUUxaTNwdjmyUJA2x2PTs1NRoew7MjbACzSyuE0LG8cf6
yr3efUG7XVY4q8DuNRqdD8Xjl5/jH/sNIBmHpcHZfUMAAAAASUVORK5CYII="><span style="vertical-align:20%"><b> Building SeaMonkey</b></span></span>
<code class="gray">unset XCOMPILE
</code>
</code> <a name="close_SM_xcompile"></a>                                                    <!-- SM xcompile - start -->
<span class="tabs prefs"><a href="#SM_xcompile">Cross compiling</a></span><span style="vertical-align:-30%">&nbsp;&nbsp;additional setting up for cross compiling.</span>
<div id="SM_xcompile" class="tab">
<div class="b_prefs"><span class="tabs th2"><a href="#close_SM_xcompile">close</a></span>
<!-- leave this space -->
1] Firstly, set up <a href="#FF_xcompile">mozilla</a>.
2] Create a mozconfig.seamonkey.cross
<code class="green thtwob">cd $MOZBUILD/$REL/comm-$REL
cat > mozconfig.seamonkey.cross << "EOF"
<span class="dhash">##</span> include the common mozconfig
source $MOZBUILD/mozilla/mozconfig.common

<span class="dhash">##</span> include the cross build mozconfig
source $MOZBUILD/mozilla/mozconfig.cross

<span class="dhash">##</span> for SeaMonkey build
ac_add_options --enable-application=${COMM:-}suite
mk_add_options MOZ_OBJDIR=$MOZBUILD/$REL/seamonkey-build-dir-$PKG_ARCH

EOF
</code>
3] Set suffix for mozconfig
<code class="green thtwob">export XCOMPILE=.cross
</code>
<span class="tabs th2"><a href="#close_SM_xcompile">close</a></span>
</div></div>                                                     <!-- SM xcompile - end -->
<code class="gray">cd $MOZBUILD/$REL/comm-$REL
export MOZCONFIG=$MOZBUILD/$REL/comm-$REL/mozconfig.seamonkey${XCOMPILE:-}
./mozilla/mach build
</code>
A successful build will end with a message like:
<code class="console">mmm:ss.xx We know it took a while, but your build finally finished successfully!
To take your build for a test drive, run: |mach run|</code>
Ignore end build failure for esr60.7+ builds:
<code class="console"> gmake[5]: *** No rule to make target '../../../dist/bin/distribution/extensions', needed by 'pack-ext'.  Stop.
</code>
<b>Installation</b>
Install a dictionary:
<code class="red">(cd $MOZBUILD/$REL/seamonkey-build-dir-$PKG_ARCH/dist/bin
rm -rf dictionaries
unzip $MOZBUILD/sources/$L10N-dict.xpi dictionaries/*)
</code>
Let's take it for a test drive:
<code>./mozilla/mach run
</code>
Install to $DESTDIR for packaging:
<code class="gray">DESTDIR=$MOZBUILD/$REL/packaging-SM-$PKG_ARCH ./mozilla/mach install
</code>
<b>Create package</b>
Includes setting up a relative link for /usr/bin/seamonkey &hellip;
<code class="gray">cd ../packaging-SM-$PKG_ARCH/usr/lib
mkdir -p pkg/{opt,usr/bin}
mv seamonkey pkg/opt/seamonkey-$(cat $MOZBUILD/$REL/comm-$REL/suite/config/version.txt)
<span class="green"><span class="dhash">##</span> Set SourceStamp to comm-$REL revision:
[[ ! $COMM_BUILD_CS ]] &amp;&amp; COMM_BUILD_CS=$(hg parent -R $MOZBUILD/$REL/comm-$REL | head -n1 | cut -d":" -f3)
sed -i "s|SourceStamp=.*$|SourceStamp=$COMM_BUILD_CS|" pkg/opt/seamonkey-*/application.ini
<span class="dhash">##</span> 'for the record', add the mozilla and l10n revisions that this build is based on:</span>
<span class="red">sed -i "s|SourceStamp.*$|&amp;\nL10n_revision=${L10N_CS:-}|" pkg/opt/seamonkey-*/application.ini</span>
<span class="green">sed -i "s|SourceStamp.*$|&amp;\nGecko_revision=${Gecko_Rev:-}|" pkg/opt/seamonkey-*/application.ini</span>
(cd pkg/usr/bin
ln -s ../../opt/seamonkey-*/seamonkey .)
cd pkg
makepkg -l y -c n ../../../../built/seamonkey-$(cat $MOZBUILD/$REL/comm-$REL/suite/config/version.txt)$LOCZN-$PKG_ARCH.txz
</code>
</div>

<p><br>
<a name="BuildingTBReturn"></a>
<div style="background:#F4f4f4"><span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A
/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sIDw0JOVohvckAAATpSURBVDjL
rZV7aFNnGMaf7+QkOUmTaG+x96qb1ehab+i8TKtT62VCq2ODsQvCZMLYGIx1F8YYQ53MiezixA1F
1DGdwlTQOaUVhU5rtWrtnNraJrXJ0ubWnJxzcnKu3/5wc7roHGwPfPDxfrw/Xh5eng94iJKUWjfv
P189unadFQAWbjiC/6TGredAKeVe39zUtG7PBXomKJzFs58NA4DhT299aL/lQQ9njm6HUlm/Y+TY
ESuKfGX0VHt3mRJT3lNGLS7xCOJJ/uYJreqJ9YjfOnnffubvhciFYwCAhrWd08dOrngJHgcVpQTh
YwIxTQpDN16hIF3j5nxc09XyPkbWffTvwIqiWGnH91NnPJ7bDIeOXI9JwkEe125EMJjRYYBAtttK
RY7tKFm2zhs48eGd3uCZQ3fu5G5ouPVIma7rPTrL2Y7bquFymbTtbB85vrMFYkEhmJGFcJkGOM5O
OYYh4VhKDsTM8b81uhdSQ2sundXgv2fiq8f2IhrqhsQn1vLRkE0QJSh6hgb7U+TgnnaseuQK1k+6
hP5bcZS5rJg7sYx4cz10SlU5Vz8+p0sY6P3GBGnMsmLC0ucQ7GhbnkwmVsXDIZqJh3Hz6gD5pTOM
mjwLbkSiaMmZDxfP4/T+g+i6EkK+x0VsrIWonnLrtjYWeizwwq8/7q7J8lilpFG3OyFGwuS7cxGU
ui2YPSYX8UIn9o9ag8MtERToKkZ5q9C6byuSogGbhYEHaXTnzyU93X3utMW2KwtsAFOGV/owGBnA
mBmLMOfRfPiKOMwl7ZicDCMnJcGq6rAYaXisTnBWCl01YOcYlOdb0Wt/DKCYlAVmKFyqxNM5L7+F
Nct98FUUojfgx4SZK/Dq0okY7rCDNVVYTB42jkFJmQfeAhdCoRTKTR7TplRQg/y1ZOwdMMsiIwlk
/Ixl2HukAwdOXcPJqyGIkoyV0ypR7eXRGhyEKvjB+mZjUTGDBXWliNba4bKI6AsoJKPp2WDO6bou
SUPjhHgQn/5wCRoxUN9Qh8FEAm6ksW3DM2g9246yEi8GdCd8xQ6oqowcGxCLilBVFQxhYllgXVU2
Waz27YP9XVg5z4fRE3xYMs6BuKjDH1WgUQa1tdNhmjoqDQOmJkPNZJCWBGTSEjRNg93p/CTLY4fD
dchuc6jJWJTOn16FF6e5sfNcDCFehagasBIKLSNAzUjQZBGKLEGRRYh8EmlJpBaGVQ1V35MF9s1e
FC8oKtpBKYiDpOmsjVfQPyjielCCIhtQdR1SMnYbLqcgC0nw8SiEFE+1jErcebm7py5eOXjfrJg3
88k3C7zFnaXDWDLUm6B5hGDZxHz4vDlQNR2BXj+UtIxkPIp4dAB8Mkk1TSN53uLIpg8+fftu1j1Z
se/rTe4bgVDF6tfevQiGtUlDfQj19aHf3w2Gmqjy+eAdUQRJFJAailMLIcTtyfOvfuOdeT+3tYet
LKtpup4NTsWC32aExPOdHZcjhJpejnPAM8wDG+eE1WqFYRgwTROGpoDnU0O8kG5vamr+KhhLnt57
4PDQAyfu83fVlJaUdEiigK7O81+u3/jFIVmUJzc8Vbc8Nz8/j8JkEpFY/ODREz+BGO1btny+a0RR
UfHFy53OBUvq5fsGc6j/duKdOt1ccFeZBcAByAGQ98dxAXD8uaqSJFRTSv/5n+rpuY7/S78DHAti
UD80RecAAAAASUVORK5CYII="><span style="vertical-align:40%"><b> Building Thunderbird [<img style="vertical-align:-40%" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAEGElEQVR42sWV22scVRzHA2nVVoh3
pOKTCEUkRPShCCJYFH3QJx/9A3xVKD54wZdCRFoVBYkUpFKEWpJsE+0mbXeTvSTNJtn7dbI7u9n7
ZXZnd3b2OjM75+tvJlKRrU2LDx74sbtwzud8f9/vOWcnJg4ZQto/1cxFT0rl5LRUSU03i7GTYjow
NfFfhpiLfNmu8omOsK93G3l0xQI69azermUStMG5+wYWt1cebRYTbbmeRV+qsGFXhNJvUUlQeiIG
7Srr1PNolrh2Pe1//J6g3B8/H28UohlZ2MdArjF1KENXe9C1IfQRlTaARr+H3QaTahk0C7Fys8gd
PxRc431yq5xETyqbUG3YAZgGQAOj0tUB2VGETDXsNFhbSKO6t6PfFZoLOb+oZ8NoV3g2pJZ1TYFc
SuJgMLKlDtXYCDoYU017Oo0CEwsxlOObP9wRmtpencqFXXmxGGeUOnSlT4s1aLS4mQmjK+SgKT1T
uamewEY3A6mCVoljpcRWh9+9+dgYOOpafj0f2YCYixrh4MZPZyGUsvBcmSPl/X8ADUtAnyO1T3MF
NMt7KCU82NuyvjsGDtoXF/LRDdBpoBab1LaAz898DKarB1Cm3vYZUE3fNYUUywJaBK4kdxBzL9vH
wIG1xX425IRU5hCzXcH3356DxemH/cYKWrUCGJ2I0UD+ewNDsdIlxTUTXCTFofVFjIF3rJfB+9eY
mI+S2hL89kV8+vUc9uIRcJurkHIJUq/cVm9spNJGXbEIMR9HNuJmYdfSONhz7VfEt6yo8j50m0X4
F+bMlg9gOhrxW2TDyAzUqBGFO+zW0abzbpyktM/GvLb5cbDPZuHC7mVkQy4jZTRSfsjVDJRBC3I5
BbUnmUGxkWJaoPRaptoWWWcEF711DTsrl4UxcMS98knAYUGCJpRTPkjVNBq8HyIfMNPXCDaiG6cO
2jDOOF0gmsNDSAfB++wIrFvIvquz4+HZlp6ObFqHAcdVlqKJVQIays3Hh6zpU0h9uWa8HXTrcmhV
UmiQBfsUeNi1DP+aBUH78ok7Pz6J3Qs+2wJCriUTXuJ20ChEIFWSJkgyKwm6RBAoi/2gA9GN35nX
vgDOY7/0r1f6w7ffnMpFPdWg01CwyBKeFWRIUSnphbAfoZAiqFAnWbpI3PZ1UCbMsCDlXRNmz3x0
4m7PxeTp1159JrnrSBqtkRKW9DuQT/hQ2PMhH99FgfOCD7oRdFjMUxDfulk59fLMc7T2wcMeuGOP
TE4+77TO/+a1WTop3zrSoQ0qNzKRzYPvASc8q/PK9flLVqK9RGvu+R/lKNVTr8xMn/rgvXc+u/jd
V5u/zH0Tu/jj+fiF82e333/rjdmZF184TXOeNYTc9z/J0SNHjA0eonqY6gmqJ/9Sd+zI5OQDE//H
+BPvaAJjezKnjwAAAABJRU5ErkJggg=="> Daily]</b></span></span>
<code class="gray">unset XCOMPILE
</code>
</code> <a name="close_TB_xcompile"></a>                                                    <!-- TB xcompile - start -->
<span class="tabs prefs"><a href="#TB_xcompile">Cross compiling</a></span><span style="vertical-align:-30%">&nbsp;&nbsp;additional setting up for cross compiling.</span>
<div id="TB_xcompile" class="tab">
<div class="b_prefs"><span class="tabs th2"><a href="#close_TB_xcompile">close</a></span>
<!-- leave this space -->
1] Firstly, set up <a href="#FF_xcompile">mozilla</a>.
2] Create a mozconfig.thunderbird.cross
<code class="green thtwob">cd $MOZBUILD/$REL/comm-$REL
cat > mozconfig.thunderbird.cross << "EOF"
<span class="dhash">##</span> include the common mozconfig
source $MOZBUILD/mozilla/mozconfig.common

<span class="dhash">##</span> include the cross build mozconfig
source $MOZBUILD/mozilla/mozconfig.cross

<span class="dhash">##</span> for Thunderbird build
ac_add_options --enable-application=${COMM:-}mail
mk_add_options MOZ_OBJDIR=$MOZBUILD/$REL/thunderbird-build-dir-$PKG_ARCH

EOF
</code>
3] Set suffix for mozconfig
<code class="green thtwob">export XCOMPILE=.cross
</code>
<span class="tabs th2"><a href="#close_TB_xcompile">close</a></span>
</div></div>                                                     <!-- TB xcompile - end -->
<code class="gray">cd $MOZBUILD/$REL/comm-$REL
export MOZCONFIG=$MOZBUILD/$REL/comm-$REL/mozconfig.thunderbird${XCOMPILE:-}
./mozilla/mach build
</code>
A successful build will end with a message like:
<code class="console">mmm:ss.xx We know it took a while, but your build finally finished successfully!
To take your build for a test drive, run: |mach run|</code>
<b>Installation</b>
Add a L10N dictionary:
<code class="red">[[ $MAJ_VER == 60 ]] &amp;&amp; (cd $MOZBUILD/$REL/thunderbird-build-dir-$PKG_ARCH/dist/bin/dictionaries
unzip -j $MOZBUILD/sources/$L10N-dict.xpi dictionaries/*)
</code>
Let's take it for a test drive:
<code>./mozilla/mach run
</code>
Install to $DESTDIR for packaging:
<code class="gray">DESTDIR=$MOZBUILD/$REL/packaging-TB-$PKG_ARCH ./mozilla/mach install
</code>
Add dictionary extension for L10N:
This will have to be enabled on TB first run - Edit|Preferences|Composition|Language
<code class="red">[[ $MAJ_VER -ge 67 ]] &amp;&amp; (cd $MOZBUILD/$REL/packaging-TB-$PKG_ARCH/usr/lib/thunderbird
mkdir extensions
DICT_ID=$(unzip -p $MOZBUILD/sources/$L10N-dict.xpi manifest.json | grep -o [-.a-z]*@[-.a-z]*)
cp $MOZBUILD/sources/$L10N-dict.xpi extensions/$DICT_ID.xpi)
</code>
<b>Create package</b>
Includes setting up a relative link for /usr/bin/thunderbird &hellip;
<code class="gray">cd ../packaging-TB-$PKG_ARCH/usr/lib
mkdir -p pkg/{opt,usr/bin}
mv thunderbird pkg/opt/thunderbird-$(cat $MOZBUILD/$REL/comm-$REL/mail/config/version.txt)
<span class="green"><span class="dhash">##</span> Set SourceStamp to comm-$REL revision:
[[ ! $COMM_BUILD_CS ]] &amp;&amp; COMM_BUILD_CS=$(hg parent -R $MOZBUILD/$REL/comm-$REL | head -n1 | cut -d":" -f3)
sed -i "s|SourceStamp=.*$|SourceStamp=$COMM_BUILD_CS|" pkg/opt/thunderbird-*/application.ini
<span class="dhash">##</span> 'for the record', add the mozilla and l10n revisions that this build is based on:</span>
<span class="red">sed -i "s|SourceStamp.*$|&amp;\nL10n_revision=${L10N_CS:-}|" pkg/opt/thunderbird-*/application.ini</span>
<span class="green">sed -i "s|SourceStamp.*$|&amp;\nGecko_revision=${Gecko_Rev:-}|" pkg/opt/thunderbird-*/application.ini</span>
(cd pkg/usr/bin
ln -s ../../opt/thunderbird-*/thunderbird .)
cd pkg
makepkg -l y -c n ../../../../built/thunderbird-$(cat $MOZBUILD/$REL/comm-$REL/mail/config/version.txt)$LOCZN-$PKG_ARCH.txz
</code>
</div>

<p>
Unmount the bind mounts:
<br>
<code class="gray">umount $MOZBUILD/$REL/comm-$REL/mozilla/comm
umount $MOZBUILD/$REL/comm-$REL/mozilla
<span class="green">umount $SYSROOT</span>
</code>
<br>
<hr class="comment">
<span class="comment">To clone this page from Github:<br>
<code style="font-style:italic">git clone https://github.com/Ray-V/mozbuild.git
cd mozbuild
git checkout gh-pages
</code></span>
<!-- DROPDOWN MENU -->
<div>
<ul id="menu">
    <li><a><span style="color:#e3e3e3">&nabla;</span></a>
      <div>
        <p><a href="#Latest">Latest builds</a>
        <p><a href="#DirStructure">Directory structure</a>
        <p><a href="#Set_variables">Set variables</a>
        <p><a href="#Mercurial_bundles">Mercurial bundles</a>
        <p><a href="#Locrep">Add new changesets</a>
        <p><a href="#known_rel"><span class="green">Building to a revision</span></a>
        <p><a href="#Create_mozconfigs">Create mozconfigs</a>
        <p><a href="#Prefs"><span class="green">User preferences</span></a>
        <p><a href="#Ttipbox"><span class="green">Gtk3 configuration</span></a>
        <p><a href="#l10n"><span class="red">Localization</span></a>
        <p><a href="#BuildingFFReturn"><span style="background: #FFFADD;">Building Firefox</span></a>
        <p><a href="#BuildingSMReturn"><span style="background: #E5F1FF;">Building SeaMonkey</span></a>
        <p><a href="#BuildingTBReturn"><span style="background: #F4f4f4;">Building Thunderbird</span></a>
      </div>
    </li>
</ul>
</div>
<!-- DROPDOWN MENU ENDS-->

</body></html>
